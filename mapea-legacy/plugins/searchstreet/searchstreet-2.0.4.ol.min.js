!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=82)}({10:function(e,t){e.exports='<div class="m-control m-searchstreet-container">\n   <span id="codIne"></span>\n   \x3c!-- search panel --\x3e\n   <div class="search-panel">\n      <input type="text" id="m-searchstreet-search-input" placeholder="Buscar" class="m-input-search" />\n      <button type="button" id="m-searchstreet-search-btn" class="g-cartografia-zoom m-search-btn" title="Buscar"></button>\n      <button type="button" id="m-searchstreet-clear-btn" class="g-cartografia-cancelar m-clear-btn"title="Limpiar búsqueda"></button>\n   </div>\n   \x3c!-- results autocomplete --\x3e\n   <div class="results-panel-content" id="m-autocomplete-results">\n       <div id="m-searching-result-autocomplete" class="m-searching-result g-cartografia-spinner"></div>\n   </div>\n   \x3c!-- results panel --\x3e\n   <div class="results-panel" id="m-searchstreet-results">\n      <div id="m-searching-result-searchstreet" class="m-searching-result g-cartografia-spinner"></div>\n   </div>\n</div>\n'},11:function(e,t){e.exports='<div class="results-panels">\n   {{#if containtResult}}\n   <div class="results" id="m-searchstreet-results-scroll">\n      {{#each docs}}\n      <div class="result">\n         <table>\n            <tbody>\n               <tr>\n                  <td>{{streetType}} {{streetName}}, {{streetNumber}}</td>\n               </tr>\n               <tr>\n                  <td>{{localityName}} ({{cityName}})</td>\n               </tr>\n            </tbody>\n         </table>\n      </div>\n      {{/each}}\n   </div>\n   {{else}}\n   <div class="results">\n   <span class="partial">No se han encontrado resultados\n\t\tpara la búsqueda "{{search}}".</span>\n   </div>\n   {{/if}}\n   <div class="page">\n      <span class="found" id="m-searchstreet-page-found">Resultados encontrados:</span>\n   {{#if containtResult}}\n <span class="total">{{docs.length}} en total.</span>\n{{else}}\n <span class="total">0 en total.</span>\n{{/if}}\n      <div class="g-cartografia-flecha-arriba"></div>\n   </div>\n</div> \n'},3:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var i=s(9),r=s.n(i);class n extends M.impl.Control{constructor(){super(),this.facadeMap_=null,this.listPoints=[],this.element_=null}addTo(e,t){this.facadeMap_=e,this.element_=t,super.addTo(e,t)}drawPoints(e){let t=null;for(let s=0,i=e.length;s<i;s+=1){t=new ol.Feature,t.setStyle(new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"#3399CC"}),stroke:new ol.style.Stroke({color:"#fff",width:2})})})),t.setGeometry(null!==e[s].coordinateX&&null!==e[s].coordinateY?new ol.geom.Point([e[s].coordinateX,e[s].coordinateY]):null);const i=e[s];this.addEventClickFeature(i,t),this.facadeMap_.drawFeatures([M.impl.Feature.olFeature2Facade(t)]),this.listPoints.push([t])}this.zoomResults()}zoomResults(){const e=this.listPoints[0],t=ol.extent.boundingExtent(e.filter(e=>!M.utils.isNullOrEmpty(e.getGeometry())).map(e=>e.getGeometry().getFirstCoordinate()));this.facadeMap_.setBbox(t)}addEventClickFeature(e,t){this.facadeMap_.removePopup(),M.utils.isNullOrEmpty(t)?(this.showPopup(e,!1),this.facadeMap_.setBbox([e.coordinateX,e.coordinateY,e.coordinateX,e.coordinateY])):t instanceof ol.Feature&&t.set("vendor",{mapea:{click:t=>{this.showPopup(e,!1)}}})}showPopup(e,t){const s={jsonp:!0,vars:{tVia:e.streetType,nVia:e.streetName,num:e.streetNumber,mun:e.localityName,prov:e.cityName},parseToHtml:!1},i={icon:"g-cartografia-zoom",title:"Searchstreet",content:M.template.compileSync(r.a,s)};if(this.popup_=this.facadeMap_.getPopup(),M.utils.isNullOrEmpty(this.popup_))M.utils.isUndefined(t)?this.popup_=new M.Popup:this.popup_=new M.Popup({panMapIfOutOfView:t}),this.popup_.addTab(i),this.facadeMap_.addPopup(this.popup_,[e.coordinateX,e.coordinateY]);else{this.popup_.getTabs().some(e=>"Searchstreet"!==e.title)?this.popup_.addTab(i):(this.facadeMap_.removePopup(),M.utils.isUndefined(t)?this.popup_=new M.Popup:this.popup_=new M.Popup({panMapIfOutOfView:t}),this.popup_.addTab(i),this.facadeMap_.addPopup(this.popup_,[e.coordinateX,e.coordinateY]))}}getElement(){return this.element_}destroy(){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.remove("top-extra"),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_.getImpl().removePopup(),this.facadeMap_=null,this.listPoints=null,this.element_=null}}n.POPUP_TEMPLATE="searchstreetpopup.html"},41:function(e,t){e.exports='<div class="results-panels">\n   <div class="results" id="m-autcomplete">\n      {{#each docs}}\n      <div class="result autocomplete">\n       {{this}}\n      </div>\n      {{/each}}\n   </div>\n</div>\n\n\n'},42:function(e){e.exports=JSON.parse('{"url":{"name":"searchstreet"},"constructor":"M.plugin.Searchstreet","parameters":[{"type":"object","properties":[{"type":"simple","name":"locality","position":0}]}],"files":{"ol":{"scripts":["searchstreet-2.0.4.ol.min.js"],"styles":["searchstreet-2.0.4.min.css"]}},"metadata":{"uuid_plugin":"","uuid_version_plugin":"","version_ficha_metadatos":"","name":"Searchstreet","description":"","text":"","version":"2.0.4","date":"03/02/2020","author":"Junta de Andalucía","org":"Junta de Andalucía","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","buttons":[{"title":"","description":"","querySelector":""},{"title":"","description":"","querySelector":""}],"dependencies":{"modules":["",""],"plugins":[{"uuid":"","name":""}],"services":[{"name":"","description":""}]},"compatibility":["4","5","6"]}}')},68:function(e,t,s){},7:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s(3),r=s(10),n=s.n(r),a=s(11),l=s.n(a);class o extends M.Control{constructor(e,t){super(new i.a,o.NAME),M.utils.isUndefined(i.a)&&M.exception("La implementación usada no puede crear controles Searchstreet"),this.input_=null,this.button_=null,this.element_=null,this.resultsContainer_=null,this.searchTime_=0,this.name_="searchstreet",this.searchUrl_=e,this.municipio_=null,this.provincia_=null,this.provincias_=[{nombre:"Huelva",codigoINE:"21"},{nombre:"Sevilla",codigoINE:"41"},{nombre:"Córdoba",codigoINE:"14"},{nombre:"Jaén",codigoINE:"23"},{nombre:"Cádiz",codigoINE:"11"},{nombre:"Málaga",codigoINE:"29"},{nombre:"Granada",codigoINE:"18"},{nombre:"Almería",codigoINE:"04"}],M.utils.isUndefined(t)||(this.codIne_=t,this.searchCodIne_=M.config.SEARCHSTREET_URLCOMPROBARINE),this.minAutocomplete_=M.config.AUTOCOMPLETE_MINLENGTH,this.facadeMap_=null,this.resultsAutocomplete_=null,this.completed=!1,this.respuestasProvincias_=[],this.contadorProvincias=0,this.resultsScrollContainer_=null}createView(e){this.facadeMap_=e;const t=M.template.compileSync(n.a,{jsonp:!0});return this.addEvents(t),t}addEvents(e){if(this.element_=e,this.on(M.evt.COMPLETED,()=>{this.element_.classList.add("shown")},this),this.input_=this.element_.getElementsByTagName("input")["m-searchstreet-search-input"],this.button_=this.element_.getElementsByTagName("button")["m-searchstreet-search-btn"],this.clear_=this.element_.getElementsByTagName("button")["m-searchstreet-clear-btn"],this.button_.addEventListener("click",this.searchClick.bind(this)),this.input_.addEventListener("keyup",this.searchClick.bind(this)),this.clear_.addEventListener("click",this.clearSearchs_.bind(this)),this.resultsContainer_=this.element_.getElementsByTagName("div")["m-searchstreet-results"],this.resultsAutocomplete_=this.element_.getElementsByTagName("div")["m-autocomplete-results"],this.searchingResult_=this.element_.querySelector("div#m-searchstreet-results > div#m-searching-result-searchstreet"),!M.utils.isUndefined(this.codIne_)&&!M.utils.isNullOrEmpty(this.codIne_)){const e=M.utils.addParameters(this.searchCodIne_,{codigo:this.codIne_});M.remote.get(e).then(e=>{let t;try{M.utils.isNullOrEmpty(e.text)||(t=JSON.parse(e.text),M.utils.isNullOrEmpty(t.comprobarCodIneResponse.comprobarCodIneReturn)?M.dialog.error(`El código del municipio '${this.codIne_}' no es válido`):(this.getMunProv_(t),this.element_.getElementsByTagName("span").codIne.innerHTML=`Búsquedas en ${this.municipio_}  (${this.provincia_})`))}catch(e){M.exception("La respuesta no es un JSON válido: "+e)}})}this.searchingResult_.parentNode.removeChild(this.searchingResult_)}getMunProv_(e){this.provincia_=e.comprobarCodIneResponse.comprobarCodIneReturn.comprobarCodIneReturn.nombreProvincia,this.municipio_=e.comprobarCodIneResponse.comprobarCodIneReturn.comprobarCodIneReturn.nombreMunicipio}searchClick(e){if(e.preventDefault(),"keyup"!==e.type){this.resultsAutocomplete_.classList.remove(o.MINIMUM),this.resultsAutocomplete_.innerHTML="";let e=this.input_.value;if(M.utils.isNullOrEmpty(e))M.dialog.error("Debe introducir una búsqueda.");else if(e.length<this.minAutocomplete_?this.completed=!1:this.completed=!0,M.utils.isUndefined(this.codIne_)||M.utils.isNullOrEmpty(this.codIne_))this.search_(e,this.showResults_);else{const t=e.indexOf(",");e.indexOf(",")>-1&&(e=e.substring(0,t)),this.search_(`${e}, ${this.municipio_} , (${this.provincia_})`,this.showResults_)}}}search_(e,t){this.resultsContainer_.innerHTML=" ";let s=null;this.provincia_=null,this.municipio_=null,this.resultsContainer_.appendChild(this.searchingResult_),this.element_.classList.add(o.SEARCHING_CLASS),this.resultsContainer_.classList.add(o.MINIMUM);const i=M.utils.addParameters(M.config.SEARCHSTREET_NORMALIZAR,{cadena:e});M.remote.get(i).then(e=>{const i=JSON.parse(e.text).normalizarResponse.normalizarReturn;if(this.provincia_=M.utils.beautifyString(i.provincia),this.municipio_=M.utils.beautifyString(i.municipio),M.utils.isNullOrEmpty(this.provincia_))if(M.utils.isNullOrEmpty(this.provincia_)&&!M.utils.isNullOrEmpty(this.municipio_)){this.searchTime_=Date.now(),this.respuestasProvincias_=[],this.contadorProvincias=0;for(let e=0,r=this.provincias_.length;e<r;e+=1)s=M.utils.addParameters(this.searchUrl_,{streetname:i.nombreVia,streetNumber:i.numeroPortal,streetType:i.tipoVia,municipio:this.municipio_,provincia:this.provincias_[e].nombre,srs:this.facadeMap_.getProjection().code}),this.querySearchProvinces(s,this.provincias_[e].nombre,t)}else s=M.utils.addParameters(this.searchUrl_,{streetname:i.direccionSinNormalizar,streetNumber:null,streetType:null,municipio:null,provincia:null,srs:this.facadeMap_.getProjection().code}),this.searchTime_=Date.now(),this.querySearch_(s,null,t);else s=M.utils.addParameters(this.searchUrl_,{streetname:i.nombreVia,streetNumber:i.numeroPortal,streetType:i.tipoVia,municipio:this.municipio_,provincia:this.provincia_,srs:this.facadeMap_.getProjection().code}),this.searchTime_=Date.now(),this.querySearch_(s,this.provincia_,t)})}querySearch_(e,t,s){(i=>{M.remote.get(e).then(e=>{if(i===this.searchTime_){let i;try{i=M.utils.isNullOrEmpty(e.text)||-1!==e.text.indexOf("No se ha podido obtener el codigoINE")?null:JSON.parse(e.text)}catch(e){M.exception("La respuesta no es un JSON válido: "+e)}M.utils.isNullOrEmpty(i)?(s.call(this,i),this.element_.classList.remove(o.SEARCHING_CLASS),this.resultsContainer_.classList.remove(o.MINIMUM)):(this.provincia_=M.utils.beautifyString(t),s.call(this,i),this.element_.classList.remove(o.SEARCHING_CLASS),this.resultsContainer_.classList.remove(o.MINIMUM))}})})(this.searchTime_)}querySearchProvinces(e,t,s){(i=>{M.remote.get(e).then(e=>{if(this.respuestasProvincias_.push(e),this.contadorProvincias+=1,8===this.contadorProvincias)for(let e=0,r=this.respuestasProvincias_.length;e<r;e+=1)if(i===this.searchTime_){let i;try{const t=this.respuestasProvincias_[e].text;i=M.utils.isNullOrEmpty(t)||-1!==t.indexOf("No se ha podido obtener el codigoINE")?null:JSON.parse(t)}catch(e){M.exception("La respuesta no es un JSON válido: "+e)}M.utils.isNullOrEmpty(i)||0===i.geocoderMunProvSrsResponse.geocoderMunProvSrsReturn.geocoderMunProvSrsReturn.coordinateX||(this.provincia_=M.utils.beautifyString(t),s.call(this,i),this.element_.classList.remove(o.SEARCHING_CLASS),this.resultsContainer_.classList.remove(o.MINIMUM))}})})(this.searchTime_)}showResults_(e){const t=this.parseResultsForTemplate_(e);if(!M.utils.isUndefined(this.codIne_))for(let e=0,s=t.docs.length;e<s;e+=1)M.utils.isUndefined(t.docs[e])||void 0===t.docs[e].coordinateX&&(t.docs.splice(e,1),s-=1,e-=1);const s={jsonp:!0,vars:t},i=M.template.compileSync(l.a,s);if(this.resultsContainer_.classList.remove(o.HIDDEN_RESULTS_CLASS),this.resultsContainer_.innerHTML=i.innerHTML,this.resultsScrollContainer_=this.resultsContainer_.querySelector("div#m-searchstreet-results-scroll"),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||M.utils.enableTouchScroll(this.resultsScrollContainer_),this.facadeMap_.removePopup(),this.getImpl().listPoints.length>0){const e=this.facadeMap_.getLayers().filter(e=>"__draw__"===e.name)[0];e.removeFeatures(e.getFeatures())}M.utils.isUndefined(t.docs[0])||(this.getImpl().drawPoints(t.docs),this.eventList_(t.docs)),this.element_.classList.remove(o.SEARCHING_CLASS),this.resultsContainer_.classList.remove(o.MINIMUM);this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba").addEventListener("click",this.resultsClick_.bind(this)),this.fire(M.evt.COMPLETED),this.element_.getElementsByClassName("m-autocomplete-results").innerHTML=""}parseResultsForTemplate_(e){let t=null,s=null;const i=e,r=this.input_.value;if(M.utils.isNullOrEmpty(i))t={docs:[void 0],containtResult:s,search:r};else{const e=i.geocoderMunProvSrsResponse.geocoderMunProvSrsReturn;if(s=!M.utils.isNullOrEmpty(e),e.geocoderMunProvSrsReturn instanceof Array)if(M.utils.isUndefined(e.geocoderMunProvSrsReturn[0].coordinateX))t={docs:[void 0],containtResult:!1,search:r};else{for(let t=0,s=e.geocoderMunProvSrsReturn.length;t<s;t+=1)e.geocoderMunProvSrsReturn[t].localityName=this.municipio_,e.geocoderMunProvSrsReturn[t].cityName=this.getNameProvince(e.geocoderMunProvSrsReturn[t].locality),e.geocoderMunProvSrsReturn[t].streetType=M.utils.beautifyString(e.geocoderMunProvSrsReturn[t].streetType),e.geocoderMunProvSrsReturn[t].streetName=M.utils.beautifyString(e.geocoderMunProvSrsReturn[t].streetName);t={docs:e.geocoderMunProvSrsReturn,containtResult:s,search:r}}else M.utils.isNullOrEmpty(e)?t={docs:[void 0],containtResult:s,search:r}:0===e.geocoderMunProvSrsReturn.coordinateX?t={docs:[void 0],containtResult:!1,search:r}:(e.geocoderMunProvSrsReturn.localityName=this.municipio_,e.geocoderMunProvSrsReturn.cityName=this.getNameProvince(e.geocoderMunProvSrsReturn.locality),e.geocoderMunProvSrsReturn.streetType=M.utils.beautifyString(e.geocoderMunProvSrsReturn.streetType),e.geocoderMunProvSrsReturn.streetName=M.utils.beautifyString(e.geocoderMunProvSrsReturn.streetName),t={docs:[e.geocoderMunProvSrsReturn],containtResult:s,search:r})}return t}getNameProvince(e){let t=e.toString();t.length<5&&(t="0"+t);const s=t.substr(0,2);return this.provincias_.filter(e=>e.codigoINE===s)[0].nombre}eventList_(e){const t=this.resultsContainer_.getElementsByClassName("result");for(let s=0,i=t.length;s<i;s+=1)this.addEventClickList_(t[s],e[s])}addEventClickList_(e,t){e.addEventListener("click",e=>{M.window.WIDTH<=M.config.MOBILE_WIDTH&&this.resultsClick_(Object.create({target:this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba")})),this.getImpl().addEventClickFeature(t)},!1,this)}equals(e){let t=!1;return e instanceof o&&(t=this.name===e.name),t}getInput(){return this.input_}getHtml(){return this.element_}clearSearchs_(){this.element_.classList.remove("shown"),this.facadeMap_.removePopup();const e=this.facadeMap_.getLayers().filter(e=>"__draw__"===e.name)[0];e.removeFeatures(e.getFeatures()),this.input_.value="",this.resultsContainer_.innerHTML="",this.resultsAutocomplete_.innerHTML=""}resultsClick_(e){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra-search"),e.target.classList.toggle("g-cartografia-flecha-arriba"),e.target.classList.toggle("g-cartografia-flecha-abajo"),this.resultsContainer_.classList.toggle(o.HIDDEN_RESULTS_CLASS)}}o.NAME="searchstreet",o.TEMPLATE="searchstreet.html",o.RESULTS_TEMPLATE="searchstreetresults.html",o.SEARCHING_CLASS="m-searching",o.HIDDEN_RESULTS_CLASS="hidden",o.MINIMUM="minimum"},82:function(e,t,s){"use strict";s.r(t);var i=s(41),r=s.n(i);class n extends M.Plugin{constructor(e={}){super(),this.map_=null,this.name=n.NAME,this.locality_="",M.utils.isNullOrEmpty(e.locality)||(this.locality_=e.locality),this.url_=M.config.SEARCHSTREET_URLCODINEAUTOCOMPLETE,this.minLength_=M.config.AUTOCOMPLETE_MINLENGTH,this.target_=e.target,this.resultsContainer_=e.html.querySelector("div#m-autocomplete-results"),this.target_.addEventListener("keydown",e=>{const t=this.resultsContainer_.querySelectorAll("div.autocomplete");let s=this.resultsContainer_.querySelector(".selected");if(13===e.keyCode){const t=this.map_.getControls();for(let i=0;i<t.length;i+=1)"searchstreet"===t[i].name?e.target.value.indexOf(",")<0?this.searchMunicipality_(e.target.value):(t[i].searchClick(e),t[i].completed=!1):"searchstreetgeosearch"===t[i].name&&(!M.utils.isNullOrEmpty(s)&&e.target.value.indexOf(",")<0?this.searchMunicipality_(e.target.value):(t[i].ctrlSearchstreet.searchClick(e),t[i].ctrlSearchstreet.completed=!1,t[i].ctrlGeosearch.searchClick(e)));s=null}else if(t.length>0){let i=-1;for(let e=0;e<t.length;e+=1)t[e].classList.contains("selected")&&(i=e,s=t[e]);if(40===e.keyCode?-1===i?(s=t[0],s.classList.add("selected")):i<t.length-1&&(t[i].classList.remove("selected"),s=t[i+1],s.classList.add("selected")):38===e.keyCode&&(i===t.length?(s=t[t.length],s.classList.add("selected")):i>=1&&(t[i].classList.remove("selected"),s=t[i-1],s.classList.add("selected"))),!M.utils.isNullOrEmpty(s)){e.target.value=s.innerHTML.trim();document.getElementById("m-autcomplete").scrollTop=s.offsetTop}}}),this.delayTime_=M.config.AUTOCOMPLETE_DELAYTIME,this.timeoutKey_=null,this.limit_=M.config.AUTOCOMPLETE_LIMIT,this.searchTime_=0,this.busqMunicipio_=!1,this.busqMunicipioClick_=!1,this.searchingResult_=this.resultsContainer_.querySelector("div#m-autocomplete-results > div#m-searching-result-autocomplete")}addTo(e){this.map_=e,this.target_.classList.add(n.CLASS),this.resultsContainer_.removeChild(this.searchingResult_),this.target_.addEventListener("input",this.keyPress_.bind(this)),this.target_.addEventListener("keyup",this.hiddenAutocomplete_.bind(this))}hiddenAutocomplete_(e){27!==e.keyCode&&13!==e.keyCode||this.cancelSearch_(e)}keyPress_(e){e.preventDefault(),M.utils.isNullOrEmpty(this.timeoutKey_)||this.cancelSearch_(e);const t=this.target_.value.trim();t.length>=this.minLength_&&(this.timeoutKey_=setTimeout(()=>{-1!==t.indexOf(",")?this.busqMunicipio_=!0:(this.busqMunicipio_=!1,this.busqMunicipioClick_=!1),this.search_(t)},this.delayTime_))}search_(e,t){let s;this.evt=t,s=M.utils.addParameters(this.url_,{input:e.trim(),limit:this.limit_,codine:this.locality_}),s=this.formatContent_(s," ","%20"),this.searchTime_=Date.now(),(e=>{M.remote.get(s).then(t=>{if(e===this.searchTime_){let e=JSON.parse(t.text);e=this.parseResultsForTemplate_(e);const s=this.map_.getControls();if(M.utils.isUndefined(e.docs))for(let e=0,t=s.length;e<t;e+=1)"searchstreet"===s[e].name?s[e].completed=!1:"searchstreetgeosearch"===s[e].name&&(s[e].ctrlSearchstreet.completed=!1);else if(M.utils.isUndefined(e.docs[0]))for(let e=0,t=s.length;e<t;e+=1)"searchstreet"===s[e].name?s[e].completed=!1:"searchstreetgeosearch"===s[e].name&&(s[e].ctrlSearchstreet.completed=!1);else{const t={jsonp:!0,vars:e};this.resultsContainer_.classList.contains(n.MINIMUM)&&(this.resultsContainer_.classList.remove(n.MINIMUM),M.utils.isNullOrEmpty(this.resultsContainer_.parentElement)||this.searchingResult_.parentElement.removeChild(this.searchingResult_));const i=M.template.compileSync(r.a,t);this.resultsContainer_.innerHTML=i.innerHTML;const a=this.resultsContainer_.querySelectorAll("div.autocomplete");if(this.addEvents_(a),this.target_.focus(),!0===this.busqMunicipio_)if(!0===this.busqMunicipioClick_){if(this.resultsContainer_.innerHTML="",!M.utils.isUndefined(this.evt)){for(let e=0,t=s.length;e<t;e+=1)"searchstreetgeosearch"===s[e].name?(s[e].ctrlSearchstreet.searchClick(this.evt),s[e].ctrlSearchstreet.completed=!1,s[e].ctrlGeosearch.searchClick(this.evt)):"searchstreet"===s[e].name&&(s[e].searchClick(this.evt),s[e].completed=!1);this.busqMunicipioClick_=!1}}else{const e=this.resultsContainer_.querySelectorAll("div.autocomplete");for(let t=0,i=s.length;t<i;t+=1)if("searchstreetgeosearch"===s[t].name)if(!0===s[t].ctrlSearchstreet.completed)s[t].ctrlSearchstreet.completed=!1,this.resultsContainer_.innerHTML="";else for(let t=0,s=e.length;t<s;t+=1)this.evtClickMunicipaly_(e[t]);else if("searchstreet"===s[t].name)if(!0===s[t].completed)s[t].completed=!1,this.resultsContainer_.innerHTML="";else for(let t=0,s=e.length;t<s;t+=1)this.evtClickMunicipaly_(e[t])}else for(let e=0,t=s.length;e<t;e+=1)"searchstreet"===s[e].name?!0===s[e].completed&&(this.resultsContainer_.innerHTML="",s[e].completed=!1):"searchstreetgeosearch"===s[e].name&&!0===s[e].ctrlSearchstreet.completed&&(this.resultsContainer_.innerHTML="",s[e].ctrlSearchstreet.completed=!1)}}})})(this.searchTime_)}evtClickMunicipaly_(e){e.addEventListener("click",()=>{this.clickMunicipaly_()})}parseResultsForTemplate_(e){let t=e.autocompletarDireccionMunicipioResponse.autocompletarDireccionMunicipioReturn.autocompletarDireccionMunicipioReturn;const s=[];if(!0===this.busqMunicipio_)if(M.utils.isUndefined(t))this.resultsContainer_.innerHTML="";else{t instanceof Array==!1&&(t=[t]);for(let e=0,i=t.length;e<i;e+=1){const i=t[e].split(",");s.push(`${i[0]} ${i[1]}, ${i[3]} (${i[i.length-1]})`)}t=s}else if(t instanceof Array==!1){if(s.push(t),t=s,!M.utils.isUndefined(t[0]))for(let e=0,s=t.length;e<s;e+=1)t[e]=this.formatContent_(t[e],","," ")}else for(let e=0,s=t.length;e<s;e+=1)t[e]=this.formatContent_(t[e],","," ");let i=null;return i={docs:t},i}addEvents_(e){e.forEach(e=>{this.addEventSearchMunicipality_(e)})}addEventSearchMunicipality_(e){e.addEventListener("click",t=>{if(this.target_.value=e.innerHTML.trim(),M.utils.isNullOrEmpty(this.locality_))this.searchMunicipality_(e.innerHTML,t);else{const e=this.map_.getControls();this.resultsContainer_.innerHTML="",e.forEach(e=>{const s=e;"searchstreet"===s.name?(s.searchClick(t),s.completed=!1):"searchstreetgeosearch"===s.name&&(s.ctrlSearchstreet.searchClick(t),s.ctrlSearchstreet.completed=!1,s.ctrlGeosearch.searchClick(t))})}})}searchMunicipality_(e,t){this.busqMunicipio_=!0,this.search_(e.trim()+",",t)}clickMunicipaly_(){this.busqMunicipioClick_=!0}formatContent_(e,t,s){return e.replace(new RegExp(t,"g"),s)}cancelSearch_(e){clearTimeout(this.timeoutKey_),this.minLength_<=this.target_.value.length&&13!==e.keyCode&&27!==e.keyCode?(M.utils.isNullOrEmpty(this.resultsContainer_.parentElement.querySelector("#m-searchstreet-results>div"))?this.resultsContainer_.classList.add("results-panel"):(this.resultsContainer_.classList.add("results-panel-content"),this.resultsContainer_.classList.remove("results-panel")),this.resultsContainer_.appendChild(this.searchingResult_),this.resultsContainer_.parentElement.classList.add(n.SEARCHING_CLASS),this.resultsContainer_.classList.add(n.MINIMUM)):(this.searchTime_=0,this.resultsContainer_.parentElement.classList.remove(n.SEARCHING_CLASS),this.resultsContainer_.classList.contains(n.MINIMUM)&&(this.resultsContainer_.classList.remove(n.MINIMUM),this.resultsContainer_.removeChild(this.searchingResult_),this.resultsContainer_.innerHTML=""))}destroy(){null!==this.map_&&(this.map_.removeControls(this),this.map_=null,this.locality_="",this.url_=null,this.minLength_=null,this.target_=null,this.resultsContainer_=null,this.delayTime_=null,this.timeoutKey_=null,this.limit_=null,this.searchTime_=null,this.busqMunicipio_=null,this.busqMunicipioClick_=null,this.searchingResult_=null)}equals(e){return e instanceof n}}n.CLASS="m-plugin-autocomplete",n.SEARCHING_CLASS="m-searching",n.RESULTAUTOCOMPLETE="resultautocomplete.html",n.MINIMUM="minimum",n.NAME="autocomplete";var a=s(7),l=(s(68),s(42));class o extends M.Plugin{constructor(e={}){super(),this.name="searchstreet",this.map_=null,this.control_=null,this.autocompletador_=null,this.panel_=null,this.url_=M.config.SEARCHSTREET_URL,this.locality_="",M.utils.isNullOrEmpty(e.locality)||(this.locality_=e.locality),this.metadata_=l.metadata}addTo(e){this.map_=e,e.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra");const t=M.utils.addParameters(M.config.SEARCHSTREET_URLCOMPROBARINE,{codigo:this.locality_});M.utils.isNullOrEmpty(t)||M.remote.get(t).then(e=>{let t;M.utils.isNullOrEmpty(e.text)||(t=JSON.parse(e.text),!M.utils.isNullOrEmpty(this.locality_)&&M.utils.isNullOrEmpty(t.comprobarCodIneResponse.comprobarCodIneReturn)&&(M.dialog.error(`El código del municipio '${this.locality}' no es válido`),this.locality_="")),this.control_=new a.a(this.url_,this.locality_),this.control_.on(M.evt.ADDED_TO_MAP,()=>{this.fire(M.evt.ADDED_TO_MAP),this.autocompletador_=new n({locality:this.locality_,target:this.control_.getInput(),html:this.control_.getHtml()}),this.map_.addPlugin(this.autocompletador_)},this),this.panel_=new M.ui.Panel("searchstreet",{collapsible:!0,className:"m-searchstreet",position:M.ui.position.TL,tooltip:"Buscador de calles"}),this.panel_.on(M.evt.ADDED_TO_MAP,e=>{this.panel_.getButtonPanel().addEventListener("click",e=>{this.panel_.collapsed||this.control_.getInput().focus()})}),this.panel_.addControls(this.control_),this.map_.addPanels(this.panel_)})}getControls(){const e=[];return e.push(this.control_),e}destroy(){this.map_.removeControls([this.control_]),this.map_.removePlugins(this.autocompletador_),this.name=null,this.map_=null,this.control_=null,this.autocompletador_=null,this.panel_=null,this.url_=null,this.locality_=null}equals(e){return e instanceof o}getAPIRest(){return"searchstreet"}getMetadata(){return this.metadata_}}null==window.M.plugin&&(window.M.plugin={}),window.M.plugin.Searchstreet=o},9:function(e,t){e.exports='<div class="m-searchstreet-content">\n   <div class="result">\n      <table>\n         <tr>\n            <td class="key">Tipo de Vía</td>\n            <td class="value">{{tVia}}</td>\n         </tr>\n         <tr>\n            <td class="key">Nombre de Vía</td>\n            <td class="value">{{nVia}}</td>\n         </tr>\n         <tr>\n            <td class="key">Número</td>\n            <td class="value">{{num}}</td>\n         </tr>\n         <tr>\n            <td class="key">Municipio</td>\n            <td class="value">{{mun}}</td>\n         </tr>\n         <tr>\n            <td class="key">Provincia</td>\n            <td class="value">{{prov}}</td>\n         </tr>\n      </table>\n   </div>\n</div>'}});