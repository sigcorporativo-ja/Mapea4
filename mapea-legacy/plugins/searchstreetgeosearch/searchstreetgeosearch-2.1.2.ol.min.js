!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=77)}({0:function(e,t,s){"use strict";class i{static init(){if(!1===i.initialized){i.initialized=!0;const e=document.createElement("img");e.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24.svg"]),e.width="24",e.height="24",e.crossOrigin="anonymous";const t=document.createElement("IMG");t.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-new.svg"]),t.width="24",t.height="24",t.crossOrigin="anonymous";const s=document.createElement("IMG");s.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-sel.svg"]),s.width="24",s.height="24",s.crossOrigin="anonymous",i.DEFAULT[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:e,imgSize:[24,24]})}),i.DEFAULT[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#A15BD7"}),stroke:new ol.style.Stroke({color:"#A15BD7",width:2})}),i.DEFAULT[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:e,imgSize:[24,24]})}),i.DEFAULT[M.geom.wkt.type.MULTI_POINT]=i.DEFAULT[M.geom.wkt.type.POINT],i.DEFAULT[M.geom.wkt.type.LINEAR_RING]=i.DEFAULT[M.geom.wkt.type.LINE_STRING],i.DEFAULT[M.geom.wkt.type.MULTI_LINE_STRING]=i.DEFAULT[M.geom.wkt.type.LINE_STRING],i.DEFAULT[M.geom.wkt.type.MULTI_POLYGON]=i.DEFAULT[M.geom.wkt.type.POLYGON],i.DEFAULT[M.geom.wkt.type.CIRCLE]=i.DEFAULT[M.geom.wkt.type.POLYGON],i.DEFAULT[M.geom.wkt.type.GEOMETRY_COLLECTION]=i.DEFAULT[M.geom.wkt.type.POLYGON],i.NEW[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:t,imgSize:[24,24]})}),i.NEW[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#e2951b"}),stroke:new ol.style.Stroke({color:"#e2951b",width:2})}),i.NEW[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:t,imgSize:[24,24]})}),i.NEW[M.geom.wkt.type.MULTI_POINT]=i.NEW[M.geom.wkt.type.POINT],i.NEW[M.geom.wkt.type.LINEAR_RING]=i.NEW[M.geom.wkt.type.LINE_STRING],i.NEW[M.geom.wkt.type.MULTI_LINE_STRING]=i.NEW[M.geom.wkt.type.LINE_STRING],i.NEW[M.geom.wkt.type.MULTI_POLYGON]=i.NEW[M.geom.wkt.type.POLYGON],i.NEW[M.geom.wkt.type.CIRCLE]=i.NEW[M.geom.wkt.type.POLYGON],i.NEW[M.geom.wkt.type.GEOMETRY_COLLECTION]=i.NEW[M.geom.wkt.type.POLYGON],i.SELECTED[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:s,imgSize:[24,24]})}),i.SELECTED[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#fcfcfc"}),stroke:new ol.style.Stroke({color:"#3589d1",width:2})}),i.SELECTED[M.geom.wkt.type.POLYGON]=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(240, 220, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#a15bd7",width:2})}),i.SELECTED[M.geom.wkt.type.MULTI_POINT]=i.SELECTED[M.geom.wkt.type.POINT],i.SELECTED[M.geom.wkt.type.LINEAR_RING]=i.SELECTED[M.geom.wkt.type.LINE_STRING],i.SELECTED[M.geom.wkt.type.MULTI_LINE_STRING]=i.SELECTED[M.geom.wkt.type.LINE_STRING],i.SELECTED[M.geom.wkt.type.MULTI_POLYGON]=i.SELECTED[M.geom.wkt.type.POLYGON],i.SELECTED[M.geom.wkt.type.CIRCLE]=i.SELECTED[M.geom.wkt.type.POLYGON],i.SELECTED[M.geom.wkt.type.GEOMETRY_COLLECTION]=i.SELECTED[M.geom.wkt.type.POLYGON]}}}i.DEFAULT={},i.NEW={},i.SELECTED={},i.initialized=!1;class r{static getCentroidCoordinate(e){let t,s,i,a,l,n;return e.getType()===M.geom.wkt.type.POINT?t=e.getCoordinates():e.getType()===M.geom.wkt.type.LINE_STRING||e.getType()===M.geom.wkt.type.LINEAR_RING?(s=e.getCoordinates(),i=Math.floor(s.length/2),t=s[i]):e.getType()===M.geom.wkt.type.POLYGON?t=r.getCentroidCoordinate(e.getInteriorPoint()):e.getType()===M.geom.wkt.type.MULTI_POINT?(a=e.getPoints(),i=Math.floor(a.length/2),t=r.getCentroidCoordinate(a[i])):e.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(l=e.getLineStrings(),i=Math.floor(l.length/2),t=r.getCentroidCoordinate(l[i])):e.getType()===M.geom.wkt.type.MULTI_POLYGON?(a=e.getInteriorPoints(),t=r.getCentroidCoordinate(a)):e.getType()===M.geom.wkt.type.CIRCLE?t=e.getCenter():e.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(n=e.getGeometries(),i=Math.floor(n.length/2),t=r.getCentroidCoordinate(n[i])),t}}var a=s(4),l=s.n(a);class n extends M.impl.layer.Vector{constructor(e="geosearch",t={}){const s=t;super(s),this.wktFormatter_=new ol.format.WKT,this.popup_=null,this.selectedFeatures_=[],s.displayInLayerSwitcher||(s.displayInLayerSwitcher=!1),this.name=e}addTo(e){super.addTo(e),this.ol3Layer.setSource(new ol.source.Vector({useSpatialIndex:!1}))}drawResults(e){const t=ol.proj.get(this.map.getProjection().code);let s=[];M.utils.isNullOrEmpty(e.spatial_response)||(s=e.spatial_response.docs),M.utils.isNullOrEmpty(s)&&(s=e.response.docs);const i=s.map(e=>{const s=this.wktFormatter_.readFeature(e.geom,{dataProjection:t});return s.setId(e.solrid),s.setProperties(e),n.setStyleFeature(s,M.style.state.DEFAULT),this.wrapComplexFeature_(s),M.impl.Feature.olFeature2Facade(s)},this);this.facadeVector_.addFeatures(i)}drawNewResults(e){const t=ol.proj.get(this.map.getProjection().code);let s;M.utils.isNullOrEmpty(e.spatial_response)?M.utils.isNullOrEmpty(e.response)||(s=e.response.docs):s=e.spatial_response.docs;const i=s.map(e=>{const s=this.wktFormatter_.readFeature(e.geom,{dataProjection:t});return s.setId(e.solrid),s.setProperties(e),n.setStyleFeature(s,M.style.state.NEW),M.impl.Feature.olFeature2Facade(s)},this);this.facadeVector_.addFeatures(i)}clear(e){this.map.removePopup(),this.facadeVector_.clear()}selectFeatures(e,t,s,i){let r=e;this.unselectFeatures(),this.selectedFeatures_=r,r=r.map(M.impl.Feature.facade2OLFeature),n.setStyleFeature(r,M.style.state.SELECTED);const a={jsonp:!0,vars:this.parseFeaturesForTemplate_(r),parseToHtml:!1},o={icon:"g-cartografia-pin",title:"Geosearch",content:M.template.compileSync(l.a,a)};let c=this.map.getPopup();M.utils.isNullOrEmpty(c)?(c=new M.Popup({panMapIfOutOfView:!i,ani:null}),c.addTab(o),this.map.addPopup(c,t)):c.addTab(o),c.on(M.evt.DESTROY,()=>{this.internalUnselectFeatures_(!0)},this)}selectFeatureBySolrid(e){const t=this.facadeVector_.getFeatureById(e);this.selectedFeatures_=[t];const s=t.getImpl().getOLFeature().getGeometry(),i=r.getCentroidCoordinate(s);this.unselectFeatures(),this.selectFeatures([t],i,null,!0),this.map.setBbox(s.getExtent())}parseFeaturesForTemplate_(e){const t={features:[]};return e.forEach(e=>{const s=["geom","_version_","keywords","solrid",e.getGeometryName()],i=e.getProperties(),r=[];Object.keys(i).forEach(e=>{M.utils.includes(s,e.toLowerCase())||r.push({key:M.utils.beautifyAttributeName(e),value:i[e]})});const a={solrid:e.getId(),attributes:r};t.features.push(a)}),t}wrapComplexFeature_(e){const t=e.getGeometry();if(t.getType()===M.geom.wkt.type.POLYGON||t.getType()===M.geom.wkt.type.MULTI_POLYGON){let s;s=t.getType()===M.geom.wkt.type.POLYGON?t.getInteriorPoint():t.getInteriorPoints();const i=new ol.geom.GeometryCollection([s,t]);e.setGeometry(i)}}unselectFeatures(e,t){this.internalUnselectFeatures_()}internalUnselectFeatures_(e){this.selectedFeatures_.length>0&&(n.setStyleFeature(this.selectedFeatures_.map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT),this.selectedFeatures_.length=0,e||this.map.removePopup())}setNewResultsAsDefault(){n.setStyleFeature(this.facadeVector_.getFeatures().map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT)}getCentroidCoordinate(e){let t,s,i,r,a,l;return e.getType()===M.geom.wkt.type.POINT?t=e.getCoordinates():e.getType()===M.geom.wkt.type.LINE_STRING||e.getType()===M.geom.wkt.type.LINEAR_RING?(s=e.getCoordinates(),i=Math.floor(s.length/2),t=s[i]):e.getType()===M.geom.wkt.type.POLYGON?t=this.getCentroidCoordinate(e.getInteriorPoint()):e.getType()===M.geom.wkt.type.MULTI_POINT?(r=e.getPoints(),i=Math.floor(r.length/2),t=this.getCentroidCoordinate(r[i])):e.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(a=e.getLineStrings(),i=Math.floor(a.length/2),t=this.getCentroidCoordinate(a[i])):e.getType()===M.geom.wkt.type.MULTI_POLYGON?(r=e.getInteriorPoints(),t=this.getCentroidCoordinate(r)):e.getType()===M.geom.wkt.type.CIRCLE?t=e.getCenter():e.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(l=e.getGeometries(),i=Math.floor(l.length/2),t=this.getCentroidCoordinate(l[i])),t}destroy(){const e=this.map.getMapImpl();M.utils.isNullOrEmpty(this.ol3Layer)||(e.removeLayer(this.ol3Layer),this.ol3Layer=null),this.map=null,this.wktFormatter_=null,this.popup_=null,this.selectedFeatures_=null,this.name=null}equals(e){let t=!1;return e instanceof n&&(t=this.url===e.url,t=t&&this.name===e.name),t}static setStyleFeature(e,t){let s=e;i.init(),M.utils.isArray(s)||(s=[s]),s.forEach(e=>{const s=e.getGeometry().getType();M.utils.isNullOrEmpty(t)||t===M.style.state.DEFAULT?e.setStyle(i.DEFAULT[s]):t===M.style.state.NEW?e.setStyle(i.NEW[s]):t===M.style.state.SELECTED&&e.setStyle(i.SELECTED[s])})}}n.POPUP_RESULT="geosearchfeaturepopup.html";class o extends M.layer.Vector{constructor(e={},t={},s=new n){super(e,t,{},s),M.utils.isUndefined(n)&&M.exception("La implementación usada no puede crear capas Geosearch"),this.displayInLayerSwitcher=!1}equals(e){return!1}}s.d(t,"a",(function(){return c}));class c extends M.impl.Control{constructor(e={}){super(),this.facadeMap_=null,this.helpHtml_=null,this.layer_=new o({name:e.layerName||"__geosearch_plugin_layer_name__"})}addTo(e,t){this.facadeMap_=e,e.addLayers(this.layer_),super.addTo(e,t)}unselectResults(e){this.layer_.getImpl().unselectFeatures(e)}setNewResultsAsDefault(){this.layer_.getImpl().setNewResultsAsDefault()}drawResults(e){this.layer_.getImpl().drawResults(e)}drawNewResults(e){this.layer_.getImpl().drawNewResults(e)}zoomToResults(){const e=ol.extent.boundingExtent(this.layer_.getImpl().getOLLayer().getSource().getFeatures().map(e=>ol.extent.getCenter(e.getGeometry().getExtent())));this.facadeMap_.setBbox(e)}getLayer(){return this.layer_}resultClick(e){this.layer_.getImpl().selectFeatureBySolrid(e)}hideHelp(){M.utils.isNullOrEmpty(this.helpHtml_)||(this.facadeMap_.getMapImpl().getTargetElement().removeChild(this.helpHtml_),this.helpHtml_=null)}showHelp(e){const t=this.facadeMap_.getMapImpl().getTargetElement();M.utils.isNullOrEmpty(this.helpHtml_)||t.removeChild(this.helpHtml_),this.helpHtml_=e,t.appendChild(this.helpHtml_)}clear(){this.layer_.clear()}destroy(){this.clear(),this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.remove("top-extra"),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.helpHtml_=null,this.layer_=null}}},1:function(e,t){e.exports='<div class="results-panels">\n   {{#if partial}}\n   <div class="partial">\n      <p>No se han encontrado resultados para la búsqueda.</p>\n      <p>A continuación se muestran otros resultados que quizás le interesen:...</p>\n   </div>\n   {{/if}}\n   <div class="results" id="m-geosearch-results-scroll">\n      {{#each docs}}\n      <div id="{{solrid}}" class="result">\n         {{#each attributes}}\n         <table>\n            <tbody>\n               <tr>\n                  <td class="key">{{key}}</td>\n                  <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n               </tr>\n            </tbody>\n         </table>\n         {{/each}}\n      </div>\n      {{/each}}\n   </div>\n   {{#eq docs.length 0}}\n   <div class="results">\n      <div class="partial">No se han encontrado resultados para la búsqueda "{{query}}".</div>\n   </div>\n   {{/eq}}\n   <div class="page">\n      <span class="found" id="m-geosearch-page-found">{{docs.length}}</span> de <span class="total">{{total}}</span>\n      <div class="g-cartografia-flecha-arriba"></div>\n   </div>\n</div>'},10:function(e,t){e.exports='<div class="m-control m-searchstreet-container">\n   <span id="codIne"></span>\n   \x3c!-- search panel --\x3e\n   <div class="search-panel">\n      <input type="text" id="m-searchstreet-search-input" placeholder="Buscar" class="m-input-search" />\n      <button type="button" id="m-searchstreet-search-btn" class="g-cartografia-zoom m-search-btn" title="Buscar"></button>\n      <button type="button" id="m-searchstreet-clear-btn" class="g-cartografia-cancelar m-clear-btn"title="Limpiar búsqueda"></button>\n   </div>\n   \x3c!-- results autocomplete --\x3e\n   <div class="results-panel-content" id="m-autocomplete-results">\n       <div id="m-searching-result-autocomplete" class="m-searching-result g-cartografia-spinner"></div>\n   </div>\n   \x3c!-- results panel --\x3e\n   <div class="results-panel" id="m-searchstreet-results">\n      <div id="m-searching-result-searchstreet" class="m-searching-result g-cartografia-spinner"></div>\n   </div>\n</div>\n'},11:function(e,t){e.exports='<div class="results-panels">\n   {{#if containtResult}}\n   <div class="results" id="m-searchstreet-results-scroll">\n      {{#each docs}}\n      <div class="result">\n         <table>\n            <tbody>\n               <tr>\n                  <td>{{streetType}} {{streetName}}, {{streetNumber}}</td>\n               </tr>\n               <tr>\n                  <td>{{localityName}} ({{cityName}})</td>\n               </tr>\n            </tbody>\n         </table>\n      </div>\n      {{/each}}\n   </div>\n   {{else}}\n   <div class="results">\n   <span class="partial">No se han encontrado resultados\n\t\tpara la búsqueda "{{search}}".</span>\n   </div>\n   {{/if}}\n   <div class="page">\n      <span class="found" id="m-searchstreet-page-found">Resultados encontrados:</span>\n   {{#if containtResult}}\n <span class="total">{{docs.length}} en total.</span>\n{{else}}\n <span class="total">0 en total.</span>\n{{/if}}\n      <div class="g-cartografia-flecha-arriba"></div>\n   </div>\n</div> \n'},2:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var i=s(0),r=s(5),a=s.n(r),l=s(1),n=s.n(l),o=s(6),c=s.n(o);class h extends M.Control{constructor(e,t,s,r,a){super(new i.a,h.NAME),M.utils.isUndefined(i.a)&&M.exception("La implementación usada no puede crear controles Geosearch"),this.input_=null,this.element_=null,this.resultsContainer_=null,this.resultsScrollContainer_=null,this.searchingResult_=null,this.searchTime_=0,this.url_=e,this.core_=t,this.handler_=s,this.searchUrl_=M.utils.concatUrlPaths([this.url_,this.core_,this.handler_]),this.helpUrl_=M.utils.concatUrlPaths([this.url_,this.core_,"/help"]),this.searchParameters_=r,M.utils.isNullOrEmpty(this.searchParameters_)||(M.utils.isNullOrEmpty(this.searchParameters_.rows)&&(this.searchParameters_.rows=M.config.GEOSEARCH_ROWS),this.searchUrl_=M.utils.addParameters(this.searchUrl_,this.searchParameters_)),this.results_=[],this.showHelp_=a,this.scrollIsUp_=!0,this.spatialSearch_=!1,this.facadeMap_=null}createView(e){this.facadeMap_=e;const t=M.template.compileSync(a.a,{jsonp:!0});return!1===this.showHelp_&&t.querySelector("#m-geosearch-help-btn").classList.add("m-hidden"),this.addEvents(t),t}addEvents(e){this.element_=e,this.on(M.evt.COMPLETED,()=>{this.element_.classList.add("shown")},this),this.input_=this.element_.getElementsByTagName("input")["m-geosearch-search-input"],this.input_.addEventListener("keyup",this.searchClick.bind(this));this.element_.getElementsByTagName("button")["m-geosearch-search-btn"].addEventListener("click",this.searchClick.bind(this));const t=this.element_.getElementsByTagName("button")["m-geosearch-help-btn"];t&&t.addEventListener("click",e=>{e.preventDefault(),t.classList.toggle("shown"),this.helpClick_()});this.element_.getElementsByTagName("button")["m-geosearch-clear-btn"].addEventListener("click",this.clearClick_.bind(this)),this.resultsContainer_=this.element_.querySelector("div#m-geosearch-results"),M.utils.enableTouchScroll(this.resultsContainer_),this.searchingResult_=this.element_.querySelector("div#m-geosearch-results > div#m-searching-result")}addEventsHelp(e){this.element_=e;this.element_.getElementsByTagName("button")["m-geosearch-closeHelp-btn"].addEventListener("click",this.closeHelpClick_.bind(this))}searchClick(e){if(e.preventDefault(),"keyup"!==e.type||13===e.keyCode){this.results_.length=0;const e=this.input_.value;M.utils.isNullOrEmpty(e)?M.dialog.info("Debe introducir una búsqueda."):this.search_(e,this.showResults_)}}resultClick_(e){const t=e;if(t.preventDefault(),M.window.WIDTH<=M.config.MOBILE_WIDTH){this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba").click()}this.facadeMap_.removePopup();const s=t.currentTarget.id;this.getImpl().resultClick(s)}search_(e,t){this.resultsContainer_.appendChild(this.searchingResult_),this.searchTime_=Date.now(),this.element_.classList.add(h.SEARCHING_CLASS);const s=M.utils.addParameters(this.searchUrl_,{q:e,start:this.results_.length,srs:this.facadeMap_.getProjection().code});(e=>{M.remote.get(s).then(s=>{if(e===this.searchTime_){let e;try{e=JSON.parse(s.text)}catch(e){M.exception("La respuesta no es un JSON válido: "+e)}t.call(this,e),this.element_.classList.remove(h.SEARCHING_CLASS)}})})(this.searchTime_)}showResults_(e){this.getImpl().clear(),this.drawResults(e);const t={jsonp:!0,vars:this.parseResultsForTemplate_(e)},s=M.template.compileSync(n.a,t);this.resultsContainer_.classList.remove(h.HIDDEN_RESULTS_CLASS),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_);let i,r=this.resultsContainer_.querySelectorAll(".result");for(let e=0,t=r.length;e<t;e+=1)i=r.item(e),i.removeEventListener("click",this.resultClick_.bind(this));e.response.docs.length>0&&this.zoomToResults();let a=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba");M.utils.isNullOrEmpty(a)||a.removeEventListener("click",this.resultsClick_.bind(this)),this.resultsContainer_.innerHTML=s.innerHTML,this.resultsScrollContainer_=this.resultsContainer_.querySelector("div#m-geosearch-results-scroll"),M.utils.enableTouchScroll(this.resultsScrollContainer_),this.resultsScrollContainer_.addEventListener("scroll",this.resultsScroll_.bind(this)),r=this.resultsContainer_.getElementsByClassName("result");for(let e=0,t=r.length;e<t;e+=1)i=r.item(e),i.addEventListener("click",this.resultClick_.bind(this));a=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba"),a.addEventListener("click",this.resultsClick_.bind(this)),this.checkScrollSearch_(e),this.fire(M.evt.COMPLETED)}drawResults(e){this.getImpl().drawResults(e)}drawNewResults(e){this.getImpl().drawNewResults(e)}zoomToResults(){this.getImpl().zoomToResults()}getInput(){return this.input_}appendResults_(e){this.drawNewResults(e);const t={jsonp:!0,vars:this.parseResultsForTemplate_(e,!0)},s=M.template.compileSync(n.a,t).getElementsByTagName("div")["m-geosearch-results-scroll"].children;for(let e=0;e<s.length;e+=1){const t=s.item(e);this.resultsScrollContainer_.appendChild(t),t.addEventListener("click",e=>this.resultClick_(e))}this.resultsContainer_.getElementsByTagName("span")["m-geosearch-page-found"].innerHTML=this.results_.length,this.checkScrollSearch_(e)}resultsScroll_(e){const t=e.target,s=t.offsetHeight,i=t.scrollHeight-t.scrollTop-s<=15;i&&this.scrollIsUp_?(this.scrollIsUp_=!1,this.scrollSearch_()):i||(this.scrollIsUp_=!0)}scrollSearch_(){this.getImpl().unselectResults(!0),this.getImpl().setNewResultsAsDefault();const e=this.input_.value;this.search_(e,this.appendResults_)}helpClick_(e){!0===this.helpShown_?(this.getImpl().hideHelp(),this.helpShown_=!1):M.remote.get(this.helpUrl_).then(e=>{let t;try{t=JSON.parse(e.text)}catch(e){M.Exception("La respuesta no es un JSON válido: "+e)}const s={jsonp:!0,vars:{entities:t}},i=M.template.compileSync(c.a,s);this.addEventsHelp(i),this.getImpl().showHelp(i),this.helpShown_=!0})}closeHelpClick_(e){!0===this.helpShown_&&(this.getImpl().hideHelp(),this.helpShown_=!1)}clearClick_(e){this.element_.classList.remove("shown"),M.utils.isNullOrEmpty(this.input_)||(this.input_.value=""),M.utils.isNullOrEmpty(this.resultsContainer_)||(this.resultsContainer_.innerHTML=""),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||(this.resultsScrollContainer_.innerHTML="",this.resultsScrollContainer_=null),this.results_.length=0,this.resultsContainer_.classList.remove(h.HIDDEN_RESULTS_CLASS),this.getImpl().clear(),this.getImpl().hideHelp(),this.spatialSearch_=!1}resultsClick_(e){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra-search"),e.target.classList.toggle("g-cartografia-flecha-arriba"),e.target.classList.toggle("g-cartografia-flecha-abajo"),this.resultsContainer_.classList.toggle(h.HIDDEN_RESULTS_CLASS)}equals(e){let t=!1;return e instanceof h&&(t=this.name===e.name),t}parseResultsForTemplate_(e,t){let s="";M.utils.isNullOrEmpty(this.input_)||(s=this.input_.value);let i=0;M.utils.isUndefined(e.spatial_response)?(i=e.response.numFound,this.spatialSearch_=!1):(i=e.spatial_response.numFound,this.spatialSearch_=!0);const r=this.getDocsFromResults_(e);this.results_=!0===t?this.results_.concat(r):r;const a=this.spatialSearch_&&M.utils.isNullOrEmpty(e.spatial_response.docs);let l=null;return l=0!==i?{docs:r,total:i,partial:a}:{docs:r,total:i,notResutls:!0,query:s},l}getDocsFromResults_(e){let t=[];t=this.spatialSearch_?e.spatial_response.docs:e.response.docs;const s=["geom","_version_","keywords","solrid"];return t=t.map(e=>{const t=[];return Object.keys(e).forEach(i=>{M.utils.includes(s,i)||t.push({key:M.utils.beautifyAttributeName(i),value:e[i]})}),{solrid:e.solrid,attributes:t}}),t}checkScrollSearch_(e){let t=0;t=M.utils.isUndefined(e.spatial_response)?e.response.numFound:e.spatial_response.numFound,this.results_.length!==t||M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_)}}h.NAME="geosearch",h.TEMPLATE="geosearch.html",h.RESULTS_TEMPLATE="geosearchresults.html",h.HELP_TEMPLATE="geosearchhelp.html",h.SEARCHING_CLASS="m-searching",h.HIDDEN_RESULTS_CLASS="hidden"},3:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var i=s(9),r=s.n(i);class a extends M.impl.Control{constructor(){super(),this.facadeMap_=null,this.listPoints=[],this.element_=null}addTo(e,t){this.facadeMap_=e,this.element_=t,super.addTo(e,t)}drawPoints(e){let t=null;for(let s=0,i=e.length;s<i;s+=1){t=new ol.Feature,t.setStyle(new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"#3399CC"}),stroke:new ol.style.Stroke({color:"#fff",width:2})})})),t.setGeometry(null!==e[s].coordinateX&&null!==e[s].coordinateY?new ol.geom.Point([e[s].coordinateX,e[s].coordinateY]):null);const i=e[s];this.addEventClickFeature(i,t),this.facadeMap_.drawFeatures([M.impl.Feature.olFeature2Facade(t)]),this.listPoints.push([t])}this.zoomResults()}zoomResults(){const e=this.listPoints[0],t=ol.extent.boundingExtent(e.filter(e=>!M.utils.isNullOrEmpty(e.getGeometry())).map(e=>e.getGeometry().getFirstCoordinate()));this.facadeMap_.setBbox(t)}addEventClickFeature(e,t){this.facadeMap_.removePopup(),M.utils.isNullOrEmpty(t)?(this.showPopup(e,!1),this.facadeMap_.setBbox([e.coordinateX,e.coordinateY,e.coordinateX,e.coordinateY])):t instanceof ol.Feature&&t.set("vendor",{mapea:{click:t=>{this.showPopup(e,!1)}}})}showPopup(e,t){const s={jsonp:!0,vars:{tVia:e.streetType,nVia:e.streetName,num:e.streetNumber,mun:e.localityName,prov:e.cityName},parseToHtml:!1},i={icon:"g-cartografia-zoom",title:"Searchstreet",content:M.template.compileSync(r.a,s)};if(this.popup_=this.facadeMap_.getPopup(),M.utils.isNullOrEmpty(this.popup_))M.utils.isUndefined(t)?this.popup_=new M.Popup:this.popup_=new M.Popup({panMapIfOutOfView:t}),this.popup_.addTab(i),this.facadeMap_.addPopup(this.popup_,[e.coordinateX,e.coordinateY]);else{this.popup_.getTabs().some(e=>"Searchstreet"!==e.title)?this.popup_.addTab(i):(this.facadeMap_.removePopup(),M.utils.isUndefined(t)?this.popup_=new M.Popup:this.popup_=new M.Popup({panMapIfOutOfView:t}),this.popup_.addTab(i),this.facadeMap_.addPopup(this.popup_,[e.coordinateX,e.coordinateY]))}}getElement(){return this.element_}destroy(){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.remove("top-extra"),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_.getImpl().removePopup(),this.facadeMap_=null,this.listPoints=null,this.element_=null}}a.POPUP_TEMPLATE="searchstreetpopup.html"},4:function(e,t){e.exports='<div class="m-geosearch-content">\n   {{#each features}}\n   <div id="{{solrid}}" class="result">\n      {{#each attributes}}\n      <table>\n         <tr>\n            <td class="key">{{key}}</td>\n            <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n         </tr>\n      </table>\n      {{/each}}\n   </div>\n   <div class="m-separator"></div>\n   {{/each}}\n</div>'},43:function(e,t){e.exports='<div class="results-panels">\n   <div class="results" id="m-autcomplete">\n      {{#each docs}}\n      <div class="result autocomplete">\n       {{this}}\n      </div>\n      {{/each}}\n   </div>\n</div>\n\n\n'},44:function(e,t){e.exports='<div class="m-control m-searchstreetgeosearch-container">\n   <span id="codIne"></span>\n   \x3c!-- search panel --\x3e\n   <div class="search-panel">\n      <input type="text" id="m-searchstreetgeosearch-search-input" placeholder="Buscar" class="m-input-search" />\n      <button type="button" id="m-searchstreetgeosearch-search-btn" class="g-cartografia-zoom m-search-btn" title="Buscar"></button>\n      <button type="button" id="m-searchstreetgeosearch-help-btn" class="g-cartografia-ayuda m-help-btn" title="Ayuda"></button>\n      <button type="button" id="m-searchstreetgeosearch-clear-btn" class="g-cartografia-cancelar m-clear-btn" title="Limpiar búsqueda"></button>\n   </div>\n\n   \x3c!-- results autocomplete searchstreet--\x3e\n   <div class="results-panel-content" id="m-autocomplete-results">\n      <div id="m-searching-result-autocomplete" class="m-searching-result g-cartografia-spinner"></div>\n   </div>\n\n   <div class="m-tab-results">\n      <ul id="m-tabs" class="group">\n         <li><a href="#" class="activated">Searchstreet</a></li>\n         <li><a href="#">Geosearch</a></li>\n      </ul>\n\n      <div id="m-tabs-content">\n         \x3c!-- results searchtreet --\x3e\n         <div id="m-searchstreet-results" class="m-searchstreet-tab m-tabcontent results-panel show">\n            <div id="m-searching-result-searchstreet" class="m-searching-result g-cartografia-spinner"></div>\n         </div>\n         \x3c!-- results geosearch --\x3e\n         <div id="m-geosearch-results" class="m-geosearch-tab m-tabcontent results-panel">\n            <div id="m-searching-result-geosearch" class="m-searching-result g-cartografia-spinner"></div>\n         </div>\n      </div>\n   </div>\n</div>\n'},45:function(e){e.exports=JSON.parse('{"url":{"name":"searchstreetgeosearch"},"constructor":"M.plugin.SearchstreetGeosearch","parameters":[{"type":"object","properties":[{"type":"simple","name":"locality","position":0}]}],"files":{"ol":{"scripts":["searchstreetgeosearch-2.1.2.ol.min.js"],"styles":["searchstreetgeosearch-2.1.2.min.css"]}},"metadata":{"uuid_plugin":"","uuid_version_plugin":"","version_ficha_metadatos":"","name":"SearchstreetGeosearch","description":"","text":"","version":"2.1.2","date":"03/02/2020","author":"Junta de Andalucía","org":"Junta de Andalucía","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","buttons":[{"title":"","description":"","querySelector":""},{"title":"","description":"","querySelector":""}],"dependencies":{"modules":["",""],"plugins":[{"uuid":"","name":""}],"services":[{"name":"","description":""}]},"compatibility":["4","5","6"]}}')},5:function(e,t){e.exports='<div class="m-control m-geosearch-container">\n  \x3c!-- search panel --\x3e\n  <div class="search-panel">\n    <input type="text" id="m-geosearch-search-input" placeholder="Buscar" class="m-input-search" />\n    <button id="m-geosearch-search-btn" class="g-cartografia-zoom m-search-btn" title="Buscar"></button>\n    <button id="m-geosearch-help-btn" class="g-cartografia-ayuda m-help-btn" title="Ayuda"></button>\n    <button id="m-geosearch-clear-btn" class="g-cartografia-cancelar m-clear-btn" title="Limpiar búsqueda"></button>\n  </div>\n  \x3c!-- results panel --\x3e\n  <div class="results-panel" id="m-geosearch-results">\n    <div id="m-searching-result" class="m-searching-result g-cartografia-spinner"></div>\n  </div>\n</div>'},6:function(e,t){e.exports='<div class="m-geosearch-help">\n  {{#eq entities.length 0}}\n    <div class="entity">\n      <p>El servicio no tiene ayuda configurada</p>\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar" title="Cerrar ayuda"></button>\n    </div>\n  {{/eq}}\n  {{#each entities}}\n    <div class="entity">\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar m-clear-btn" title="Cerrar ayuda"></button>\n      <div class="name">{{entity}}</div>\n      <div class="info">{{info}}</div>\n      <ul class="keywords">\n        {{#each keywords}}\n          <li>{{this}}</li>\n        {{/each}}\n      </ul>\n      <div class="example">\n        <code>{{example}}</code>\n      </div>\n    </div>\n  {{/each}}\n</div>'},7:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s(3),r=s(10),a=s.n(r),l=s(11),n=s.n(l);class o extends M.Control{constructor(e,t){super(new i.a,o.NAME),M.utils.isUndefined(i.a)&&M.exception("La implementación usada no puede crear controles Searchstreet"),this.input_=null,this.button_=null,this.element_=null,this.resultsContainer_=null,this.searchTime_=0,this.name_="searchstreet",this.searchUrl_=e,this.municipio_=null,this.provincia_=null,this.provincias_=[{nombre:"Huelva",codigoINE:"21"},{nombre:"Sevilla",codigoINE:"41"},{nombre:"Córdoba",codigoINE:"14"},{nombre:"Jaén",codigoINE:"23"},{nombre:"Cádiz",codigoINE:"11"},{nombre:"Málaga",codigoINE:"29"},{nombre:"Granada",codigoINE:"18"},{nombre:"Almería",codigoINE:"04"}],M.utils.isUndefined(t)||(this.codIne_=t,this.searchCodIne_=M.config.SEARCHSTREET_URLCOMPROBARINE),this.minAutocomplete_=M.config.AUTOCOMPLETE_MINLENGTH,this.facadeMap_=null,this.resultsAutocomplete_=null,this.completed=!1,this.respuestasProvincias_=[],this.contadorProvincias=0,this.resultsScrollContainer_=null}createView(e){this.facadeMap_=e;const t=M.template.compileSync(a.a,{jsonp:!0});return this.addEvents(t),t}addEvents(e){if(this.element_=e,this.on(M.evt.COMPLETED,()=>{this.element_.classList.add("shown")},this),this.input_=this.element_.getElementsByTagName("input")["m-searchstreet-search-input"],this.button_=this.element_.getElementsByTagName("button")["m-searchstreet-search-btn"],this.clear_=this.element_.getElementsByTagName("button")["m-searchstreet-clear-btn"],this.button_.addEventListener("click",this.searchClick.bind(this)),this.input_.addEventListener("keyup",this.searchClick.bind(this)),this.clear_.addEventListener("click",this.clearSearchs_.bind(this)),this.resultsContainer_=this.element_.getElementsByTagName("div")["m-searchstreet-results"],this.resultsAutocomplete_=this.element_.getElementsByTagName("div")["m-autocomplete-results"],this.searchingResult_=this.element_.querySelector("div#m-searchstreet-results > div#m-searching-result-searchstreet"),!M.utils.isUndefined(this.codIne_)&&!M.utils.isNullOrEmpty(this.codIne_)){const e=M.utils.addParameters(this.searchCodIne_,{codigo:this.codIne_});M.remote.get(e).then(e=>{let t;try{M.utils.isNullOrEmpty(e.text)||(t=JSON.parse(e.text),M.utils.isNullOrEmpty(t.comprobarCodIneResponse.comprobarCodIneReturn)?M.dialog.error(`El código del municipio '${this.codIne_}' no es válido`):(this.getMunProv_(t),this.element_.getElementsByTagName("span").codIne.innerHTML=`Búsquedas en ${this.municipio_}  (${this.provincia_})`))}catch(e){M.exception("La respuesta no es un JSON válido: "+e)}})}this.searchingResult_.parentNode.removeChild(this.searchingResult_)}getMunProv_(e){this.provincia_=e.comprobarCodIneResponse.comprobarCodIneReturn.comprobarCodIneReturn.nombreProvincia,this.municipio_=e.comprobarCodIneResponse.comprobarCodIneReturn.comprobarCodIneReturn.nombreMunicipio}searchClick(e){if(e.preventDefault(),"keyup"!==e.type){this.resultsAutocomplete_.classList.remove(o.MINIMUM),this.resultsAutocomplete_.innerHTML="";let e=this.input_.value;if(M.utils.isNullOrEmpty(e))M.dialog.error("Debe introducir una búsqueda.");else if(e.length<this.minAutocomplete_?this.completed=!1:this.completed=!0,M.utils.isUndefined(this.codIne_)||M.utils.isNullOrEmpty(this.codIne_))this.search_(e,this.showResults_);else{const t=e.indexOf(",");e.indexOf(",")>-1&&(e=e.substring(0,t)),this.search_(`${e}, ${this.municipio_} , (${this.provincia_})`,this.showResults_)}}}search_(e,t){this.resultsContainer_.innerHTML=" ";let s=null;this.provincia_=null,this.municipio_=null,this.resultsContainer_.appendChild(this.searchingResult_),this.element_.classList.add(o.SEARCHING_CLASS),this.resultsContainer_.classList.add(o.MINIMUM);const i=M.utils.addParameters(M.config.SEARCHSTREET_NORMALIZAR,{cadena:e});M.remote.get(i).then(e=>{const i=JSON.parse(e.text).normalizarResponse.normalizarReturn;if(this.provincia_=M.utils.beautifyString(i.provincia),this.municipio_=M.utils.beautifyString(i.municipio),M.utils.isNullOrEmpty(this.provincia_))if(M.utils.isNullOrEmpty(this.provincia_)&&!M.utils.isNullOrEmpty(this.municipio_)){this.searchTime_=Date.now(),this.respuestasProvincias_=[],this.contadorProvincias=0;for(let e=0,r=this.provincias_.length;e<r;e+=1)s=M.utils.addParameters(this.searchUrl_,{streetname:i.nombreVia,streetNumber:i.numeroPortal,streetType:i.tipoVia,municipio:this.municipio_,provincia:this.provincias_[e].nombre,srs:this.facadeMap_.getProjection().code}),this.querySearchProvinces(s,this.provincias_[e].nombre,t)}else s=M.utils.addParameters(this.searchUrl_,{streetname:i.direccionSinNormalizar,streetNumber:null,streetType:null,municipio:null,provincia:null,srs:this.facadeMap_.getProjection().code}),this.searchTime_=Date.now(),this.querySearch_(s,null,t);else s=M.utils.addParameters(this.searchUrl_,{streetname:i.nombreVia,streetNumber:i.numeroPortal,streetType:i.tipoVia,municipio:this.municipio_,provincia:this.provincia_,srs:this.facadeMap_.getProjection().code}),this.searchTime_=Date.now(),this.querySearch_(s,this.provincia_,t)})}querySearch_(e,t,s){(i=>{M.remote.get(e).then(e=>{if(i===this.searchTime_){let i;try{i=M.utils.isNullOrEmpty(e.text)||-1!==e.text.indexOf("No se ha podido obtener el codigoINE")?null:JSON.parse(e.text)}catch(e){M.exception("La respuesta no es un JSON válido: "+e)}M.utils.isNullOrEmpty(i)?(s.call(this,i),this.element_.classList.remove(o.SEARCHING_CLASS),this.resultsContainer_.classList.remove(o.MINIMUM)):(this.provincia_=M.utils.beautifyString(t),s.call(this,i),this.element_.classList.remove(o.SEARCHING_CLASS),this.resultsContainer_.classList.remove(o.MINIMUM))}})})(this.searchTime_)}querySearchProvinces(e,t,s){(i=>{M.remote.get(e).then(e=>{if(this.respuestasProvincias_.push(e),this.contadorProvincias+=1,8===this.contadorProvincias)for(let e=0,r=this.respuestasProvincias_.length;e<r;e+=1)if(i===this.searchTime_){let i;try{const t=this.respuestasProvincias_[e].text;i=M.utils.isNullOrEmpty(t)||-1!==t.indexOf("No se ha podido obtener el codigoINE")?null:JSON.parse(t)}catch(e){M.exception("La respuesta no es un JSON válido: "+e)}M.utils.isNullOrEmpty(i)||0===i.geocoderMunProvSrsResponse.geocoderMunProvSrsReturn.geocoderMunProvSrsReturn.coordinateX||(this.provincia_=M.utils.beautifyString(t),s.call(this,i),this.element_.classList.remove(o.SEARCHING_CLASS),this.resultsContainer_.classList.remove(o.MINIMUM))}})})(this.searchTime_)}showResults_(e){const t=this.parseResultsForTemplate_(e);if(!M.utils.isUndefined(this.codIne_))for(let e=0,s=t.docs.length;e<s;e+=1)M.utils.isUndefined(t.docs[e])||void 0===t.docs[e].coordinateX&&(t.docs.splice(e,1),s-=1,e-=1);const s={jsonp:!0,vars:t},i=M.template.compileSync(n.a,s);if(this.resultsContainer_.classList.remove(o.HIDDEN_RESULTS_CLASS),this.resultsContainer_.innerHTML=i.innerHTML,this.resultsScrollContainer_=this.resultsContainer_.querySelector("div#m-searchstreet-results-scroll"),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||M.utils.enableTouchScroll(this.resultsScrollContainer_),this.facadeMap_.removePopup(),this.getImpl().listPoints.length>0){const e=this.facadeMap_.getLayers().filter(e=>"__draw__"===e.name)[0];e.removeFeatures(e.getFeatures())}M.utils.isUndefined(t.docs[0])||(this.getImpl().drawPoints(t.docs),this.eventList_(t.docs)),this.element_.classList.remove(o.SEARCHING_CLASS),this.resultsContainer_.classList.remove(o.MINIMUM);this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba").addEventListener("click",this.resultsClick_.bind(this)),this.fire(M.evt.COMPLETED),this.element_.getElementsByClassName("m-autocomplete-results").innerHTML=""}parseResultsForTemplate_(e){let t=null,s=null;const i=e,r=this.input_.value;if(M.utils.isNullOrEmpty(i))t={docs:[void 0],containtResult:s,search:r};else{const e=i.geocoderMunProvSrsResponse.geocoderMunProvSrsReturn;if(s=!M.utils.isNullOrEmpty(e),e.geocoderMunProvSrsReturn instanceof Array)if(M.utils.isUndefined(e.geocoderMunProvSrsReturn[0].coordinateX))t={docs:[void 0],containtResult:!1,search:r};else{for(let t=0,s=e.geocoderMunProvSrsReturn.length;t<s;t+=1)e.geocoderMunProvSrsReturn[t].localityName=this.municipio_,e.geocoderMunProvSrsReturn[t].cityName=this.getNameProvince(e.geocoderMunProvSrsReturn[t].locality),e.geocoderMunProvSrsReturn[t].streetType=M.utils.beautifyString(e.geocoderMunProvSrsReturn[t].streetType),e.geocoderMunProvSrsReturn[t].streetName=M.utils.beautifyString(e.geocoderMunProvSrsReturn[t].streetName);t={docs:e.geocoderMunProvSrsReturn,containtResult:s,search:r}}else M.utils.isNullOrEmpty(e)?t={docs:[void 0],containtResult:s,search:r}:0===e.geocoderMunProvSrsReturn.coordinateX?t={docs:[void 0],containtResult:!1,search:r}:(e.geocoderMunProvSrsReturn.localityName=this.municipio_,e.geocoderMunProvSrsReturn.cityName=this.getNameProvince(e.geocoderMunProvSrsReturn.locality),e.geocoderMunProvSrsReturn.streetType=M.utils.beautifyString(e.geocoderMunProvSrsReturn.streetType),e.geocoderMunProvSrsReturn.streetName=M.utils.beautifyString(e.geocoderMunProvSrsReturn.streetName),t={docs:[e.geocoderMunProvSrsReturn],containtResult:s,search:r})}return t}getNameProvince(e){let t=e.toString();t.length<5&&(t="0"+t);const s=t.substr(0,2);return this.provincias_.filter(e=>e.codigoINE===s)[0].nombre}eventList_(e){const t=this.resultsContainer_.getElementsByClassName("result");for(let s=0,i=t.length;s<i;s+=1)this.addEventClickList_(t[s],e[s])}addEventClickList_(e,t){e.addEventListener("click",e=>{M.window.WIDTH<=M.config.MOBILE_WIDTH&&this.resultsClick_(Object.create({target:this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba")})),this.getImpl().addEventClickFeature(t)},!1,this)}equals(e){let t=!1;return e instanceof o&&(t=this.name===e.name),t}getInput(){return this.input_}getHtml(){return this.element_}clearSearchs_(){this.element_.classList.remove("shown"),this.facadeMap_.removePopup();const e=this.facadeMap_.getLayers().filter(e=>"__draw__"===e.name)[0];e.removeFeatures(e.getFeatures()),this.input_.value="",this.resultsContainer_.innerHTML="",this.resultsAutocomplete_.innerHTML=""}resultsClick_(e){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra-search"),e.target.classList.toggle("g-cartografia-flecha-arriba"),e.target.classList.toggle("g-cartografia-flecha-abajo"),this.resultsContainer_.classList.toggle(o.HIDDEN_RESULTS_CLASS)}}o.NAME="searchstreet",o.TEMPLATE="searchstreet.html",o.RESULTS_TEMPLATE="searchstreetresults.html",o.SEARCHING_CLASS="m-searching",o.HIDDEN_RESULTS_CLASS="hidden",o.MINIMUM="minimum"},70:function(e,t,s){},77:function(e,t,s){"use strict";s.r(t);s(70);var i=s(43),r=s.n(i);class a extends M.Plugin{constructor(e={}){super(),this.map_=null,this.name=a.NAME,this.locality_="",M.utils.isNullOrEmpty(e.locality)||(this.locality_=e.locality),this.url_=M.config.SEARCHSTREET_URLCODINEAUTOCOMPLETE,this.minLength_=M.config.AUTOCOMPLETE_MINLENGTH,this.target_=e.target,this.resultsContainer_=e.html.querySelector("div#m-autocomplete-results"),this.target_.addEventListener("keydown",e=>{const t=this.resultsContainer_.querySelectorAll("div.autocomplete");let s=this.resultsContainer_.querySelector(".selected");if(13===e.keyCode){const t=this.map_.getControls();for(let i=0;i<t.length;i+=1)"searchstreet"===t[i].name?this.controls[i].indexOf(",")<0?this.searchMunicipality_(this.controls[1]):(t[i].searchClick(e),t[i].completed=!1):"searchstreetgeosearch"===t[i].name&&(!M.utils.isNullOrEmpty(s)&&e.target.value.indexOf(",")<0?this.searchMunicipality_(e.target.value):(t[i].ctrlSearchstreet.searchClick(e),t[i].ctrlSearchstreet.completed=!1,t[i].ctrlGeosearch.searchClick(e)));s=null}else if(t.length>0){let i=-1;for(let e=0;e<t.length;e+=1)t[e].classList.contains("selected")&&(i=e,s=t[e]);if(40===e.keyCode?-1===i?(s=t[0],s.classList.add("selected")):i<t.length-1&&(t[i].classList.remove("selected"),s=t[i+1],s.classList.add("selected")):38===e.keyCode&&(i===t.length?(s=t[t.length],s.classList.add("selected")):i>=1&&(t[i].classList.remove("selected"),s=t[i-1],s.classList.add("selected"))),!M.utils.isNullOrEmpty(s)){e.target.value=s.innerHTML.trim();document.getElementById("m-autcomplete").scrollTop=s.offsetTop}}}),this.delayTime_=M.config.AUTOCOMPLETE_DELAYTIME,this.timeoutKey_=null,this.limit_=M.config.AUTOCOMPLETE_LIMIT,this.searchTime_=0,this.busqMunicipio_=!1,this.busqMunicipioClick_=!1,this.searchingResult_=this.resultsContainer_.querySelector("div#m-autocomplete-results > div#m-searching-result-autocomplete")}addTo(e){this.map_=e,this.target_.classList.add(a.CLASS),this.resultsContainer_.removeChild(this.searchingResult_),this.target_.addEventListener("input",this.keyPress_.bind(this)),this.target_.addEventListener("keyup",this.hiddenAutocomplete_.bind(this))}hiddenAutocomplete_(e){27!==e.keyCode&&13!==e.keyCode||this.cancelSearch_(e)}keyPress_(e){e.preventDefault(),M.utils.isNullOrEmpty(this.timeoutKey_)||this.cancelSearch_(e);const t=this.target_.value.trim();t.length>=this.minLength_&&(this.timeoutKey_=setTimeout(()=>{-1!==t.indexOf(",")?this.busqMunicipio_=!0:(this.busqMunicipio_=!1,this.busqMunicipioClick_=!1),this.search_(t)},this.delayTime_))}search_(e,t){let s;this.evt=t,s=M.utils.addParameters(this.url_,{input:e.trim(),limit:this.limit_,codine:this.locality_}),s=this.formatContent_(s," ","%20"),this.searchTime_=Date.now(),(e=>{M.remote.get(s).then(t=>{if(e===this.searchTime_){let e=JSON.parse(t.text);e=this.parseResultsForTemplate_(e);const s=this.map_.getControls();if(M.utils.isUndefined(e.docs))for(let e=0,t=s.length;e<t;e+=1)"searchstreet"===s[e].name?s[e].completed=!1:"searchstreetgeosearch"===s[e].name&&(s[e].ctrlSearchstreet.completed=!1);else if(M.utils.isUndefined(e.docs[0]))for(let e=0,t=s.length;e<t;e+=1)"searchstreet"===s[e].name?s[e].completed=!1:"searchstreetgeosearch"===s[e].name&&(s[e].ctrlSearchstreet.completed=!1);else{const t={jsonp:!0,vars:e};this.resultsContainer_.classList.contains(a.MINIMUM)&&(this.resultsContainer_.classList.remove(a.MINIMUM),M.utils.isNullOrEmpty(this.resultsContainer_.parentElement)||this.searchingResult_.parentElement.removeChild(this.searchingResult_));const i=M.template.compileSync(r.a,t);this.resultsContainer_.innerHTML=i.innerHTML;const l=this.resultsContainer_.querySelectorAll("div.autocomplete");if(this.addEvents_(l),this.target_.focus(),!0===this.busqMunicipio_)if(!0===this.busqMunicipioClick_){if(this.resultsContainer_.innerHTML="",!M.utils.isUndefined(this.evt)){for(let e=0,t=s.length;e<t;e+=1)"searchstreetgeosearch"===s[e].name?(s[e].ctrlSearchstreet.searchClick(this.evt),s[e].ctrlSearchstreet.completed=!1,s[e].ctrlGeosearch.searchClick(this.evt)):"searchstreet"===s[e].name&&(s[e].searchClick(this.evt),s[e].completed=!1);this.busqMunicipioClick_=!1}}else{const e=this.resultsContainer_.querySelectorAll("div.autocomplete");for(let t=0,i=s.length;t<i;t+=1)if("searchstreetgeosearch"===s[t].name)if(!0===s[t].ctrlSearchstreet.completed)s[t].ctrlSearchstreet.completed=!1,this.resultsContainer_.innerHTML="";else for(let t=0,s=e.length;t<s;t+=1)this.evtClickMunicipaly_(e[t]);else if("searchstreet"===s[t].name)if(!0===s[t].completed)s[t].completed=!1,this.resultsContainer_.innerHTML="";else for(let t=0,s=e.length;t<s;t+=1)this.evtClickMunicipaly_(e[t])}else for(let e=0,t=s.length;e<t;e+=1)"searchstreet"===s[e].name?!0===s[e].completed&&(this.resultsContainer_.innerHTML="",s[e].completed=!1):"searchstreetgeosearch"===s[e].name&&!0===s[e].ctrlSearchstreet.completed&&(this.resultsContainer_.innerHTML="",s[e].ctrlSearchstreet.completed=!1)}}})})(this.searchTime_)}evtClickMunicipaly_(e){e.addEventListener("click",()=>{this.clickMunicipaly_()})}parseResultsForTemplate_(e){let t=e.autocompletarDireccionMunicipioResponse.autocompletarDireccionMunicipioReturn.autocompletarDireccionMunicipioReturn;const s=[];if(!0===this.busqMunicipio_)if(M.utils.isUndefined(t))this.resultsContainer_.innerHTML="";else{t instanceof Array==!1&&(t=[t]);for(let e=0,i=t.length;e<i;e+=1){const i=t[e].split(",");s.push(`${i[0]} ${i[1]}, ${i[3]} (${i[i.length-1]})`)}t=s}else if(t instanceof Array==!1){if(s.push(t),t=s,!M.utils.isUndefined(t[0]))for(let e=0,s=t.length;e<s;e+=1)t[e]=this.formatContent_(t[e],","," ")}else for(let e=0,s=t.length;e<s;e+=1)t[e]=this.formatContent_(t[e],","," ");let i=null;return i={docs:t},i}addEvents_(e){e.forEach(e=>{this.addEventSearchMunicipality_(e)})}addEventSearchMunicipality_(e){e.addEventListener("click",t=>{if(this.target_.value=e.innerHTML.trim(),M.utils.isNullOrEmpty(this.locality_))this.searchMunicipality_(e.innerHTML,t);else{const e=this.map_.getControls();this.resultsContainer_.innerHTML="",e.forEach(e=>{const s=e;"searchstreet"===s.name?(s.searchClick(t),s.completed=!1):"searchstreetgeosearch"===s.name&&(s.ctrlSearchstreet.searchClick(t),s.ctrlSearchstreet.completed=!1,s.ctrlGeosearch.searchClick(t))})}})}searchMunicipality_(e,t){this.busqMunicipio_=!0,this.search_(e.trim()+",",t)}clickMunicipaly_(){this.busqMunicipioClick_=!0}formatContent_(e,t,s){return e.replace(new RegExp(t,"g"),s)}cancelSearch_(e){clearTimeout(this.timeoutKey_),this.minLength_<=this.target_.value.length&&13!==e.keyCode&&27!==e.keyCode?(M.utils.isNullOrEmpty(this.resultsContainer_.parentElement.querySelector("#m-searchstreet-results>div"))?this.resultsContainer_.classList.add("results-panel"):(this.resultsContainer_.classList.add("results-panel-content"),this.resultsContainer_.classList.remove("results-panel")),this.resultsContainer_.appendChild(this.searchingResult_),this.resultsContainer_.parentElement.classList.add(a.SEARCHING_CLASS),this.resultsContainer_.classList.add(a.MINIMUM)):(this.searchTime_=0,this.resultsContainer_.parentElement.classList.remove(a.SEARCHING_CLASS),this.resultsContainer_.classList.contains(a.MINIMUM)&&(this.resultsContainer_.classList.remove(a.MINIMUM),this.resultsContainer_.removeChild(this.searchingResult_),this.resultsContainer_.innerHTML=""))}destroy(){this.map_.removeControls(this),this.map_=null,this.locality_="",this.url_=null,this.minLength_=null,this.target_=null,this.resultsContainer_=null,this.delayTime_=null,this.timeoutKey_=null,this.limit_=null,this.searchTime_=null,this.busqMunicipio_=null,this.busqMunicipioClick_=null,this.searchingResult_=null}equals(e){return e instanceof a}}a.CLASS="m-plugin-autocomplete",a.SEARCHING_CLASS="m-searching",a.RESULTAUTOCOMPLETE="resultautocomplete.html",a.MINIMUM="minimum",a.NAME="autocomplete";class l extends M.impl.Control{constructor(){super(),this.facadeMap_=null,this.element_=null}addTo(e,t){this.facadeMap_=e,this.element_=t,super.addTo(e,t)}getElement(){return this.element_}zoomResults(){const e=this.facadeMap_.getControls().find(e=>"searchstreetgeosearch"===e.name).ctrlGeosearch.getImpl().getLayer().getFeaturesExtent();M.utils.isNullOrEmpty(e)||this.facadeMap_.setBbox(e)}destroy(){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.remove("top-extra"),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_.getImpl().removePopup(),this.facadeMap_=null,this.element_=null}getLayer(){return this.layer_}}var n=s(7),o=s(3);class c extends o.a{addTo(e,t){this.facadeMap_=e,this.element_=t}zoomResults(){}}class h extends n.a{constructor(e,t){super(e,t),this.impl=new c,M.utils.isUndefined(c)&&M.exception("La implementación usada no puede crear controles SearchstreetIntegrated")}createView(e,t){return this.facadeMap_=t,this.addEvents(e),null}addEvents(e){if(this.element_=e,this.on(M.evt.COMPLETED,()=>{this.element_.classList.add("shown")},this),this.input_=this.element_.getElementsByTagName("input")["m-searchstreetgeosearch-search-input"],this.button_=this.element_.getElementsByTagName("button")["m-searchstreetgeosearch-search-btn"],this.clear_=this.element_.getElementsByTagName("button")["m-searchstreetgeosearch-clear-btn"],this.button_.addEventListener("click",this.searchClick.bind(this)),this.input_.addEventListener("keyup",this.searchClick.bind(this)),this.clear_.addEventListener("click",this.clearSearchs_.bind(this)),this.resultsContainer_=this.element_.getElementsByTagName("div")["m-searchstreet-results"],this.resultsAutocomplete_=this.element_.getElementsByTagName("div")["m-autocomplete-results"],this.resultsGeosearch_=this.element_.getElementsByTagName("div")["m-geosearch-results"],this.searchingResult_=this.element_.querySelector("div#m-searchstreet-results > div#m-searching-result-searchstreet"),!M.utils.isUndefined(this.codIne_)){this.searchTime_=Date.now();const e=M.utils.addParameters(this.searchCodIne_,{codigo:this.codIne_});(t=>{M.remote.get(e).then(e=>{let t;M.utils.isNullOrEmpty(e.text)||(t=JSON.parse(e.text),M.utils.isNullOrEmpty(t.comprobarCodIneResponse.comprobarCodIneReturn)?M.dialog.error(`El código del municipio  ${this.codIne_} no es válido`):(this.getMunProv_(t),this.element_.getElementsByTagName("span").codIne.innerHTML=`Búsquedas en  ${this.municipio_} ( ${this.provincia_} )`))})})(this.searchTime_)}this.searchingResult_.parentNode.removeChild(this.searchingResult_)}clearSearchs_(){this.element_.classList.remove("shown");const e=this.facadeMap_.getControls();for(let t=0,s=e.length;t<s;t+=1)"searchstreetgeosearch"===e[t].name&&e[t].ctrlGeosearch.getImpl().getLayer().clear();const t=this.facadeMap_.getLayers().filter(e=>"__draw__"===e.name)[0];t.removeFeatures(t.getFeatures()),this.facadeMap_.removePopup(),this.input_.value="",this.resultsContainer_.innerHTML="",this.resultsAutocomplete_.innerHTML="",this.resultsGeosearch_.innerHTML=""}searchClick(e){if(e.preventDefault(),"keyup"!==e.type){this.resultsAutocomplete_.classList.remove(n.a.MINIMUM),this.resultsAutocomplete_.innerHTML="";let e=this.input_.value;if(!M.utils.isNullOrEmpty(e))if(e.length<this.minAutocomplete_?this.completed=!1:this.completed=!0,M.utils.isUndefined(this.codIne_)||M.utils.isNullOrEmpty(this.codIne_))this.search_(e,this.showResults_);else{const t=e.indexOf(",");e.indexOf(",")>-1&&(e=e.substring(0,t)),this.search_(`${e} ,  ${this.municipio_}  ( ${this.provincia_} ), ${this.showResults_}`)}}}resultsClick_(e){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra-searchs"),e.target.classList.toggle("g-cartografia-flecha-arriba"),e.target.classList.toggle("g-cartografia-flecha-abajo"),this.resultsContainer_.classList.toggle("hidden"),M.utils.isNullOrEmpty(this.resultsContainer_.parentElement.querySelector("div#m-geosearch-results.hidden"))&&this.resultsContainer_.parentElement.classList.toggle("hidden")}getImpl(){return this.impl}}var u=s(0);class d extends u.a{addTo(e,t){this.facadeMap_=e,e.addLayers(this.layer_)}zoomToResults(){}}var p=s(2),m=s(1),_=s.n(m);class g extends p.a{constructor(e,t,s,i){super(e,t,s,i),this.impl=new d,M.utils.isUndefined(d)&&M.exception("La implementación usada no puede crear controles GeosearchIntegrated")}createView(e,t){return this.facadeMap_=t,this.addEvents(e),null}addEvents(e){this.element_=e,this.on(M.evt.COMPLETED,()=>{this.element_.classList.add("shown")},this),this.input_=this.element_.getElementsByTagName("input")["m-searchstreetgeosearch-search-input"];this.element_.getElementsByTagName("button")["m-searchstreetgeosearch-search-btn"].addEventListener("click",this.searchClick.bind(this));const t=this.element_.getElementsByTagName("button")["m-searchstreetgeosearch-help-btn"];t.addEventListener("click",e=>{e.preventDefault(),t.classList.toggle("shown"),this.helpClick_()}),this.resultsContainer_=this.element_.getElementsByTagName("div")["m-geosearch-results"],M.utils.enableTouchScroll(this.resultsContainer_),this.searchingResult_=this.element_.querySelector("div#m-geosearch-results > div#m-searching-result-geosearch")}appendResults_(e){this.drawNewResults(e);const t={jsonp:!0,vars:this.parseResultsForTemplate_(e,!0)},s=M.template.compileSync(_.a,t).querySelector("div#m-geosearch-results-scroll").children;for(let e=0;e<s.length;e+=1){const t=s.item(e);this.resultsScrollContainer_.appendChild(t),t.addEventListener("click",e=>this.resultClick_(e))}this.resultsContainer_.getElementsByTagName("span")["m-geosearch-page-found"].innerHTML=this.results_.length,this.element_.classList.remove(p.a.SEARCHING_CLASS),this.resultsContainer_.removeChild(this.searchingResult_),this.checkScrollSearch_(e)}resultsClick_(e){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.toggle("top-extra-search"),e.target.classList.toggle("g-cartografia-flecha-arriba"),e.target.classList.toggle("g-cartografia-flecha-abajo"),this.resultsContainer_.classList.toggle("hidden"),M.utils.isNullOrEmpty(this.resultsContainer_.parentElement.querySelector("div#m-searchstreet-results.hidden"))&&this.resultsContainer_.parentElement.classList.toggle("hidden")}getImpl(e){return this.impl}}var y=s(44),E=s.n(y);class v extends M.Control{constructor(e={}){const t=new l;M.utils.isUndefined(l)&&M.exception("La implementación usada no puede crear controles SearchStreetGeosearch"),super(t,"searchstreetgeosearch"),M.utils.isNullOrEmpty(e.locality)||(this.locality_=e.locality),this.urlSearchstret_=M.config.SEARCHSTREET_URL,this.urlGeosearch_=M.config.GEOSEARCH_URL,this.coreGeosearch_=M.config.GEOSEARCH_CORE,this.handlerGeosearch_=M.config.GEOSEARCH_HANDLER,this.paramsGeosearch_=e.paramsGeosearch||{},this.input_=null,this.ctrlSearchstreet=null,this.ctrlGeosearch=null,this.name_="searchstreetgeosearch",this.element_=null,this.facadeMap_=null}addTo(e){let t=this.getImpl();this.facadeMap_=e;let s=this.createView(e);s instanceof Promise&&s.then(s=>{t.addTo(e,s),this.html=s,this.fire(M.evt.ADDED_TO_MAP)}),this.on(M.evt.ADDED_TO_MAP,i=>{M.utils.isUndefined(this.locality_)?this.ctrlSearchstreet=new h(this.urlSearchstret_):this.ctrlSearchstreet=new h(this.urlSearchstret_,this.locality_),t=this.ctrlSearchstreet.getImpl(),s=this.ctrlSearchstreet.createView(this.html,e),t.addTo(e,this.html),this.ctrlGeosearch=new g(this.urlGeosearch_,this.coreGeosearch_,this.handlerGeosearch_,this.paramsGeosearch_),t=this.ctrlGeosearch.getImpl(),s=this.ctrlGeosearch.createView(this.html,this.facadeMap_),t.addTo(e,this.html);let r=!1;this.ctrlSearchstreet.on(M.evt.COMPLETED,()=>{!0===r&&(this.element_.classList.add("shown"),r=!1,this.zoomResults()),r=!0},this),this.ctrlGeosearch.on(M.evt.COMPLETED,()=>{!0===r&&(this.element_.classList.add("shown"),r=!1,this.zoomResults()),r=!0},this)})}createView(e){const t=M.template.compileSync(E.a);this.element_=t,this.input_=t.querySelector("input#m-searchstreetgeosearch-search-input");const s=t.querySelector("div#m-searchstreet-results"),i=t.querySelector("div#m-geosearch-results"),r=t.querySelector("ul#m-tabs > li:nth-child(1) > a"),a=t.querySelector("ul#m-tabs > li:nth-child(2) > a");return r.addEventListener("click",e=>{e.preventDefault(),r.classList.contains("activated")||(r.classList.add("activated"),a.classList.remove("activated"),s.classList.add("show"),i.classList.remove("show"))}),a.addEventListener("click",e=>{e.preventDefault(),a.classList.contains("activated")||(a.classList.add("activated"),r.classList.remove("activated"),s.classList.remove("show"),i.classList.add("show"))}),new Promise(e=>{e(t)})}getInput(){return this.input_}equals(e){let t=!1;return e instanceof v&&(t=this.name===e.name),t}getHtml(){return this.element_}zoomResults(){this.getImpl().zoomResults()}}v.TEMPLATE="searchstreetgeosearch.html";var f=s(45);class L extends M.Plugin{constructor(e={}){super(),this.parameters_=e,this.name="searchstreetgeosearch",this.map_=null,this.control_=null,this.locality_=e.locality,this.metadata_=f.metadata}addTo(e){this.map_=e,this.control_=new v(this.parameters_),e.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra"),this.control_.on(M.evt.ADDED_TO_MAP,()=>{this.fire(M.evt.ADDED_TO_MAP);const e=M.utils.addParameters(M.config.SEARCHSTREET_URLCOMPROBARINE,{codigo:this.locality_});M.remote.get(e).then(e=>{const t=JSON.parse(e.text);M.utils.isNullOrEmpty(t.comprobarCodIneResponse.comprobarCodIneReturn)&&(this.locality_=""),this.autocompletador=new a({locality:this.locality_,target:this.control_.getInput(),html:this.control_.getHtml()}),this.map_.addPlugin(this.autocompletador)})},this),this.panel_=new M.ui.Panel("SearchstreetGeosearch",{collapsible:!0,className:"m-geosearch",position:M.ui.position.TL,tooltip:"Buscador de calles y geobúsquedas"}),this.panel_.on(M.evt.ADDED_TO_MAP,e=>{this.panel_._buttonPanel.addEventListener("click",e=>{this.panel_._collapsed||this.control_.getInput().focus()})}),this.panel_.addControls(this.control_),this.map_.addPanels(this.panel_)}getControls(){const e=[];return e.push(this.control_),e}destroy(){this.map_.removeControls([this.control_]),this.map_.removePlugins(this.autocompletador),this.name=null,this.parameters_=null,this.map_=null,this.control_=null,this.locality_=null}equals(e){return e instanceof L}getAPIRest(){return"searchstreetgeosearch"}getMetadata(){return this.metadata_}}null==window.M.plugin&&(window.M.plugin={}),window.M.plugin.SearchstreetGeosearch=L},9:function(e,t){e.exports='<div class="m-searchstreet-content">\n   <div class="result">\n      <table>\n         <tr>\n            <td class="key">Tipo de Vía</td>\n            <td class="value">{{tVia}}</td>\n         </tr>\n         <tr>\n            <td class="key">Nombre de Vía</td>\n            <td class="value">{{nVia}}</td>\n         </tr>\n         <tr>\n            <td class="key">Número</td>\n            <td class="value">{{num}}</td>\n         </tr>\n         <tr>\n            <td class="key">Municipio</td>\n            <td class="value">{{mun}}</td>\n         </tr>\n         <tr>\n            <td class="key">Provincia</td>\n            <td class="value">{{prov}}</td>\n         </tr>\n      </table>\n   </div>\n</div>'}});