!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=79)}({0:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,o=[{key:"init",value:function(){if(!1===e.initialized){e.initialized=!0;var t=document.createElement("img");t.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24.svg"]),t.width="24",t.height="24",t.crossOrigin="anonymous";var n=document.createElement("IMG");n.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-new.svg"]),n.width="24",n.height="24",n.crossOrigin="anonymous";var r=document.createElement("IMG");r.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-sel.svg"]),r.width="24",r.height="24",r.crossOrigin="anonymous",e.DEFAULT[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:t,imgSize:[24,24]})}),e.DEFAULT[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#A15BD7"}),stroke:new ol.style.Stroke({color:"#A15BD7",width:2})}),e.DEFAULT[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:t,imgSize:[24,24]})}),e.DEFAULT[M.geom.wkt.type.MULTI_POINT]=e.DEFAULT[M.geom.wkt.type.POINT],e.DEFAULT[M.geom.wkt.type.LINEAR_RING]=e.DEFAULT[M.geom.wkt.type.LINE_STRING],e.DEFAULT[M.geom.wkt.type.MULTI_LINE_STRING]=e.DEFAULT[M.geom.wkt.type.LINE_STRING],e.DEFAULT[M.geom.wkt.type.MULTI_POLYGON]=e.DEFAULT[M.geom.wkt.type.POLYGON],e.DEFAULT[M.geom.wkt.type.CIRCLE]=e.DEFAULT[M.geom.wkt.type.POLYGON],e.DEFAULT[M.geom.wkt.type.GEOMETRY_COLLECTION]=e.DEFAULT[M.geom.wkt.type.POLYGON],e.NEW[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:n,imgSize:[24,24]})}),e.NEW[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#e2951b"}),stroke:new ol.style.Stroke({color:"#e2951b",width:2})}),e.NEW[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:n,imgSize:[24,24]})}),e.NEW[M.geom.wkt.type.MULTI_POINT]=e.NEW[M.geom.wkt.type.POINT],e.NEW[M.geom.wkt.type.LINEAR_RING]=e.NEW[M.geom.wkt.type.LINE_STRING],e.NEW[M.geom.wkt.type.MULTI_LINE_STRING]=e.NEW[M.geom.wkt.type.LINE_STRING],e.NEW[M.geom.wkt.type.MULTI_POLYGON]=e.NEW[M.geom.wkt.type.POLYGON],e.NEW[M.geom.wkt.type.CIRCLE]=e.NEW[M.geom.wkt.type.POLYGON],e.NEW[M.geom.wkt.type.GEOMETRY_COLLECTION]=e.NEW[M.geom.wkt.type.POLYGON],e.SELECTED[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:r,imgSize:[24,24]})}),e.SELECTED[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#fcfcfc"}),stroke:new ol.style.Stroke({color:"#3589d1",width:2})}),e.SELECTED[M.geom.wkt.type.POLYGON]=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(240, 220, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#a15bd7",width:2})}),e.SELECTED[M.geom.wkt.type.MULTI_POINT]=e.SELECTED[M.geom.wkt.type.POINT],e.SELECTED[M.geom.wkt.type.LINEAR_RING]=e.SELECTED[M.geom.wkt.type.LINE_STRING],e.SELECTED[M.geom.wkt.type.MULTI_LINE_STRING]=e.SELECTED[M.geom.wkt.type.LINE_STRING],e.SELECTED[M.geom.wkt.type.MULTI_POLYGON]=e.SELECTED[M.geom.wkt.type.POLYGON],e.SELECTED[M.geom.wkt.type.CIRCLE]=e.SELECTED[M.geom.wkt.type.POLYGON],e.SELECTED[M.geom.wkt.type.GEOMETRY_COLLECTION]=e.SELECTED[M.geom.wkt.type.POLYGON]}}}],(n=null)&&r(t.prototype,n),o&&r(t,o),e}();function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}o.DEFAULT={},o.NEW={},o.SELECTED={},o.initialized=!1;var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"getCentroidCoordinate",value:function(t){var n,r,o,i,s,a;return t.getType()===M.geom.wkt.type.POINT?n=t.getCoordinates():t.getType()===M.geom.wkt.type.LINE_STRING||t.getType()===M.geom.wkt.type.LINEAR_RING?n=(r=t.getCoordinates())[o=Math.floor(r.length/2)]:t.getType()===M.geom.wkt.type.POLYGON?n=e.getCentroidCoordinate(t.getInteriorPoint()):t.getType()===M.geom.wkt.type.MULTI_POINT?(i=t.getPoints(),o=Math.floor(i.length/2),n=e.getCentroidCoordinate(i[o])):t.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(s=t.getLineStrings(),o=Math.floor(s.length/2),n=e.getCentroidCoordinate(s[o])):t.getType()===M.geom.wkt.type.MULTI_POLYGON?(i=t.getInteriorPoints(),n=e.getCentroidCoordinate(i)):t.getType()===M.geom.wkt.type.CIRCLE?n=t.getCenter():t.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(a=t.getGeometries(),o=Math.floor(a.length/2),n=e.getCentroidCoordinate(a[o])),n}}],(n=null)&&i(t.prototype,n),r&&i(t,r),e}(),a=n(4),l=n.n(a);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t,n){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var o=m(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(a,M.impl.layer.Vector);var t,n,r,i=y(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"geosearch",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(this,a);var r=n;return(e=i.call(this,r)).wktFormatter_=new ol.format.WKT,e.popup_=null,e.selectedFeatures_=[],r.displayInLayerSwitcher||(r.displayInLayerSwitcher=!1),e.name=t,e}return t=a,r=[{key:"setStyleFeature",value:function(e,t){var n=e;o.init(),M.utils.isArray(n)||(n=[n]),n.forEach((function(e){var n=e.getGeometry().getType();M.utils.isNullOrEmpty(t)||t===M.style.state.DEFAULT?e.setStyle(o.DEFAULT[n]):t===M.style.state.NEW?e.setStyle(o.NEW[n]):t===M.style.state.SELECTED&&e.setStyle(o.SELECTED[n])}))}}],(n=[{key:"addTo",value:function(e){h(m(a.prototype),"addTo",this).call(this,e),this.ol3Layer.setSource(new ol.source.Vector({useSpatialIndex:!1}))}},{key:"drawResults",value:function(e){var t=this,n=ol.proj.get(this.map.getProjection().code),r=[];M.utils.isNullOrEmpty(e.spatial_response)||(r=e.spatial_response.docs),M.utils.isNullOrEmpty(r)&&(r=e.response.docs);var o=r.map((function(e){var r=t.wktFormatter_.readFeature(e.geom,{dataProjection:n});return r.setId(e.solrid),r.setProperties(e),a.setStyleFeature(r,M.style.state.DEFAULT),t.wrapComplexFeature_(r),M.impl.Feature.olFeature2Facade(r)}),this);this.facadeVector_.addFeatures(o)}},{key:"drawNewResults",value:function(e){var t,n=this,r=ol.proj.get(this.map.getProjection().code);M.utils.isNullOrEmpty(e.spatial_response)?M.utils.isNullOrEmpty(e.response)||(t=e.response.docs):t=e.spatial_response.docs;var o=t.map((function(e){var t=n.wktFormatter_.readFeature(e.geom,{dataProjection:r});return t.setId(e.solrid),t.setProperties(e),a.setStyleFeature(t,M.style.state.NEW),M.impl.Feature.olFeature2Facade(t)}),this);this.facadeVector_.addFeatures(o)}},{key:"clear",value:function(e){this.map.removePopup(),this.facadeVector_.clear()}},{key:"selectFeatures",value:function(e,t,n,r){var o=this,i=e;this.unselectFeatures(),this.selectedFeatures_=i,i=i.map(M.impl.Feature.facade2OLFeature),a.setStyleFeature(i,M.style.state.SELECTED);var s={jsonp:!0,vars:this.parseFeaturesForTemplate_(i),parseToHtml:!1},c={icon:"g-cartografia-pin",title:"Geosearch",content:M.template.compileSync(l.a,s)},u=this.map.getPopup();M.utils.isNullOrEmpty(u)?((u=new M.Popup({panMapIfOutOfView:!r,ani:null})).addTab(c),this.map.addPopup(u,t)):u.addTab(c),u.on(M.evt.DESTROY,(function(){o.internalUnselectFeatures_(!0)}),this)}},{key:"selectFeatureBySolrid",value:function(e){var t=this.facadeVector_.getFeatureById(e);this.selectedFeatures_=[t];var n=t.getImpl().getOLFeature().getGeometry(),r=s.getCentroidCoordinate(n);this.unselectFeatures(),this.selectFeatures([t],r,null,!0),this.map.setBbox(n.getExtent())}},{key:"parseFeaturesForTemplate_",value:function(e){var t={features:[]};return e.forEach((function(e){var n=["geom","_version_","keywords","solrid",e.getGeometryName()],r=e.getProperties(),o=[];Object.keys(r).forEach((function(e){M.utils.includes(n,e.toLowerCase())||o.push({key:M.utils.beautifyAttributeName(e),value:r[e]})}));var i={solrid:e.getId(),attributes:o};t.features.push(i)})),t}},{key:"wrapComplexFeature_",value:function(e){var t=e.getGeometry();if(t.getType()===M.geom.wkt.type.POLYGON||t.getType()===M.geom.wkt.type.MULTI_POLYGON){var n;n=t.getType()===M.geom.wkt.type.POLYGON?t.getInteriorPoint():t.getInteriorPoints();var r=new ol.geom.GeometryCollection([n,t]);e.setGeometry(r)}}},{key:"unselectFeatures",value:function(e,t){this.internalUnselectFeatures_()}},{key:"internalUnselectFeatures_",value:function(e){this.selectedFeatures_.length>0&&(a.setStyleFeature(this.selectedFeatures_.map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT),this.selectedFeatures_.length=0,e||this.map.removePopup())}},{key:"setNewResultsAsDefault",value:function(){a.setStyleFeature(this.facadeVector_.getFeatures().map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT)}},{key:"getCentroidCoordinate",value:function(e){var t,n,r,o,i,s;return e.getType()===M.geom.wkt.type.POINT?t=e.getCoordinates():e.getType()===M.geom.wkt.type.LINE_STRING||e.getType()===M.geom.wkt.type.LINEAR_RING?t=(n=e.getCoordinates())[r=Math.floor(n.length/2)]:e.getType()===M.geom.wkt.type.POLYGON?t=this.getCentroidCoordinate(e.getInteriorPoint()):e.getType()===M.geom.wkt.type.MULTI_POINT?(o=e.getPoints(),r=Math.floor(o.length/2),t=this.getCentroidCoordinate(o[r])):e.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(i=e.getLineStrings(),r=Math.floor(i.length/2),t=this.getCentroidCoordinate(i[r])):e.getType()===M.geom.wkt.type.MULTI_POLYGON?(o=e.getInteriorPoints(),t=this.getCentroidCoordinate(o)):e.getType()===M.geom.wkt.type.CIRCLE?t=e.getCenter():e.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(s=e.getGeometries(),r=Math.floor(s.length/2),t=this.getCentroidCoordinate(s[r])),t}},{key:"destroy",value:function(){var e=this.map.getMapImpl();M.utils.isNullOrEmpty(this.ol3Layer)||(e.removeLayer(this.ol3Layer),this.ol3Layer=null),this.map=null,this.wktFormatter_=null,this.popup_=null,this.selectedFeatures_=null,this.name=null}},{key:"equals",value:function(e){var t=!1;return e instanceof a&&(t=this.url===e.url,t=t&&this.name===e.name),t}},{key:"getFeaturesExtentPromise",value:function(e,t){var n=this;return new Promise((function(r){var o=n.map.getProjection().code;if(!0===n.isLoaded()){var i=n.getFeatures(e,t),s=M.impl.utils.getFeaturesExtent(i,o);r(s)}else n.requestFeatures_().then((function(e){var t=M.impl.utils.getFeaturesExtent(e,o);r(t)}))}))}}])&&p(t.prototype,n),r&&p(t,r),a}();function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=L(e);if(t){var o=L(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return S(this,n)}}function S(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}g.POPUP_RESULT="geosearchfeaturepopup.html";var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(i,M.layer.Vector);var t,n,r,o=w(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new g;return v(this,i),e=o.call(this,t,n,{},r),M.utils.isUndefined(g)&&M.exception("La implementación usada no puede crear capas Geosearch"),e.displayInLayerSwitcher=!1,e}return t=i,(n=[{key:"equals",value:function(e){return!1}}])&&b(t.prototype,n),r&&b(t,r),i}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var o=P(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return R(this,n)}}function R(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return F}));var F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(i,M.impl.Control);var t,n,r,o=I(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return T(this,i),(e=o.call(this)).facadeMap_=null,e.helpHtml_=null,e.layer_=new O({name:t.layerName||"__geosearch_plugin_layer_name__"}),e}return t=i,(n=[{key:"addTo",value:function(e,t){this.facadeMap_=e,e.addLayers(this.layer_),ol.control.Control.call(this,{element:t,target:null}),e.getMapImpl().addControl(this)}},{key:"unselectResults",value:function(e){this.layer_.getImpl().unselectFeatures(e)}},{key:"setNewResultsAsDefault",value:function(){this.layer_.getImpl().setNewResultsAsDefault()}},{key:"drawResults",value:function(e){this.layer_.getImpl().drawResults(e)}},{key:"drawNewResults",value:function(e){this.layer_.getImpl().drawNewResults(e)}},{key:"zoomToResults",value:function(){var e=ol.extent.boundingExtent(this.layer_.getImpl().getOLLayer().getSource().getFeatures().map((function(e){return ol.extent.getCenter(e.getGeometry().getExtent())})));this.facadeMap_.setBbox(e)}},{key:"getLayer",value:function(){return this.layer_}},{key:"resultClick",value:function(e){this.layer_.getImpl().selectFeatureBySolrid(e)}},{key:"hideHelp",value:function(){M.utils.isNullOrEmpty(this.helpHtml_)||(this.facadeMap_.getMapImpl().getTargetElement().removeChild(this.helpHtml_),this.helpHtml_=null)}},{key:"showHelp",value:function(e){var t=this.facadeMap_.getMapImpl().getTargetElement();M.utils.isNullOrEmpty(this.helpHtml_)||t.removeChild(this.helpHtml_),this.helpHtml_=e,t.appendChild(this.helpHtml_)}},{key:"clear",value:function(){this.layer_.clear()}},{key:"destroy",value:function(){this.clear(),this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.remove("top-extra"),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.helpHtml_=null,this.layer_=null}}])&&C(t.prototype,n),r&&C(t,r),i}()},1:function(e,t){e.exports='<div class="results-panels">\n   {{#if partial}}\n   <div class="partial">\n      <p>No se han encontrado resultados para la búsqueda.</p>\n      <p>A continuación se muestran otros resultados que quizás le interesen:...</p>\n   </div>\n   {{/if}}\n   <div class="results" id="m-geosearch-results-scroll">\n      {{#each docs}}\n      <div id="{{solrid}}" class="result">\n         {{#each attributes}}\n         <table>\n            <tbody>\n               <tr>\n                  <td class="key">{{key}}</td>\n                  <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n               </tr>\n            </tbody>\n         </table>\n         {{/each}}\n      </div>\n      {{/each}}\n   </div>\n   {{#eq docs.length 0}}\n   <div class="results">\n      <div class="partial">No se han encontrado resultados para la búsqueda "{{query}}".</div>\n   </div>\n   {{/eq}}\n   <div class="page">\n      <span class="found" id="m-geosearch-page-found">{{docs.length}}</span> de <span class="total">{{total}}</span>\n      <div class="g-cartografia-flecha-arriba"></div>\n   </div>\n</div>'},2:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var r=n(0),o=n(5),i=n.n(o),s=n(1),a=n.n(s),l=n(6),c=n.n(l);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var o=d(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return y(this,n)}}function y(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(l,M.Control);var t,n,o,s=f(l);function l(e,t,n,o,i){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var c=new r.a;return a=s.call(this,c,l.NAME),M.utils.isUndefined(r.a)&&M.exception("La implementación usada no puede crear controles Geosearch"),a.input_=null,a.element_=null,a.resultsContainer_=null,a.resultsScrollContainer_=null,a.searchingResult_=null,a.searchTime_=0,a.url_=e,a.core_=t,a.handler_=n,a.searchUrl_=M.utils.concatUrlPaths([a.url_,a.core_,a.handler_]),a.helpUrl_=M.utils.concatUrlPaths([a.url_,a.core_,"/help"]),a.searchParameters_=o,M.utils.isNullOrEmpty(a.searchParameters_)||(M.utils.isNullOrEmpty(a.searchParameters_.rows)&&(a.searchParameters_.rows=M.config.GEOSEARCH_ROWS),a.searchUrl_=M.utils.addParameters(a.searchUrl_,a.searchParameters_)),a.results_=[],a.showHelp_=i,a.scrollIsUp_=!0,a.spatialSearch_=!1,a.facadeMap_=null,a}return t=l,(n=[{key:"createView",value:function(e){this.facadeMap_=e;var t=M.template.compileSync(i.a,{jsonp:!0});return!1===this.showHelp_&&t.querySelector("#m-geosearch-help-btn").classList.add("m-hidden"),this.addEvents(t),t}},{key:"addEvents",value:function(e){var t=this;this.element_=e,this.on(M.evt.COMPLETED,(function(){t.element_.classList.add("shown")}),this),this.input_=this.element_.getElementsByTagName("input")["m-geosearch-search-input"],this.input_.addEventListener("keyup",this.searchClick.bind(this)),this.element_.getElementsByTagName("button")["m-geosearch-search-btn"].addEventListener("click",this.searchClick.bind(this));var n=this.element_.getElementsByTagName("button")["m-geosearch-help-btn"];n&&n.addEventListener("click",(function(e){e.preventDefault(),n.classList.toggle("shown"),t.helpClick_()})),this.element_.getElementsByTagName("button")["m-geosearch-clear-btn"].addEventListener("click",this.clearClick_.bind(this)),this.resultsContainer_=this.element_.querySelector("div#m-geosearch-results"),M.utils.enableTouchScroll(this.resultsContainer_),this.searchingResult_=this.element_.querySelector("div#m-geosearch-results > div#m-searching-result")}},{key:"addEventsHelp",value:function(e){this.element_=e,this.element_.getElementsByTagName("button")["m-geosearch-closeHelp-btn"].addEventListener("click",this.closeHelpClick_.bind(this))}},{key:"searchClick",value:function(e){if(e.preventDefault(),"keyup"!==e.type||13===e.keyCode){this.results_.length=0;var t=this.input_.value;M.utils.isNullOrEmpty(t)?M.dialog.info("Debe introducir una búsqueda."):this.search_(t,this.showResults_)}}},{key:"resultClick_",value:function(e){var t=e;t.preventDefault(),M.window.WIDTH<=M.config.MOBILE_WIDTH&&this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba").click(),this.facadeMap_.removePopup();var n=t.currentTarget.id;this.getImpl().resultClick(n)}},{key:"search_",value:function(e,t){var n=this;this.resultsContainer_.appendChild(this.searchingResult_),this.searchTime_=Date.now(),this.element_.classList.add(l.SEARCHING_CLASS);var r,o=M.utils.addParameters(this.searchUrl_,{q:e,start:this.results_.length,srs:this.facadeMap_.getProjection().code});r=this.searchTime_,M.remote.get(o).then((function(e){if(r===n.searchTime_){var o;try{o=JSON.parse(e.text)}catch(e){M.exception("La respuesta no es un JSON válido: ".concat(e))}t.call(n,o),n.element_.classList.remove(l.SEARCHING_CLASS)}}))}},{key:"showResults_",value:function(e){this.getImpl().clear(),this.drawResults(e);var t={jsonp:!0,vars:this.parseResultsForTemplate_(e)},n=M.template.compileSync(a.a,t);this.resultsContainer_.classList.remove(l.HIDDEN_RESULTS_CLASS),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_);for(var r=this.resultsContainer_.querySelectorAll(".result"),o=0,i=r.length;o<i;o+=1)r.item(o).removeEventListener("click",this.resultClick_.bind(this));e.response.docs.length>0&&this.zoomToResults();var s=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba");M.utils.isNullOrEmpty(s)||s.removeEventListener("click",this.resultsClick_.bind(this)),this.resultsContainer_.innerHTML=n.innerHTML,this.resultsScrollContainer_=this.resultsContainer_.querySelector("div#m-geosearch-results-scroll"),M.utils.enableTouchScroll(this.resultsScrollContainer_),this.resultsScrollContainer_.addEventListener("scroll",this.resultsScroll_.bind(this));for(var c=0,u=(r=this.resultsContainer_.getElementsByClassName("result")).length;c<u;c+=1)r.item(c).addEventListener("click",this.resultClick_.bind(this));(s=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba")).addEventListener("click",this.resultsClick_.bind(this)),this.checkScrollSearch_(e),this.fire(M.evt.COMPLETED)}},{key:"drawResults",value:function(e){this.getImpl().drawResults(e)}},{key:"drawNewResults",value:function(e){this.getImpl().drawNewResults(e)}},{key:"zoomToResults",value:function(){this.getImpl().zoomToResults()}},{key:"getInput",value:function(){return this.input_}},{key:"appendResults_",value:function(e){var t=this;this.drawNewResults(e);for(var n={jsonp:!0,vars:this.parseResultsForTemplate_(e,!0)},r=M.template.compileSync(a.a,n).getElementsByTagName("div")["m-geosearch-results-scroll"].children,o=0;o<r.length;o+=1){var i=r.item(o);this.resultsScrollContainer_.appendChild(i),i.addEventListener("click",(function(e){return t.resultClick_(e)}))}this.resultsContainer_.getElementsByTagName("span")["m-geosearch-page-found"].innerHTML=this.results_.length,this.checkScrollSearch_(e)}},{key:"resultsScroll_",value:function(e){var t=e.target,n=t.offsetHeight,r=t.scrollHeight-t.scrollTop-n<=15;r&&this.scrollIsUp_?(this.scrollIsUp_=!1,this.scrollSearch_()):r||(this.scrollIsUp_=!0)}},{key:"scrollSearch_",value:function(){this.getImpl().unselectResults(!0),this.getImpl().setNewResultsAsDefault();var e=this.input_.value;this.search_(e,this.appendResults_)}},{key:"helpClick_",value:function(e){var t=this;!0===this.helpShown_?(this.getImpl().hideHelp(),this.helpShown_=!1):M.remote.get(this.helpUrl_).then((function(e){var n;try{n=JSON.parse(e.text)}catch(e){M.Exception("La respuesta no es un JSON válido: ".concat(e))}var r={jsonp:!0,vars:{entities:n}},o=M.template.compileSync(c.a,r);t.addEventsHelp(o),t.getImpl().showHelp(o),t.helpShown_=!0}))}},{key:"closeHelpClick_",value:function(e){!0===this.helpShown_&&(this.getImpl().hideHelp(),this.helpShown_=!1)}},{key:"clearClick_",value:function(e){this.element_.classList.remove("shown"),M.utils.isNullOrEmpty(this.input_)||(this.input_.value=""),M.utils.isNullOrEmpty(this.resultsContainer_)||(this.resultsContainer_.innerHTML=""),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||(this.resultsScrollContainer_.innerHTML="",this.resultsScrollContainer_=null),this.results_.length=0,this.resultsContainer_.classList.remove(l.HIDDEN_RESULTS_CLASS),this.getImpl().clear(),this.getImpl().hideHelp(),this.spatialSearch_=!1}},{key:"resultsClick_",value:function(e){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra-search"),e.target.classList.toggle("g-cartografia-flecha-arriba"),e.target.classList.toggle("g-cartografia-flecha-abajo"),this.resultsContainer_.classList.toggle(l.HIDDEN_RESULTS_CLASS)}},{key:"equals",value:function(e){var t=!1;return e instanceof l&&(t=this.name===e.name),t}},{key:"parseResultsForTemplate_",value:function(e,t){var n="";M.utils.isNullOrEmpty(this.input_)||(n=this.input_.value);var r=0;M.utils.isUndefined(e.spatial_response)?(r=e.response.numFound,this.spatialSearch_=!1):(r=e.spatial_response.numFound,this.spatialSearch_=!0);var o=this.getDocsFromResults_(e);this.results_=!0===t?this.results_.concat(o):o;var i=this.spatialSearch_&&M.utils.isNullOrEmpty(e.spatial_response.docs);return 0!==r?{docs:o,total:r,partial:i}:{docs:o,total:r,notResutls:!0,query:n}}},{key:"getDocsFromResults_",value:function(e){var t=[];t=this.spatialSearch_?e.spatial_response.docs:e.response.docs;var n=["geom","_version_","keywords","solrid"];return t=t.map((function(e){var t=[];return Object.keys(e).forEach((function(r){M.utils.includes(n,r)||t.push({key:M.utils.beautifyAttributeName(r),value:e[r]})})),{solrid:e.solrid,attributes:t}}))}},{key:"checkScrollSearch_",value:function(e){var t=0;t=M.utils.isUndefined(e.spatial_response)?e.response.numFound:e.spatial_response.numFound,this.results_.length!==t||M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_)}}])&&p(t.prototype,n),o&&p(t,o),l}();m.NAME="geosearch",m.TEMPLATE="geosearch.html",m.RESULTS_TEMPLATE="geosearchresults.html",m.HELP_TEMPLATE="geosearchhelp.html",m.SEARCHING_CLASS="m-searching",m.HIDDEN_RESULTS_CLASS="hidden"},28:function(e,t){e.exports='<div class="m-geosearchbylocation-content">\n   <div>\n      <table>\n         <tr>\n            <td>X:</td>\n            <td>{{valorX}}</td>\n         </tr>\n         <tr>\n            <td>Y:</td>\n            <td>{{valorY}}</td>\n         </tr>\n      </table>\n   </div>\n</div>'},29:function(e,t){e.exports='<div class="m-control m-geosearchbylocation-container" id="m-geosearchbylocation-div" title="Geobúsquedas por geolocalización">\n   <button id="m-geosearchbylocation-button" class="g-cartografia-posicion7"></button>\n   <button id="m-geosearchbylocation-button-list" class="g-cartografia-lista hidden"></button>\n</div>'},30:function(e,t){e.exports='<div class="m-geosearchbylocation-results-panel">\n   <div class="title">\n           B&uacute;squeda por localizaci&oacute;n\n            <button class="m-panel-btn"></button>\n    </div>\n   <div class="results" id="m-geosearchbylocation-results-scroll">\n      {{#each docs}}\n      <div id="{{solrid}}" class="result">\n         {{#each attributes}}\n         <table>\n            <tbody>\n               <tr>\n                  <td class="key">{{key}}</td>\n                  <td class="value">{{{value}}}</td>\n               </tr>\n            </tbody>\n         </table>\n         {{/each}}\n      </div>\n      {{/each}}\n   </div>\n   <div class="page">\n      <span class="total">{{total}} resultados.</span>\n   </div>\n</div>'},31:function(e){e.exports=JSON.parse('{"url":{"name":"geosearchbylocation","separator":"*"},"constructor":"M.plugin.Geosearchbylocation","parameters":[{"type":"object","properties":[{"type":"simple","name":"distance","position":0},{"type":"simple","name":"url","position":1},{"type":"simple","name":"core","position":2},{"type":"simple","name":"handler","position":3}]}],"files":{"ol":{"scripts":["geosearchbylocation-2.0.1.ol.min.js"],"styles":["geosearchbylocation-2.0.1.min.css"]}},"metadata":{"uuid_plugin":"","uuid_version_plugin":"","version_ficha_metadatos":"","name":"GeosearchByLocation","description":"Search for locations within a given radius from a location user.","text":"","version":"2.0.1","date":"11/10/2019","author":"Junta de Andalucía","org":"Junta de Andalucía","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","buttons":[{"title":"","description":"","querySelector":""},{"title":"","description":"","querySelector":""}],"dependencies":{"modules":["",""],"plugins":[{"uuid":"","name":""}],"services":[{"name":"","description":""}]},"compatibility":["4","5","6"]}}')},4:function(e,t){e.exports='<div class="m-geosearch-content">\n   {{#each features}}\n   <div id="{{solrid}}" class="result">\n      {{#each attributes}}\n      <table>\n         <tr>\n            <td class="key">{{key}}</td>\n            <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n         </tr>\n      </table>\n      {{/each}}\n   </div>\n   <div class="m-separator"></div>\n   {{/each}}\n</div>'},5:function(e,t){e.exports='<div class="m-control m-geosearch-container">\n  \x3c!-- search panel --\x3e\n  <div class="search-panel">\n    <input type="text" id="m-geosearch-search-input" placeholder="Buscar" class="m-input-search" />\n    <button id="m-geosearch-search-btn" class="g-cartografia-zoom m-search-btn" title="Buscar"></button>\n    <button id="m-geosearch-help-btn" class="g-cartografia-ayuda m-help-btn" title="Ayuda"></button>\n    <button id="m-geosearch-clear-btn" class="g-cartografia-cancelar m-clear-btn" title="Limpiar búsqueda"></button>\n  </div>\n  \x3c!-- results panel --\x3e\n  <div class="results-panel" id="m-geosearch-results">\n    <div id="m-searching-result" class="m-searching-result g-cartografia-spinner"></div>\n  </div>\n</div>'},6:function(e,t){e.exports='<div class="m-geosearch-help">\n  {{#eq entities.length 0}}\n    <div class="entity">\n      <p>El servicio no tiene ayuda configurada</p>\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar" title="Cerrar ayuda"></button>\n    </div>\n  {{/eq}}\n  {{#each entities}}\n    <div class="entity">\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar m-clear-btn" title="Cerrar ayuda"></button>\n      <div class="name">{{entity}}</div>\n      <div class="info">{{info}}</div>\n      <ul class="keywords">\n        {{#each keywords}}\n          <li>{{this}}</li>\n        {{/each}}\n      </ul>\n      <div class="example">\n        <code>{{example}}</code>\n      </div>\n    </div>\n  {{/each}}\n</div>'},60:function(e,t,n){},79:function(e,t,n){"use strict";n.r(t);var r=n(2),o=n(0),i=n(28),s=n.n(i);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(i,e);var t,n,r,o=p(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this,{layerName:i.NAME})).popup_=null,t.searchUrl_=e,t}return t=i,(n=[{key:"setMap",value:function(e){c(f(i.prototype),"setMap",this).call(this,e),M.utils.isNullOrEmpty(e)?this.facadeMap_.getImpl().removeFeatures([this.positionFeature_]):this.map=e}},{key:"locate",value:function(){var e,t=this,n=new ol.Geolocation({projection:this.facadeMap_.getMapImpl().getView().getProjection()});return n.setTracking(!0),this.positionFeature_=M.impl.Feature.olFeature2Facade(new ol.Feature),this.positionFeature_.getImpl().getOLFeature().setStyle(new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"#3399CC"}),stroke:new ol.style.Stroke({color:"#fff",width:2})})})),this.positionFeature_.click=function(n){var r={jsonp:!0,vars:{valorX:e[0],valorY:e[1]},parseToHtml:!1},o={icon:"g-cartografia-gps2",title:"posición",content:M.template.compileSync(s.a,r)};t.popup_=t.facadeMap_.getPopup(),M.utils.isNullOrEmpty(t.popup_)?(t.popup_=new M.Popup,t.popup_.addTab(o),t.facadeMap_.addPopup(t.popup_,e)):t.popup_.addTab(o)},new Promise((function(r,o){n.on("change:position",(function(){n.setTracking(!1),e=n.getPosition(),r(e)}),t)}))}},{key:"removeLocate",value:function(){this.facadeMap_.removeFeatures([this.positionFeature_])}},{key:"drawLocation",value:function(e){this.positionFeature_.getImpl().getOLFeature().setGeometry(e?new ol.geom.Point(e):null),this.facadeMap_.drawFeatures([this.positionFeature_])}},{key:"addResultsContainer",value:function(e){this.map.getTargetElement().appendChild(e)}},{key:"removeResultsContainer",value:function(e){null!==e&&null!=e.parentElement&&e.parentElement.removeChild(e)}},{key:"zoomToResultsAll",value:function(){var e=this.facadeMap_.getControls("geosearchbylocation")[0].getImpl().getLayer().getFeaturesExtent();this.facadeMap_.setBbox(e)}},{key:"destroy",value:function(){this.facadeMap_.getMapImpl().removeControl(this),this.clear(),this.facadeMap_.removeFeatures([this.positionFeature_]),this.popup_=null,this.searchUrl_=null}}])&&l(t.prototype,n),r&&l(t,r),i}(o.a);y.POPUP_LOCATION="geosearchbylocationfeaturepopup.html";var d=n(29),m=n.n(d),g=n(30),_=n.n(g);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=L(e);if(t){var o=L(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return S(this,n)}}function S(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(s,e);var t,n,o,i=w(s);function s(e,t,n,r,o,a){var l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(l=i.call(this,e,t,n)).impl_=new y(l.searchUrl_),l.activate_=!0,l.activatebtnList_=!0,l.distance_=r,l.spatialField_=o,l.rows_=a,l.searchUrl_=M.utils.concatUrlPaths([e,t,n]),l.facadeMap_=null,l.resultsScrollContainer_=null,M.utils.isUndefined(y)&&M.Exception("La implementación usada no puede crear controles Geosearchbylocation"),l.name=s.NAME,l}return t=s,(n=[{key:"equals",value:function(e){var t=!1;return e instanceof s&&(t=this.name===e.name),t}},{key:"createView",value:function(e){return this.facadeMap_=e,M.template.compileSync(m.a,{jsonp:!0})}},{key:"getActivationButton",value:function(e){return e.querySelector("button#m-geosearchbylocation-button")}},{key:"activate",value:function(){var e=this;this.element_.classList.add("activated"),this.element_.classList.add(r.a.SEARCHING_CLASS),this.getImpl().locate().then((function(t){var n=new ol.geom.Point(t),r=(new ol.format.WKT).writeGeometry(n);e.searchFrom_(r,t)}))}},{key:"deactivate",value:function(){this.element_.classList.remove("activated"),this.getImpl().clear(),this.getImpl().removeLocate(),this.getImpl().removeResultsContainer(this.resultsContainer_)}},{key:"drawLocation_",value:function(e){this.getImpl().drawLocation(e)}},{key:"searchFrom_",value:function(e,t){var n,o,i=this;n=M.utils.addParameters(this.searchUrl_,{wt:"json",pt:e,q:"*:*",start:0,d:this.distance_,spatialField:this.spatialField_,rows:this.rows_,srs:this.map_.getProjection().code}),this.searchTime_=Date.now(),o=this.searchTime_,M.remote.get(n).then((function(e){if(o===i.searchTime_){var n;try{n=JSON.parse(e.text)}catch(e){M.Exception("La respuesta no es un JSON válido:".concat(e))}i.showResults_(n),i.drawLocation_(t),i.zoomToResultsAll_(),i.activationBtn_.classList.remove(r.a.HIDDEN_RESULTS_CLASS),i.element_.classList.remove(r.a.SEARCHING_CLASS)}}))}},{key:"zoomToResultsAll_",value:function(){this.getImpl().zoomToResultsAll()}},{key:"showResults_",value:function(e){this.getImpl().clear(),this.results=e,this.showList=!0,this.drawResults(e),this.element_.querySelector("button#m-geosearchbylocation-button-list").onclick=this.showList_.bind(this)}},{key:"showList_",value:function(){var e=this;if(!0===this.showList){var t={jsonp:!0,vars:this.parseResultsForTemplate_(this.results)},n=M.template.compileSync(_.a,t);this.resultsContainer_=n,this.resultsScrollContainer_=this.resultsContainer_.querySelector("div#m-geosearchbylocation-results-scroll"),M.utils.enableTouchScroll(this.resultsScrollContainer_),this.getImpl().addResultsContainer(this.resultsContainer_);for(var r=this.resultsContainer_.getElementsByClassName("result"),o=0,i=r.length;o<i;o+=1)r.item(o).addEventListener("click",(function(t){e.resultClick_(t),e.getImpl().removeResultsContainer(e.resultsContainer_),e.showList=!0}));n.querySelector(".title > button.m-panel-btn").addEventListener("click",this.showList_.bind(this)),this.showList=!1}else this.getImpl().removeResultsContainer(this.resultsContainer_),this.showList=!0}},{key:"resultsClick_",value:function(e){this.resultsContainer_.classList.toggle(r.a.HIDDEN_RESULTS_CLASS)}}])&&b(t.prototype,n),o&&b(t,o),s}(r.a);O.NAME="geosearchbylocation",O.HIDDEN="hidden",O.TEMPLATE="geosearchbylocation.html",O.RESULTS_TEMPLATE="geosearchbylocationresults.html";n(60);var k=n(31);function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=F(e);if(t){var o=F(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return P(this,n)}}function P(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(i,M.Plugin);var t,n,r,o=R(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return C(this,i),(e=o.call(this)).name=i.NAME,e.url_=M.config.GEOSEARCH_URL,M.utils.isNullOrEmpty(t.url)||(e.url_=t.url),e.core_=M.config.GEOSEARCH_CORE,M.utils.isNullOrEmpty(t.core)||(e.core_=t.core),e.handler_=M.config.GEOSEARCH_HANDLER,M.utils.isNullOrEmpty(t.handler)||(e.handler_=t.handler),e.distance_=M.config.GEOSEARCH_DISTANCE,M.utils.isNullOrEmpty(t.distance)||(e.distance_=t.distance),e.spatialField_=M.config.GEOSEARCH_SPATIAL_FIELD,e.rows_=M.config.GEOSEARCHBYLOCATION_ROWS,e.map_=null,e.controlGeo_=null,e.panel_=null,e.metadata_=k.metadata,e}return t=i,(n=[{key:"addTo",value:function(e){var t=this;this.map_=e,this.controlGeo_=new O(this.url_,this.core_,this.handler_,this.distance_,this.spatialField_,this.rows_),this.controlGeo_.on(M.evt.ADDED_TO_MAP,(function(){t.fire(M.evt.ADDED_TO_MAP)})),this.panel_=new M.ui.Panel(i.NAME,{collapsible:!1,className:"m-geosearchbylocation",position:M.ui.position.BR});var n=e.getPanels([M.control.Location.NAME])[0];M.utils.isNullOrEmpty(n)||M.utils.isNullOrEmpty(void 0)?M.utils.isNullOrEmpty(n)?M.utils.isNullOrEmpty(void 0)||((void 0).addClassName("m-with-geosearchbylocation"),this.panel_.addClassName("m-with-streetview")):(n.addClassName("m-with-geosearchbylocation"),this.panel_.addClassName("m-with-location")):(n.addClassName("m-with-geosearchbylocation"),(void 0).addClassName("m-with-geosearchbylocation"),this.panel_.addClassName("m-with-location m-with-streetview")),this.panel_.addControls(this.controlGeo_),this.map_.addPanels(this.panel_)}},{key:"destroy",value:function(){this.map_.removeControls([this.controlGeo_]),this.controlGeo_=null,this.name=null,this.url_=null,this.core_=null,this.handler_=null,this.distance_=null,this.spatialField_=null,this.rows_=null,this.map_=null,this.controlGeo_=null,this.panel_=null}},{key:"getControls",value:function(){var e=[];return e.push(this.controlGeo_),e}},{key:"equals",value:function(e){return e instanceof i}},{key:"getAPIRest",value:function(){return"geosearchbylocation=".concat(this.distance_,"*").concat(this.url_,"*").concat(this.core_,"*").concat(this.handler_)}},{key:"getMetadata",value:function(){return this.metadata_}}])&&N(t.prototype,n),r&&N(t,r),i}();D.NAME="geosearchbylocation",null==window.M.plugin&&(window.M.plugin={}),window.M.plugin.Geosearchbylocation=D}});