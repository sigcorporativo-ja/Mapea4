!function(e){var t={};function s(l){if(t[l])return t[l].exports;var r=t[l]={i:l,l:!1,exports:{}};return e[l].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,l){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(s.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(l,r,function(t){return e[t]}.bind(null,r));return l},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=83)}({0:function(e,t,s){"use strict";class l{static init(){if(!1===l.initialized){l.initialized=!0;const e=document.createElement("img");e.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24.svg"]),e.width="24",e.height="24",e.crossOrigin="anonymous";const t=document.createElement("IMG");t.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-new.svg"]),t.width="24",t.height="24",t.crossOrigin="anonymous";const s=document.createElement("IMG");s.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-sel.svg"]),s.width="24",s.height="24",s.crossOrigin="anonymous",l.DEFAULT[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:e,imgSize:[24,24]})}),l.DEFAULT[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#A15BD7"}),stroke:new ol.style.Stroke({color:"#A15BD7",width:2})}),l.DEFAULT[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:e,imgSize:[24,24]})}),l.DEFAULT[M.geom.wkt.type.MULTI_POINT]=l.DEFAULT[M.geom.wkt.type.POINT],l.DEFAULT[M.geom.wkt.type.LINEAR_RING]=l.DEFAULT[M.geom.wkt.type.LINE_STRING],l.DEFAULT[M.geom.wkt.type.MULTI_LINE_STRING]=l.DEFAULT[M.geom.wkt.type.LINE_STRING],l.DEFAULT[M.geom.wkt.type.MULTI_POLYGON]=l.DEFAULT[M.geom.wkt.type.POLYGON],l.DEFAULT[M.geom.wkt.type.CIRCLE]=l.DEFAULT[M.geom.wkt.type.POLYGON],l.DEFAULT[M.geom.wkt.type.GEOMETRY_COLLECTION]=l.DEFAULT[M.geom.wkt.type.POLYGON],l.NEW[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:t,imgSize:[24,24]})}),l.NEW[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#e2951b"}),stroke:new ol.style.Stroke({color:"#e2951b",width:2})}),l.NEW[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:t,imgSize:[24,24]})}),l.NEW[M.geom.wkt.type.MULTI_POINT]=l.NEW[M.geom.wkt.type.POINT],l.NEW[M.geom.wkt.type.LINEAR_RING]=l.NEW[M.geom.wkt.type.LINE_STRING],l.NEW[M.geom.wkt.type.MULTI_LINE_STRING]=l.NEW[M.geom.wkt.type.LINE_STRING],l.NEW[M.geom.wkt.type.MULTI_POLYGON]=l.NEW[M.geom.wkt.type.POLYGON],l.NEW[M.geom.wkt.type.CIRCLE]=l.NEW[M.geom.wkt.type.POLYGON],l.NEW[M.geom.wkt.type.GEOMETRY_COLLECTION]=l.NEW[M.geom.wkt.type.POLYGON],l.SELECTED[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:s,imgSize:[24,24]})}),l.SELECTED[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#fcfcfc"}),stroke:new ol.style.Stroke({color:"#3589d1",width:2})}),l.SELECTED[M.geom.wkt.type.POLYGON]=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(240, 220, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#a15bd7",width:2})}),l.SELECTED[M.geom.wkt.type.MULTI_POINT]=l.SELECTED[M.geom.wkt.type.POINT],l.SELECTED[M.geom.wkt.type.LINEAR_RING]=l.SELECTED[M.geom.wkt.type.LINE_STRING],l.SELECTED[M.geom.wkt.type.MULTI_LINE_STRING]=l.SELECTED[M.geom.wkt.type.LINE_STRING],l.SELECTED[M.geom.wkt.type.MULTI_POLYGON]=l.SELECTED[M.geom.wkt.type.POLYGON],l.SELECTED[M.geom.wkt.type.CIRCLE]=l.SELECTED[M.geom.wkt.type.POLYGON],l.SELECTED[M.geom.wkt.type.GEOMETRY_COLLECTION]=l.SELECTED[M.geom.wkt.type.POLYGON]}}}l.DEFAULT={},l.NEW={},l.SELECTED={},l.initialized=!1;class r{static getCentroidCoordinate(e){let t,s,l,i,a,n;return e.getType()===M.geom.wkt.type.POINT?t=e.getCoordinates():e.getType()===M.geom.wkt.type.LINE_STRING||e.getType()===M.geom.wkt.type.LINEAR_RING?(s=e.getCoordinates(),l=Math.floor(s.length/2),t=s[l]):e.getType()===M.geom.wkt.type.POLYGON?t=r.getCentroidCoordinate(e.getInteriorPoint()):e.getType()===M.geom.wkt.type.MULTI_POINT?(i=e.getPoints(),l=Math.floor(i.length/2),t=r.getCentroidCoordinate(i[l])):e.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(a=e.getLineStrings(),l=Math.floor(a.length/2),t=r.getCentroidCoordinate(a[l])):e.getType()===M.geom.wkt.type.MULTI_POLYGON?(i=e.getInteriorPoints(),t=r.getCentroidCoordinate(i)):e.getType()===M.geom.wkt.type.CIRCLE?t=e.getCenter():e.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(n=e.getGeometries(),l=Math.floor(n.length/2),t=r.getCentroidCoordinate(n[l])),t}}var i=s(4),a=s.n(i);class n extends M.impl.layer.Vector{constructor(e="geosearch",t={}){const s=t;super(s),this.wktFormatter_=new ol.format.WKT,this.popup_=null,this.selectedFeatures_=[],s.displayInLayerSwitcher||(s.displayInLayerSwitcher=!1),this.name=e}addTo(e){super.addTo(e),this.ol3Layer.setSource(new ol.source.Vector({useSpatialIndex:!1}))}drawResults(e){const t=ol.proj.get(this.map.getProjection().code);let s=[];M.utils.isNullOrEmpty(e.spatial_response)||(s=e.spatial_response.docs),M.utils.isNullOrEmpty(s)&&(s=e.response.docs);const l=s.map(e=>{const s=this.wktFormatter_.readFeature(e.geom,{dataProjection:t});return s.setId(e.solrid),s.setProperties(e),n.setStyleFeature(s,M.style.state.DEFAULT),this.wrapComplexFeature_(s),M.impl.Feature.olFeature2Facade(s)},this);this.facadeVector_.addFeatures(l)}drawNewResults(e){const t=ol.proj.get(this.map.getProjection().code);let s;M.utils.isNullOrEmpty(e.spatial_response)?M.utils.isNullOrEmpty(e.response)||(s=e.response.docs):s=e.spatial_response.docs;const l=s.map(e=>{const s=this.wktFormatter_.readFeature(e.geom,{dataProjection:t});return s.setId(e.solrid),s.setProperties(e),n.setStyleFeature(s,M.style.state.NEW),M.impl.Feature.olFeature2Facade(s)},this);this.facadeVector_.addFeatures(l)}clear(e){this.map.removePopup(),this.facadeVector_.clear()}selectFeatures(e,t,s,l){let r=e;this.unselectFeatures(),this.selectedFeatures_=r,r=r.map(M.impl.Feature.facade2OLFeature),n.setStyleFeature(r,M.style.state.SELECTED);const i={jsonp:!0,vars:this.parseFeaturesForTemplate_(r),parseToHtml:!1},o={icon:"g-cartografia-pin",title:"Geosearch",content:M.template.compileSync(a.a,i)};let c=this.map.getPopup();M.utils.isNullOrEmpty(c)?(c=new M.Popup({panMapIfOutOfView:!l,ani:null}),c.addTab(o),this.map.addPopup(c,t)):c.addTab(o),c.on(M.evt.DESTROY,()=>{this.internalUnselectFeatures_(!0)},this)}selectFeatureBySolrid(e){const t=this.facadeVector_.getFeatureById(e);this.selectedFeatures_=[t];const s=t.getImpl().getOLFeature().getGeometry(),l=r.getCentroidCoordinate(s);this.unselectFeatures(),this.selectFeatures([t],l,null,!0),this.map.setBbox(s.getExtent())}parseFeaturesForTemplate_(e){const t={features:[]};return e.forEach(e=>{const s=["geom","_version_","keywords","solrid",e.getGeometryName()],l=e.getProperties(),r=[];Object.keys(l).forEach(e=>{M.utils.includes(s,e.toLowerCase())||r.push({key:M.utils.beautifyAttributeName(e),value:l[e]})});const i={solrid:e.getId(),attributes:r};t.features.push(i)}),t}wrapComplexFeature_(e){const t=e.getGeometry();if(t.getType()===M.geom.wkt.type.POLYGON||t.getType()===M.geom.wkt.type.MULTI_POLYGON){let s;s=t.getType()===M.geom.wkt.type.POLYGON?t.getInteriorPoint():t.getInteriorPoints();const l=new ol.geom.GeometryCollection([s,t]);e.setGeometry(l)}}unselectFeatures(e,t){this.internalUnselectFeatures_()}internalUnselectFeatures_(e){this.selectedFeatures_.length>0&&(n.setStyleFeature(this.selectedFeatures_.map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT),this.selectedFeatures_.length=0,e||this.map.removePopup())}setNewResultsAsDefault(){n.setStyleFeature(this.facadeVector_.getFeatures().map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT)}getCentroidCoordinate(e){let t,s,l,r,i,a;return e.getType()===M.geom.wkt.type.POINT?t=e.getCoordinates():e.getType()===M.geom.wkt.type.LINE_STRING||e.getType()===M.geom.wkt.type.LINEAR_RING?(s=e.getCoordinates(),l=Math.floor(s.length/2),t=s[l]):e.getType()===M.geom.wkt.type.POLYGON?t=this.getCentroidCoordinate(e.getInteriorPoint()):e.getType()===M.geom.wkt.type.MULTI_POINT?(r=e.getPoints(),l=Math.floor(r.length/2),t=this.getCentroidCoordinate(r[l])):e.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(i=e.getLineStrings(),l=Math.floor(i.length/2),t=this.getCentroidCoordinate(i[l])):e.getType()===M.geom.wkt.type.MULTI_POLYGON?(r=e.getInteriorPoints(),t=this.getCentroidCoordinate(r)):e.getType()===M.geom.wkt.type.CIRCLE?t=e.getCenter():e.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(a=e.getGeometries(),l=Math.floor(a.length/2),t=this.getCentroidCoordinate(a[l])),t}destroy(){const e=this.map.getMapImpl();M.utils.isNullOrEmpty(this.ol3Layer)||(e.removeLayer(this.ol3Layer),this.ol3Layer=null),this.map=null,this.wktFormatter_=null,this.popup_=null,this.selectedFeatures_=null,this.name=null}equals(e){let t=!1;return e instanceof n&&(t=this.url===e.url,t=t&&this.name===e.name),t}static setStyleFeature(e,t){let s=e;l.init(),M.utils.isArray(s)||(s=[s]),s.forEach(e=>{const s=e.getGeometry().getType();M.utils.isNullOrEmpty(t)||t===M.style.state.DEFAULT?e.setStyle(l.DEFAULT[s]):t===M.style.state.NEW?e.setStyle(l.NEW[s]):t===M.style.state.SELECTED&&e.setStyle(l.SELECTED[s])})}}n.POPUP_RESULT="geosearchfeaturepopup.html";class o extends M.layer.Vector{constructor(e={},t={},s=new n){super(e,t,{},s),M.utils.isUndefined(n)&&M.exception("La implementación usada no puede crear capas Geosearch"),this.displayInLayerSwitcher=!1}equals(e){return!1}}s.d(t,"a",(function(){return c}));class c extends M.impl.Control{constructor(e={}){super(),this.facadeMap_=null,this.helpHtml_=null,this.layer_=new o({name:e.layerName||"__geosearch_plugin_layer_name__"})}addTo(e,t){this.facadeMap_=e,e.addLayers(this.layer_),super.addTo(e,t)}unselectResults(e){this.layer_.getImpl().unselectFeatures(e)}setNewResultsAsDefault(){this.layer_.getImpl().setNewResultsAsDefault()}drawResults(e){this.layer_.getImpl().drawResults(e)}drawNewResults(e){this.layer_.getImpl().drawNewResults(e)}zoomToResults(){const e=ol.extent.boundingExtent(this.layer_.getImpl().getOLLayer().getSource().getFeatures().map(e=>ol.extent.getCenter(e.getGeometry().getExtent())));this.facadeMap_.setBbox(e)}getLayer(){return this.layer_}resultClick(e){this.layer_.getImpl().selectFeatureBySolrid(e)}hideHelp(){M.utils.isNullOrEmpty(this.helpHtml_)||(this.facadeMap_.getMapImpl().getTargetElement().removeChild(this.helpHtml_),this.helpHtml_=null)}showHelp(e){const t=this.facadeMap_.getMapImpl().getTargetElement();M.utils.isNullOrEmpty(this.helpHtml_)||t.removeChild(this.helpHtml_),this.helpHtml_=e,t.appendChild(this.helpHtml_)}clear(){this.layer_.clear()}destroy(){this.clear(),this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.remove("top-extra"),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.helpHtml_=null,this.layer_=null}}},1:function(e,t){e.exports='<div class="results-panels">\n   {{#if partial}}\n   <div class="partial">\n      <p>No se han encontrado resultados para la búsqueda.</p>\n      <p>A continuación se muestran otros resultados que quizás le interesen:...</p>\n   </div>\n   {{/if}}\n   <div class="results" id="m-geosearch-results-scroll">\n      {{#each docs}}\n      <div id="{{solrid}}" class="result">\n         {{#each attributes}}\n         <table>\n            <tbody>\n               <tr>\n                  <td class="key">{{key}}</td>\n                  <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n               </tr>\n            </tbody>\n         </table>\n         {{/each}}\n      </div>\n      {{/each}}\n   </div>\n   {{#eq docs.length 0}}\n   <div class="results">\n      <div class="partial">No se han encontrado resultados para la búsqueda "{{query}}".</div>\n   </div>\n   {{/eq}}\n   <div class="page">\n      <span class="found" id="m-geosearch-page-found">{{docs.length}}</span> de <span class="total">{{total}}</span>\n      <div class="g-cartografia-flecha-arriba"></div>\n   </div>\n</div>'},2:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var l=s(0),r=s(5),i=s.n(r),a=s(1),n=s.n(a),o=s(6),c=s.n(o);class h extends M.Control{constructor(e,t,s,r,i){super(new l.a,h.NAME),M.utils.isUndefined(l.a)&&M.exception("La implementación usada no puede crear controles Geosearch"),this.input_=null,this.element_=null,this.resultsContainer_=null,this.resultsScrollContainer_=null,this.searchingResult_=null,this.searchTime_=0,this.url_=e,this.core_=t,this.handler_=s,this.searchUrl_=M.utils.concatUrlPaths([this.url_,this.core_,this.handler_]),this.helpUrl_=M.utils.concatUrlPaths([this.url_,this.core_,"/help"]),this.searchParameters_=r,M.utils.isNullOrEmpty(this.searchParameters_)||(M.utils.isNullOrEmpty(this.searchParameters_.rows)&&(this.searchParameters_.rows=M.config.GEOSEARCH_ROWS),this.searchUrl_=M.utils.addParameters(this.searchUrl_,this.searchParameters_)),this.results_=[],this.showHelp_=i,this.scrollIsUp_=!0,this.spatialSearch_=!1,this.facadeMap_=null}createView(e){this.facadeMap_=e;const t=M.template.compileSync(i.a,{jsonp:!0});return!1===this.showHelp_&&t.querySelector("#m-geosearch-help-btn").classList.add("m-hidden"),this.addEvents(t),t}addEvents(e){this.element_=e,this.on(M.evt.COMPLETED,()=>{this.element_.classList.add("shown")},this),this.input_=this.element_.getElementsByTagName("input")["m-geosearch-search-input"],this.input_.addEventListener("keyup",this.searchClick.bind(this));this.element_.getElementsByTagName("button")["m-geosearch-search-btn"].addEventListener("click",this.searchClick.bind(this));const t=this.element_.getElementsByTagName("button")["m-geosearch-help-btn"];t&&t.addEventListener("click",e=>{e.preventDefault(),t.classList.toggle("shown"),this.helpClick_()});this.element_.getElementsByTagName("button")["m-geosearch-clear-btn"].addEventListener("click",this.clearClick_.bind(this)),this.resultsContainer_=this.element_.querySelector("div#m-geosearch-results"),M.utils.enableTouchScroll(this.resultsContainer_),this.searchingResult_=this.element_.querySelector("div#m-geosearch-results > div#m-searching-result")}addEventsHelp(e){this.element_=e;this.element_.getElementsByTagName("button")["m-geosearch-closeHelp-btn"].addEventListener("click",this.closeHelpClick_.bind(this))}searchClick(e){if(e.preventDefault(),"keyup"!==e.type||13===e.keyCode){this.results_.length=0;const e=this.input_.value;M.utils.isNullOrEmpty(e)?M.dialog.info("Debe introducir una búsqueda."):this.search_(e,this.showResults_)}}resultClick_(e){const t=e;if(t.preventDefault(),M.window.WIDTH<=M.config.MOBILE_WIDTH){this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba").click()}this.facadeMap_.removePopup();const s=t.currentTarget.id;this.getImpl().resultClick(s)}search_(e,t){this.resultsContainer_.appendChild(this.searchingResult_),this.searchTime_=Date.now(),this.element_.classList.add(h.SEARCHING_CLASS);const s=M.utils.addParameters(this.searchUrl_,{q:e,start:this.results_.length,srs:this.facadeMap_.getProjection().code});(e=>{M.remote.get(s).then(s=>{if(e===this.searchTime_){let e;try{e=JSON.parse(s.text)}catch(e){M.exception("La respuesta no es un JSON válido: "+e)}t.call(this,e),this.element_.classList.remove(h.SEARCHING_CLASS)}})})(this.searchTime_)}showResults_(e){this.getImpl().clear(),this.drawResults(e);const t={jsonp:!0,vars:this.parseResultsForTemplate_(e)},s=M.template.compileSync(n.a,t);this.resultsContainer_.classList.remove(h.HIDDEN_RESULTS_CLASS),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_);let l,r=this.resultsContainer_.querySelectorAll(".result");for(let e=0,t=r.length;e<t;e+=1)l=r.item(e),l.removeEventListener("click",this.resultClick_.bind(this));e.response.docs.length>0&&this.zoomToResults();let i=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba");M.utils.isNullOrEmpty(i)||i.removeEventListener("click",this.resultsClick_.bind(this)),this.resultsContainer_.innerHTML=s.innerHTML,this.resultsScrollContainer_=this.resultsContainer_.querySelector("div#m-geosearch-results-scroll"),M.utils.enableTouchScroll(this.resultsScrollContainer_),this.resultsScrollContainer_.addEventListener("scroll",this.resultsScroll_.bind(this)),r=this.resultsContainer_.getElementsByClassName("result");for(let e=0,t=r.length;e<t;e+=1)l=r.item(e),l.addEventListener("click",this.resultClick_.bind(this));i=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba"),i.addEventListener("click",this.resultsClick_.bind(this)),this.checkScrollSearch_(e),this.fire(M.evt.COMPLETED)}drawResults(e){this.getImpl().drawResults(e)}drawNewResults(e){this.getImpl().drawNewResults(e)}zoomToResults(){this.getImpl().zoomToResults()}getInput(){return this.input_}appendResults_(e){this.drawNewResults(e);const t={jsonp:!0,vars:this.parseResultsForTemplate_(e,!0)},s=M.template.compileSync(n.a,t).getElementsByTagName("div")["m-geosearch-results-scroll"].children;for(let e=0;e<s.length;e+=1){const t=s.item(e);this.resultsScrollContainer_.appendChild(t),t.addEventListener("click",e=>this.resultClick_(e))}this.resultsContainer_.getElementsByTagName("span")["m-geosearch-page-found"].innerHTML=this.results_.length,this.checkScrollSearch_(e)}resultsScroll_(e){const t=e.target,s=t.offsetHeight,l=t.scrollHeight-t.scrollTop-s<=15;l&&this.scrollIsUp_?(this.scrollIsUp_=!1,this.scrollSearch_()):l||(this.scrollIsUp_=!0)}scrollSearch_(){this.getImpl().unselectResults(!0),this.getImpl().setNewResultsAsDefault();const e=this.input_.value;this.search_(e,this.appendResults_)}helpClick_(e){!0===this.helpShown_?(this.getImpl().hideHelp(),this.helpShown_=!1):M.remote.get(this.helpUrl_).then(e=>{let t;try{t=JSON.parse(e.text)}catch(e){M.Exception("La respuesta no es un JSON válido: "+e)}const s={jsonp:!0,vars:{entities:t}},l=M.template.compileSync(c.a,s);this.addEventsHelp(l),this.getImpl().showHelp(l),this.helpShown_=!0})}closeHelpClick_(e){!0===this.helpShown_&&(this.getImpl().hideHelp(),this.helpShown_=!1)}clearClick_(e){this.element_.classList.remove("shown"),M.utils.isNullOrEmpty(this.input_)||(this.input_.value=""),M.utils.isNullOrEmpty(this.resultsContainer_)||(this.resultsContainer_.innerHTML=""),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||(this.resultsScrollContainer_.innerHTML="",this.resultsScrollContainer_=null),this.results_.length=0,this.resultsContainer_.classList.remove(h.HIDDEN_RESULTS_CLASS),this.getImpl().clear(),this.getImpl().hideHelp(),this.spatialSearch_=!1}resultsClick_(e){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra-search"),e.target.classList.toggle("g-cartografia-flecha-arriba"),e.target.classList.toggle("g-cartografia-flecha-abajo"),this.resultsContainer_.classList.toggle(h.HIDDEN_RESULTS_CLASS)}equals(e){let t=!1;return e instanceof h&&(t=this.name===e.name),t}parseResultsForTemplate_(e,t){let s="";M.utils.isNullOrEmpty(this.input_)||(s=this.input_.value);let l=0;M.utils.isUndefined(e.spatial_response)?(l=e.response.numFound,this.spatialSearch_=!1):(l=e.spatial_response.numFound,this.spatialSearch_=!0);const r=this.getDocsFromResults_(e);this.results_=!0===t?this.results_.concat(r):r;const i=this.spatialSearch_&&M.utils.isNullOrEmpty(e.spatial_response.docs);let a=null;return a=0!==l?{docs:r,total:l,partial:i}:{docs:r,total:l,notResutls:!0,query:s},a}getDocsFromResults_(e){let t=[];t=this.spatialSearch_?e.spatial_response.docs:e.response.docs;const s=["geom","_version_","keywords","solrid"];return t=t.map(e=>{const t=[];return Object.keys(e).forEach(l=>{M.utils.includes(s,l)||t.push({key:M.utils.beautifyAttributeName(l),value:e[l]})}),{solrid:e.solrid,attributes:t}}),t}checkScrollSearch_(e){let t=0;t=M.utils.isUndefined(e.spatial_response)?e.response.numFound:e.spatial_response.numFound,this.results_.length!==t||M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_)}}h.NAME="geosearch",h.TEMPLATE="geosearch.html",h.RESULTS_TEMPLATE="geosearchresults.html",h.HELP_TEMPLATE="geosearchhelp.html",h.SEARCHING_CLASS="m-searching",h.HIDDEN_RESULTS_CLASS="hidden"},21:function(e){e.exports=JSON.parse('{"url":{"name":"geosearch","separator":"*"},"constructor":"M.plugin.Geosearch","parameters":[{"type":"object","properties":[{"type":"simple","name":"url","position":0},{"type":"simple","name":"core","position":1},{"type":"simple","name":"handler","position":2}]}],"files":{"ol":{"scripts":["geosearch-2.0.4.ol.min.js"],"styles":["geosearch-2.0.4.min.css"]}},"metadata":{"uuid_plugin":"","uuid_version_plugin":"","version_ficha_metadatos":"","name":"Geosearch","description":"","text":"","version":"2.0.4","date":"11/10/2019","author":"Junta de Andalucía","org":"Junta de Andalucía","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","buttons":[{"title":"","description":"","querySelector":""},{"title":"","description":"","querySelector":""}],"dependencies":{"modules":["",""],"plugins":[{"uuid":"","name":""}],"services":[{"name":"","description":""}]},"compatibility":["4","5","6"]}}')},4:function(e,t){e.exports='<div class="m-geosearch-content">\n   {{#each features}}\n   <div id="{{solrid}}" class="result">\n      {{#each attributes}}\n      <table>\n         <tr>\n            <td class="key">{{key}}</td>\n            <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n         </tr>\n      </table>\n      {{/each}}\n   </div>\n   <div class="m-separator"></div>\n   {{/each}}\n</div>'},5:function(e,t){e.exports='<div class="m-control m-geosearch-container">\n  \x3c!-- search panel --\x3e\n  <div class="search-panel">\n    <input type="text" id="m-geosearch-search-input" placeholder="Buscar" class="m-input-search" />\n    <button id="m-geosearch-search-btn" class="g-cartografia-zoom m-search-btn" title="Buscar"></button>\n    <button id="m-geosearch-help-btn" class="g-cartografia-ayuda m-help-btn" title="Ayuda"></button>\n    <button id="m-geosearch-clear-btn" class="g-cartografia-cancelar m-clear-btn" title="Limpiar búsqueda"></button>\n  </div>\n  \x3c!-- results panel --\x3e\n  <div class="results-panel" id="m-geosearch-results">\n    <div id="m-searching-result" class="m-searching-result g-cartografia-spinner"></div>\n  </div>\n</div>'},56:function(e,t,s){},6:function(e,t){e.exports='<div class="m-geosearch-help">\n  {{#eq entities.length 0}}\n    <div class="entity">\n      <p>El servicio no tiene ayuda configurada</p>\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar" title="Cerrar ayuda"></button>\n    </div>\n  {{/eq}}\n  {{#each entities}}\n    <div class="entity">\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar m-clear-btn" title="Cerrar ayuda"></button>\n      <div class="name">{{entity}}</div>\n      <div class="info">{{info}}</div>\n      <ul class="keywords">\n        {{#each keywords}}\n          <li>{{this}}</li>\n        {{/each}}\n      </ul>\n      <div class="example">\n        <code>{{example}}</code>\n      </div>\n    </div>\n  {{/each}}\n</div>'},83:function(e,t,s){"use strict";s.r(t);var l=s(2),r=(s(56),s(21));class i extends M.Plugin{constructor(e={}){super(),this.map_=null,this.control_=null,this.panel_=null,this.name=i.NAME,this.url_=M.config.GEOSEARCH_URL,M.utils.isNullOrEmpty(e.url)||(this.url_=e.url),this.core_=M.config.GEOSEARCH_CORE,M.utils.isNullOrEmpty(e.core)||(this.core_=e.core),this.handler_=M.config.GEOSEARCH_HANDLER,M.utils.isNullOrEmpty(e.handler)||(this.handler_=e.handler),this.searchParameters_=e.params||{},this.showHelp_=e.showHelp,this.metadata_=r.metadata}addTo(e){this.map_=e,e.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra"),this.control_=new l.a(this.url_,this.core_,this.handler_,this.searchParameters_,this.showHelp_),this.control_.on(M.evt.ADDED_TO_MAP,()=>{this.fire(M.evt.ADDED_TO_MAP)}),this.control_.on(M.evt.ADD_TO_MAP,this.onLoadCallback_,this),this.panel_=new M.ui.Panel("geosearch",{collapsible:!0,className:"m-geosearch",collapsedButtonClass:"g-cartografia-zoom",position:M.ui.position.TL,tooltip:"Geobúsquedas"}),this.panel_.addControls(this.control_),this.map_.addPanels(this.panel_)}getInput(){let e=null;return M.utils.isNullOrEmpty(this.control_)||(e=this.control_.getInput()),e}destroy(){this.map_.removeControls([this.control_]),this.map_=null,this.control_=null,this.panel_=null,this.url_=null,this.core_=null,this.handler_=null,this.searchParameters_=null}getControls(){const e=[];return e.push(this.control_),e}equals(e){return e instanceof i}getAPIRest(){return`geosearch=${this.url_}*${this.core_}*${this.handler_}`}getMetadata(){return this.metadata_}}i.NAME="geosearch",null==window.M.plugin&&(window.M.plugin={}),window.M.plugin.Geosearch=i}});