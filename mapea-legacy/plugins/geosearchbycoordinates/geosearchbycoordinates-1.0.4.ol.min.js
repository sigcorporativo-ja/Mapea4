/*! For license information please see geosearchbycoordinates.ol.min.js.LICENSE.txt */
(()=>{var t={384:function(t,e,s){!function(e,i){t.exports?t.exports=i(e,s(131),s(842)):e.Draggabilly=i(e,e.getSize,e.Unidragger)}("undefined"!=typeof window?window:this,(function(t,e,s){let i=t.jQuery;function n(t,e){this.element="string"==typeof t?document.querySelector(t):t,i&&(this.$element=i(this.element)),this.options={},this.option(e),this._create()}let o=n.prototype=Object.create(s.prototype);o.option=function(t){this.options={...this.options,...t}};const r=["relative","absolute","fixed"];o._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition={...this.position};let t=getComputedStyle(this.element);r.includes(t.position)||(this.element.style.position="relative"),this.on("pointerDown",this.handlePointerDown),this.on("pointerUp",this.handlePointerUp),this.on("dragStart",this.handleDragStart),this.on("dragMove",this.handleDragMove),this.on("dragEnd",this.handleDragEnd),this.setHandles(),this.enable()},o.setHandles=function(){let{handle:t}=this.options;"string"==typeof t?this.handles=this.element.querySelectorAll(t):"object"==typeof t&&t.length?this.handles=t:t instanceof HTMLElement?this.handles=[t]:this.handles=[this.element]};const a=["dragStart","dragMove","dragEnd"];let l=o.emitEvent;function h(t,e,s){return e?(s=s||"round",Math[s](t/e)*e):t}o.emitEvent=function(e,s){if(!this.isEnabled&&a.includes(e))return;l.call(this,e,s);let i,n=t.jQuery;if(!n||!this.$element)return;let o=s;s&&s[0]instanceof Event&&([i,...o]=s);let r=n.Event(i);r.type=e,this.$element.trigger(r,o)},o._getPosition=function(){let t=getComputedStyle(this.element),e=this._getPositionCoord(t.left,"width"),s=this._getPositionCoord(t.top,"height");this.position.x=isNaN(e)?0:e,this.position.y=isNaN(s)?0:s,this._addTransformPosition(t)},o._getPositionCoord=function(t,s){if(t.includes("%")){let i=e(this.element.parentNode);return i?parseFloat(t)/100*i[s]:0}return parseInt(t,10)},o._addTransformPosition=function(t){let e=t.transform;if(!e.startsWith("matrix"))return;let s=e.split(","),i=e.startsWith("matrix3d")?12:4,n=parseInt(s[i],10),o=parseInt(s[i+1],10);this.position.x+=n,this.position.y+=o},o.handlePointerDown=function(t,e){this.isEnabled&&(this.pointerDownPointer={pageX:e.pageX,pageY:e.pageY},t.preventDefault(),document.activeElement.blur(),this.bindActivePointerEvents(t),this.element.classList.add("is-pointer-down"))},o.handleDragStart=function(){this.isEnabled&&(this._getPosition(),this.measureContainment(),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this.element.classList.add("is-dragging"),this.animate())},o.measureContainment=function(){let t=this.getContainer();if(!t)return;let s=e(this.element),i=e(t),{borderLeftWidth:n,borderRightWidth:o,borderTopWidth:r,borderBottomWidth:a}=i,l=this.element.getBoundingClientRect(),h=t.getBoundingClientRect(),c=n+o,u=r+a,d=this.relativeStartPosition={x:l.left-(h.left+n),y:l.top-(h.top+r)};this.containSize={width:i.width-c-d.x-s.width,height:i.height-u-d.y-s.height}},o.getContainer=function(){let t=this.options.containment;if(t)return t instanceof HTMLElement?t:"string"==typeof t?document.querySelector(t):this.element.parentNode},o.handleDragMove=function(t,e,s){if(!this.isEnabled)return;let i=s.x,n=s.y,o=this.options.grid,r=o&&o[0],a=o&&o[1];i=h(i,r),n=h(n,a),i=this.containDrag("x",i,r),n=this.containDrag("y",n,a),i="y"==this.options.axis?0:i,n="x"==this.options.axis?0:n,this.position.x=this.startPosition.x+i,this.position.y=this.startPosition.y+n,this.dragPoint.x=i,this.dragPoint.y=n},o.containDrag=function(t,e,s){if(!this.options.containment)return e;let i="x"==t?"width":"height",n=h(-this.relativeStartPosition[t],s,"ceil"),o=this.containSize[i];return o=h(o,s,"floor"),Math.max(n,Math.min(o,e))},o.handlePointerUp=function(){this.element.classList.remove("is-pointer-down")},o.handleDragEnd=function(){this.isEnabled&&(this.element.style.transform="",this.setLeftTop(),this.element.classList.remove("is-dragging"))},o.animate=function(){this.isDragging&&(this.positionDrag(),requestAnimationFrame((()=>this.animate())))},o.setLeftTop=function(){let{x:t,y:e}=this.position;this.element.style.left=`${t}px`,this.element.style.top=`${e}px`},o.positionDrag=function(){let{x:t,y:e}=this.dragPoint;this.element.style.transform=`translate3d(${t}px, ${e}px, 0)`},o.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.setLeftTop()},o.enable=function(){this.isEnabled||(this.isEnabled=!0,this.bindHandles())},o.disable=function(){this.isEnabled&&(this.isEnabled=!1,this.isDragging&&this.dragEnd(),this.unbindHandles())};const c=["transform","left","top","position"];return o.destroy=function(){this.disable(),c.forEach((t=>{this.element.style[t]=""})),this.unbindHandles(),this.$element&&this.$element.removeData("draggabilly")},o._init=function(){},i&&i.bridget&&i.bridget("draggabilly",n),n}))},158:function(t){var e,s;e="undefined"!=typeof window?window:this,s=function(){function t(){}let e=t.prototype;return e.on=function(t,e){if(!t||!e)return this;let s=this._events=this._events||{},i=s[t]=s[t]||[];return i.includes(e)||i.push(e),this},e.once=function(t,e){if(!t||!e)return this;this.on(t,e);let s=this._onceEvents=this._onceEvents||{};return(s[t]=s[t]||{})[e]=!0,this},e.off=function(t,e){let s=this._events&&this._events[t];if(!s||!s.length)return this;let i=s.indexOf(e);return-1!=i&&s.splice(i,1),this},e.emitEvent=function(t,e){let s=this._events&&this._events[t];if(!s||!s.length)return this;s=s.slice(0),e=e||[];let i=this._onceEvents&&this._onceEvents[t];for(let n of s)i&&i[n]&&(this.off(t,n),delete i[n]),n.apply(this,e);return this},e.allOff=function(){return delete this._events,delete this._onceEvents,this},t},t.exports?t.exports=s():e.EvEmitter=s()},131:t=>{!function(e,s){t.exports?t.exports=s():e.getSize=s()}(window,(function(){function t(t){let e=parseFloat(t);return-1==t.indexOf("%")&&!isNaN(e)&&e}let e=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];return e.length,function(s){if("string"==typeof s&&(s=document.querySelector(s)),!s||"object"!=typeof s||!s.nodeType)return;let i=getComputedStyle(s);if("none"==i.display)return function(){let t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0};return e.forEach((e=>{t[e]=0})),t}();let n={};n.width=s.offsetWidth,n.height=s.offsetHeight;let o=n.isBorderBox="border-box"==i.boxSizing;e.forEach((t=>{let e=i[t],s=parseFloat(e);n[t]=isNaN(s)?0:s}));let r=n.paddingLeft+n.paddingRight,a=n.paddingTop+n.paddingBottom,l=n.marginLeft+n.marginRight,h=n.marginTop+n.marginBottom,c=n.borderLeftWidth+n.borderRightWidth,u=n.borderTopWidth+n.borderBottomWidth,d=t(i.width);!1!==d&&(n.width=d+(o?0:r+c));let p=t(i.height);return!1!==p&&(n.height=p+(o?0:a+u)),n.innerWidth=n.width-(r+c),n.innerHeight=n.height-(a+u),n.outerWidth=n.width+l,n.outerHeight=n.height+h,n}}))},515:t=>{t.exports='<div class="m-control m-geosearch-container">\n  \x3c!-- search panel --\x3e\n  <div class="search-panel">\n    <input type="text" id="m-geosearch-search-input" placeholder="Buscar" class="m-input-search" />\n    <button id="m-geosearch-search-btn" class="g-cartografia-zoom m-search-btn" title="Buscar"></button>\n    <button id="m-geosearch-help-btn" class="g-cartografia-ayuda m-help-btn" title="Ayuda"></button>\n    <button id="m-geosearch-clear-btn" class="g-cartografia-cancelar m-clear-btn" title="Limpiar búsqueda"></button>\n  </div>\n  \x3c!-- results panel --\x3e\n  <div class="results-panel" id="m-geosearch-results">\n    <div id="m-searching-result" class="m-searching-result g-cartografia-spinner"></div>\n  </div>\n\n  <div class="m-hidden img-cache-loader" id="img-cache-loader">\n  </div>\n</div>'},222:t=>{t.exports='<div class="m-control m-geosearchbycoordinates-container" id="m-geosearchbycoordinates-div" title="Geobúsquedas por geolocalización">\n   <button id="m-geosearchbycoordinates-button" class="g-cartografia-posicion"></button>\n   <button id="m-geosearchbycoordinates-button-list" class="g-cartografia-lista hidden"></button>\n</div>'},387:t=>{t.exports='<div class="m-geosearch-content">\n   {{#each features}}\n   <div id="{{solrid}}" class="result">\n      {{#each attributes}}\n      <table>\n         <tr>\n            <td class="key">{{key}}</td>\n            <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n         </tr>\n      </table>\n      {{/each}}\n   </div>\n   <div class="m-separator"></div>\n   {{/each}}\n</div>'},407:t=>{t.exports='<div class="m-geosearch-help">\n  {{#eq entities.length 0}}\n    <div class="entity">\n      <p>El servicio no tiene ayuda configurada</p>\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar" title="Cerrar ayuda"></button>\n    </div>\n  {{/eq}}\n  {{#each entities}}\n    <div class="entity">\n      <button id="m-geosearch-closeHelp-btn" class="g-cartografia-cancelar m-clear-btn" title="Cerrar ayuda"></button>\n      <div class="name">{{entity}}</div>\n      <div class="info">{{info}}</div>\n      <ul class="keywords">\n        {{#each keywords}}\n          <li>{{this}}</li>\n        {{/each}}\n      </ul>\n      <div class="example">\n        <code>{{example}}</code>\n      </div>\n    </div>\n  {{/each}}\n</div>'},427:t=>{t.exports='<div class="results-panels">\n    {{#if partial}}\n        <div class="partial">\n            <p>No se han encontrado resultados para la búsqueda.</p>\n            <p>A continuación se muestran otros resultados que quizás le interesen:...</p>\n        </div>\n    {{/if}}\n    <div class="results" id="m-geosearch-results-scroll">\n        {{#each docs}}\n            <div id="{{solrid}}" class="result">\n                {{#each attributes}}\n                    <table>\n                        <tbody>\n                            <tr>\n                                <td class="key">{{key}}</td>\n                                <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n                            </tr>\n                        </tbody>\n                    </table>\n                {{/each}}\n            </div>\n        {{/each}}\n    </div>\n    {{#eq docs.length 0}}\n        <div class="results">\n            <div class="partial">No se han encontrado resultados para la búsqueda "{{query}}".</div>\n        </div>\n    {{/eq}}\n    <div class="page">\n        <span class="found" id="m-geosearch-page-found">{{docs.length}}</span> de <span class="total">{{total}}</span>\n        <div class="g-cartografia-flecha-arriba"></div>\n    </div>\n</div>'},861:t=>{t.exports='<div class="m-geosearchbycoordinates-results-panel">\n    <div class="title">\n        B&uacute;squeda por localizaci&oacute;n\n        <button class="m-panel-btn"></button>\n    </div>\n    <div class="results" id="m-geosearchbycoordinates-results-scroll">\n        {{#each docs}}\n            <div id="{{solrid}}" class="result">\n                {{#each attributes}}\n                    <table>\n                        <tbody>\n                            <tr>\n                                <td class="key">{{key}}</td>\n                                <td class="value">{{{value}}}</td>\n                            </tr>\n                        </tbody>\n                    </table>\n                {{/each}}\n            </div>\n        {{/each}}\n    </div>\n    <div class="page">\n        <span class="total">{{total}} resultados.</span>\n    </div>\n</div>'},842:function(t,e,s){!function(e,i){t.exports?t.exports=i(e,s(158)):e.Unidragger=i(e,e.EvEmitter)}("undefined"!=typeof window?window:this,(function(t,e){function s(){}let i,n,o=s.prototype=Object.create(e.prototype);o.handleEvent=function(t){let e="on"+t.type;this[e]&&this[e](t)},"ontouchstart"in t?(i="touchstart",n=["touchmove","touchend","touchcancel"]):t.PointerEvent?(i="pointerdown",n=["pointermove","pointerup","pointercancel"]):(i="mousedown",n=["mousemove","mouseup"]),o.touchActionValue="none",o.bindHandles=function(){this._bindHandles("addEventListener",this.touchActionValue)},o.unbindHandles=function(){this._bindHandles("removeEventListener","")},o._bindHandles=function(e,s){this.handles.forEach((n=>{n[e](i,this),n[e]("click",this),t.PointerEvent&&(n.style.touchAction=s)}))},o.bindActivePointerEvents=function(){n.forEach((e=>{t.addEventListener(e,this)}))},o.unbindActivePointerEvents=function(){n.forEach((e=>{t.removeEventListener(e,this)}))},o.withPointer=function(t,e){e.pointerId===this.pointerIdentifier&&this[t](e,e)},o.withTouch=function(t,e){let s;for(let t of e.changedTouches)t.identifier===this.pointerIdentifier&&(s=t);s&&this[t](e,s)},o.onmousedown=function(t){this.pointerDown(t,t)},o.ontouchstart=function(t){this.pointerDown(t,t.changedTouches[0])},o.onpointerdown=function(t){this.pointerDown(t,t)};const r=["TEXTAREA","INPUT","SELECT","OPTION"],a=["radio","checkbox","button","submit","image","file"];return o.pointerDown=function(t,e){let s=r.includes(t.target.nodeName),i=a.includes(t.target.type),n=!s||i;!this.isPointerDown&&!t.button&&n&&(this.isPointerDown=!0,this.pointerIdentifier=void 0!==e.pointerId?e.pointerId:e.identifier,this.pointerDownPointer={pageX:e.pageX,pageY:e.pageY},this.bindActivePointerEvents(),this.emitEvent("pointerDown",[t,e]))},o.onmousemove=function(t){this.pointerMove(t,t)},o.onpointermove=function(t){this.withPointer("pointerMove",t)},o.ontouchmove=function(t){this.withTouch("pointerMove",t)},o.pointerMove=function(t,e){let s={x:e.pageX-this.pointerDownPointer.pageX,y:e.pageY-this.pointerDownPointer.pageY};this.emitEvent("pointerMove",[t,e,s]),!this.isDragging&&this.hasDragStarted(s)&&this.dragStart(t,e),this.isDragging&&this.dragMove(t,e,s)},o.hasDragStarted=function(t){return Math.abs(t.x)>3||Math.abs(t.y)>3},o.dragStart=function(t,e){this.isDragging=!0,this.isPreventingClicks=!0,this.emitEvent("dragStart",[t,e])},o.dragMove=function(t,e,s){this.emitEvent("dragMove",[t,e,s])},o.onmouseup=function(t){this.pointerUp(t,t)},o.onpointerup=function(t){this.withPointer("pointerUp",t)},o.ontouchend=function(t){this.withTouch("pointerUp",t)},o.pointerUp=function(t,e){this.pointerDone(),this.emitEvent("pointerUp",[t,e]),this.isDragging?this.dragEnd(t,e):this.staticClick(t,e)},o.dragEnd=function(t,e){this.isDragging=!1,setTimeout((()=>delete this.isPreventingClicks)),this.emitEvent("dragEnd",[t,e])},o.pointerDone=function(){this.isPointerDown=!1,delete this.pointerIdentifier,this.unbindActivePointerEvents(),this.emitEvent("pointerDone")},o.onpointercancel=function(t){this.withPointer("pointerCancel",t)},o.ontouchcancel=function(t){this.withTouch("pointerCancel",t)},o.pointerCancel=function(t,e){this.pointerDone(),this.emitEvent("pointerCancel",[t,e])},o.onclick=function(t){this.isPreventingClicks&&t.preventDefault()},o.staticClick=function(t,e){let s="mouseup"===t.type;s&&this.isIgnoringMouseUp||(this.emitEvent("staticClick",[t,e]),s&&(this.isIgnoringMouseUp=!0,setTimeout((()=>{delete this.isIgnoringMouseUp}),400)))},s}))}},e={};function s(i){var n=e[i];if(void 0!==n)return n.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,s),o.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=s(384),e=s.n(t),i=s(387),n=s.n(i);class o{static init(){if(!1===o.initialized){o.initialized=!0;const t=document.createElement("img");t.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24.svg"]),t.width="24",t.height="24",t.crossOrigin="anonymous";const e=document.createElement("IMG");e.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-new.svg"]),e.width="24",e.height="24",e.crossOrigin="anonymous";const s=document.createElement("IMG");s.src=M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24-sel.svg"]),s.width="24",s.height="24",s.crossOrigin="anonymous",o.DEFAULT[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:t})}),o.DEFAULT[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#A15BD7"}),stroke:new ol.style.Stroke({color:"#A15BD7",width:2})}),o.DEFAULT[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:t})}),o.DEFAULT[M.geom.wkt.type.MULTI_POINT]=o.DEFAULT[M.geom.wkt.type.POINT],o.DEFAULT[M.geom.wkt.type.LINEAR_RING]=o.DEFAULT[M.geom.wkt.type.LINE_STRING],o.DEFAULT[M.geom.wkt.type.MULTI_LINE_STRING]=o.DEFAULT[M.geom.wkt.type.LINE_STRING],o.DEFAULT[M.geom.wkt.type.MULTI_POLYGON]=o.DEFAULT[M.geom.wkt.type.POLYGON],o.DEFAULT[M.geom.wkt.type.CIRCLE]=o.DEFAULT[M.geom.wkt.type.POLYGON],o.DEFAULT[M.geom.wkt.type.GEOMETRY_COLLECTION]=o.DEFAULT[M.geom.wkt.type.POLYGON],o.NEW[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:e})}),o.NEW[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#e2951b"}),stroke:new ol.style.Stroke({color:"#e2951b",width:2})}),o.NEW[M.geom.wkt.type.POLYGON]=new ol.style.Style({image:new ol.style.Icon({img:e})}),o.NEW[M.geom.wkt.type.MULTI_POINT]=o.NEW[M.geom.wkt.type.POINT],o.NEW[M.geom.wkt.type.LINEAR_RING]=o.NEW[M.geom.wkt.type.LINE_STRING],o.NEW[M.geom.wkt.type.MULTI_LINE_STRING]=o.NEW[M.geom.wkt.type.LINE_STRING],o.NEW[M.geom.wkt.type.MULTI_POLYGON]=o.NEW[M.geom.wkt.type.POLYGON],o.NEW[M.geom.wkt.type.CIRCLE]=o.NEW[M.geom.wkt.type.POLYGON],o.NEW[M.geom.wkt.type.GEOMETRY_COLLECTION]=o.NEW[M.geom.wkt.type.POLYGON],o.SELECTED[M.geom.wkt.type.POINT]=new ol.style.Style({image:new ol.style.Icon({img:s})}),o.SELECTED[M.geom.wkt.type.LINE_STRING]=new ol.style.Style({fill:new ol.style.Fill({color:"#fcfcfc"}),stroke:new ol.style.Stroke({color:"#3589d1",width:2})}),o.SELECTED[M.geom.wkt.type.POLYGON]=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(240, 220, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#a15bd7",width:2})}),o.SELECTED[M.geom.wkt.type.MULTI_POINT]=o.SELECTED[M.geom.wkt.type.POINT],o.SELECTED[M.geom.wkt.type.LINEAR_RING]=o.SELECTED[M.geom.wkt.type.LINE_STRING],o.SELECTED[M.geom.wkt.type.MULTI_LINE_STRING]=o.SELECTED[M.geom.wkt.type.LINE_STRING],o.SELECTED[M.geom.wkt.type.MULTI_POLYGON]=o.SELECTED[M.geom.wkt.type.POLYGON],o.SELECTED[M.geom.wkt.type.CIRCLE]=o.SELECTED[M.geom.wkt.type.POLYGON],o.SELECTED[M.geom.wkt.type.GEOMETRY_COLLECTION]=o.SELECTED[M.geom.wkt.type.POLYGON]}}}o.DEFAULT={},o.NEW={},o.SELECTED={},o.initialized=!1;class r{static getCentroidCoordinate(t){let e,s,i,n,o,a;return t.getType()===M.geom.wkt.type.POINT?e=t.getCoordinates():t.getType()===M.geom.wkt.type.LINE_STRING||t.getType()===M.geom.wkt.type.LINEAR_RING?(s=t.getCoordinates(),i=Math.floor(s.length/2),e=s[i]):t.getType()===M.geom.wkt.type.POLYGON?e=r.getCentroidCoordinate(t.getInteriorPoint()):t.getType()===M.geom.wkt.type.MULTI_POINT?(n=t.getPoints(),i=Math.floor(n.length/2),e=r.getCentroidCoordinate(n[i])):t.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(o=t.getLineStrings(),i=Math.floor(o.length/2),e=r.getCentroidCoordinate(o[i])):t.getType()===M.geom.wkt.type.MULTI_POLYGON?(n=t.getInteriorPoints(),e=r.getCentroidCoordinate(n)):t.getType()===M.geom.wkt.type.CIRCLE?e=t.getCenter():t.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(a=t.getGeometries(),i=Math.floor(a.length/2),e=r.getCentroidCoordinate(a[i])),e}}class a extends M.impl.layer.Vector{constructor(t="geosearch",e={}){const s=e;super(s),this.wktFormatter_=new ol.format.WKT,this.popup_=null,this.selectedFeatures_=[],s.displayInLayerSwitcher||(s.displayInLayerSwitcher=!1),this.name=t}addTo(t){super.addTo(t),this.ol3Layer.setSource(new ol.source.Vector({useSpatialIndex:!1}))}drawResults(t){const e=ol.proj.get(this.map.getProjection().code);let s=[];M.utils.isNullOrEmpty(t.spatial_response)||(s=t.spatial_response.docs),M.utils.isNullOrEmpty(s)&&(s=t.response.docs);const i=s.map((t=>{const s=this.wktFormatter_.readFeature(t.geom,{dataProjection:e});return s.setId(t.solrid),s.setProperties(t),a.setStyleFeature(s,M.style.state.DEFAULT),this.wrapComplexFeature_(s),M.impl.Feature.olFeature2Facade(s)}),this);this.facadeVector_.addFeatures(i)}drawNewResults(t){const e=ol.proj.get(this.map.getProjection().code);let s;M.utils.isNullOrEmpty(t.spatial_response)?M.utils.isNullOrEmpty(t.response)||(s=t.response.docs):s=t.spatial_response.docs;const i=s.map((t=>{const s=this.wktFormatter_.readFeature(t.geom,{dataProjection:e});return s.setId(t.solrid),s.setProperties(t),a.setStyleFeature(s,M.style.state.NEW),M.impl.Feature.olFeature2Facade(s)}),this);this.facadeVector_.addFeatures(i)}clear(t){this.map.removePopup(),this.facadeVector_.clear()}selectFeatures(t,e,s,i){let o=t;this.unselectFeatures(),this.selectedFeatures_=o,o=o.map(M.impl.Feature.facade2OLFeature),a.setStyleFeature(o,M.style.state.SELECTED);const r={jsonp:!0,vars:this.parseFeaturesForTemplate_(o),parseToHtml:!1},l={icon:"g-cartografia-pin",title:"Geosearch",content:M.template.compileSync(n(),r)};let h=this.map.getPopup();M.utils.isNullOrEmpty(h)?(h=new M.Popup({panMapIfOutOfView:!i,ani:null}),h.addTab(l),this.map.addPopup(h,e)):h.addTab(l),h.on(M.evt.DESTROY,(()=>{this.internalUnselectFeatures_(!0)}),this)}selectFeatureBySolrid(t){const e=this.facadeVector_.getFeatureById(t);this.selectedFeatures_=[e];const s=e.getImpl().getOLFeature().getGeometry(),i=r.getCentroidCoordinate(s);this.unselectFeatures(),this.selectFeatures([e],i,null,!0),this.map.setBbox(s.getExtent())}parseFeaturesForTemplate_(t){const e={features:[]};return t.forEach((t=>{const s=["geom","_version_","keywords","solrid",t.getGeometryName()],i=t.getProperties(),n=[];Object.keys(i).forEach((t=>{M.utils.includes(s,t.toLowerCase())||n.push({key:M.utils.beautifyAttributeName(t),value:i[t]})}));const o={solrid:t.getId(),attributes:n};e.features.push(o)})),e}wrapComplexFeature_(t){const e=t.getGeometry();if(e.getType()===M.geom.wkt.type.POLYGON||e.getType()===M.geom.wkt.type.MULTI_POLYGON){let s;s=e.getType()===M.geom.wkt.type.POLYGON?e.getInteriorPoint():e.getInteriorPoints();const i=new ol.geom.GeometryCollection([s,e]);t.setGeometry(i)}}unselectFeatures(t,e){this.internalUnselectFeatures_()}internalUnselectFeatures_(t){this.selectedFeatures_.length>0&&(a.setStyleFeature(this.selectedFeatures_.map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT),this.selectedFeatures_.length=0,t||this.map.removePopup())}setNewResultsAsDefault(){a.setStyleFeature(this.facadeVector_.getFeatures().map(M.impl.Feature.facade2OLFeature),M.style.state.DEFAULT)}getCentroidCoordinate(t){let e,s,i,n,o,r;return t.getType()===M.geom.wkt.type.POINT?e=t.getCoordinates():t.getType()===M.geom.wkt.type.LINE_STRING||t.getType()===M.geom.wkt.type.LINEAR_RING?(s=t.getCoordinates(),i=Math.floor(s.length/2),e=s[i]):t.getType()===M.geom.wkt.type.POLYGON?e=this.getCentroidCoordinate(t.getInteriorPoint()):t.getType()===M.geom.wkt.type.MULTI_POINT?(n=t.getPoints(),i=Math.floor(n.length/2),e=this.getCentroidCoordinate(n[i])):t.getType()===M.geom.wkt.type.MULTI_LINE_STRING?(o=t.getLineStrings(),i=Math.floor(o.length/2),e=this.getCentroidCoordinate(o[i])):t.getType()===M.geom.wkt.type.MULTI_POLYGON?(n=t.getInteriorPoints(),e=this.getCentroidCoordinate(n)):t.getType()===M.geom.wkt.type.CIRCLE?e=t.getCenter():t.getType()===M.geom.wkt.type.GEOMETRY_COLLECTION&&(r=t.getGeometries(),i=Math.floor(r.length/2),e=this.getCentroidCoordinate(r[i])),e}destroy(){const t=this.map.getMapImpl();M.utils.isNullOrEmpty(this.ol3Layer)||(t.removeLayer(this.ol3Layer),this.ol3Layer=null),this.map=null,this.wktFormatter_=null,this.popup_=null,this.selectedFeatures_=null,this.name=null}equals(t){let e=!1;return t instanceof a&&(e=this.url===t.url,e=e&&this.name===t.name),e}static setStyleFeature(t,e){let s=t;o.init(),M.utils.isArray(s)||(s=[s]),s.forEach((t=>{const s=t.getGeometry().getType();M.utils.isNullOrEmpty(e)||e===M.style.state.DEFAULT?t.setStyle(o.DEFAULT[s]):e===M.style.state.NEW?t.setStyle(o.NEW[s]):e===M.style.state.SELECTED&&t.setStyle(o.SELECTED[s])}))}}a.POPUP_RESULT="geosearchfeaturepopup.html";class l extends M.layer.Vector{constructor(t={},e={},s=new a){super(t,e,{},s),M.utils.isUndefined(a)&&M.exception("La implementación usada no puede crear capas Geosearch"),this.displayInLayerSwitcher=!1}equals(t){return!1}}class h extends M.impl.Control{constructor(t={}){super(),this.facadeMap_=null,this.helpHtml_=null,this.layer_=new l({name:t.layerName||"__geosearch_plugin_layer_name__"})}addTo(t,e){this.facadeMap_=t,t.addLayers(this.layer_),this.element=e,super.addTo(t,e)}unselectResults(t){this.layer_.getImpl().unselectFeatures(t)}setNewResultsAsDefault(){this.layer_.getImpl().setNewResultsAsDefault()}drawResults(t){this.layer_.getImpl().drawResults(t)}drawNewResults(t){this.layer_.getImpl().drawNewResults(t)}zoomToResults(){const t=ol.extent.boundingExtent(this.layer_.getImpl().getOL3Layer().getSource().getFeatures().map((t=>ol.extent.getCenter(t.getGeometry().getExtent()))));this.facadeMap_.setBbox(t)}getLayer(){return this.layer_}resultClick(t){this.layer_.getImpl().selectFeatureBySolrid(t)}hideHelp(){M.utils.isNullOrEmpty(this.helpHtml_)||(this.facadeMap_.getMapImpl().getTargetElement().removeChild(this.helpHtml_),this.helpHtml_=null)}showHelp(t){const e=this.facadeMap_.getMapImpl().getTargetElement();M.utils.isNullOrEmpty(this.helpHtml_)||e.removeChild(this.helpHtml_),this.helpHtml_=t,e.appendChild(this.helpHtml_)}clear(){this.layer_.clear()}destroy(){this.clear(),this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.remove("top-extra"),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.helpHtml_=null,this.layer_=null}}class c extends h{constructor(t){super({layerName:c.NAME}),this.popup_=null,this.searchUrl_=t,this.positionFeature_=new M.Feature,this.positionFeature_.setStyle(new M.style.Point({fill:{color:"#3399CC"},radius:6,stroke:{color:"#fff",width:3}}))}setMap(t){super.setMap(t),M.utils.isNullOrEmpty(t)?this.facadeMap_.getImpl().removeFeatures([this.positionFeature_]):this.map=t}drawLocation(t){this.positionFeature_.getImpl().getOLFeature().setGeometry(t?new ol.geom.Point(t):null),this.facadeMap_.drawFeatures([this.positionFeature_])}addResultsContainer(t){this.map.getTargetElement().appendChild(t)}removeResultsContainer(t){null!==t&&null!=t.parentElement&&t.parentElement.removeChild(t)}zoomToResultsAll(){const t=this.facadeMap_.getControls("geosearchbycoordinates")[0].getImpl().getLayer().getFeaturesExtent();this.facadeMap_.setBbox(t)}destroy(){this.facadeMap_.getMapImpl().removeControl(this),this.clear(),this.facadeMap_.removeFeatures([this.positionFeature_]),this.popup_=null,this.searchUrl_=null}deactivate(){this.facadeMap_.removeFeatures(this.positionFeature_)}}var u=s(222),d=s.n(u),p=s(861),m=s.n(p),g=s(515),_=s.n(g),y=s(427),E=s.n(y),f=s(407),w=s.n(f);class v extends M.Control{constructor(t,e,s,i,n){super(new h,v.NAME),M.utils.isUndefined(h)&&M.exception("La implementación usada no puede crear controles Geosearch"),this.input_=null,this.element_=null,this.resultsContainer_=null,this.resultsScrollContainer_=null,this.searchingResult_=null,this.searchTime_=0,this.url_=t,this.core_=e,this.handler_=s,this.searchUrl_=M.utils.concatUrlPaths([this.url_,this.core_,this.handler_]),this.helpUrl_=M.utils.concatUrlPaths([this.url_,this.core_,"/help"]),this.searchParameters_=i,M.utils.isNullOrEmpty(this.searchParameters_)||(M.utils.isNullOrEmpty(this.searchParameters_.rows)&&(this.searchParameters_.rows=M.config.GEOSEARCH_ROWS),this.searchUrl_=M.utils.addParameters(this.searchUrl_,this.searchParameters_)),this.results_=[],this.showHelp_=n,this.scrollIsUp_=!0,this.spatialSearch_=!1,this.facadeMap_=null}createView(t){this.facadeMap_=t;const e=M.template.compileSync(_(),{jsonp:!0});return!1===this.showHelp_&&e.querySelector("#m-geosearch-help-btn").classList.add("m-hidden"),this.addEvents(e),e}addEvents(t){this.element_=t,this.on(M.evt.COMPLETED,(()=>{this.element_.classList.add("shown")}),this),this.input_=this.element_.getElementsByTagName("input")["m-geosearch-search-input"],this.input_.addEventListener("keyup",this.searchClick.bind(this)),this.element_.getElementsByTagName("button")["m-geosearch-search-btn"].addEventListener("click",this.searchClick.bind(this));const e=this.element_.getElementsByTagName("button")["m-geosearch-help-btn"];e&&e.addEventListener("click",(t=>{t.preventDefault(),e.classList.toggle("shown"),this.helpClick_()})),this.element_.getElementsByTagName("button")["m-geosearch-clear-btn"].addEventListener("click",this.clearClick_.bind(this)),this.resultsContainer_=this.element_.querySelector("div#m-geosearch-results"),M.utils.enableTouchScroll(this.resultsContainer_),this.searchingResult_=this.element_.querySelector("div#m-geosearch-results > div#m-searching-result")}addEventsHelp(t){this.element_=t,this.element_.getElementsByTagName("button")["m-geosearch-closeHelp-btn"].addEventListener("click",this.closeHelpClick_.bind(this))}searchClick(t){if(t.preventDefault(),"keyup"!==t.type||13===t.keyCode){this.results_.length=0;const t=this.input_.value;M.utils.isNullOrEmpty(t)?M.dialog.info("Debe introducir una búsqueda."):this.search_(t,this.showResults_)}}resultClick_(t){const e=t;e.preventDefault(),M.window.WIDTH<=M.config.MOBILE_WIDTH&&(e.target=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba"),this.resultsClick_(e)),this.facadeMap_.removePopup();const s=e.currentTarget.id;this.getImpl().resultClick(s)}search_(t,e){this.resultsContainer_.appendChild(this.searchingResult_),this.searchTime_=Date.now(),this.element_.classList.add(v.SEARCHING_CLASS);const s=M.utils.addParameters(this.searchUrl_,{q:t,start:this.results_.length,srs:this.facadeMap_.getProjection().code});(t=>{M.remote.get(s).then((s=>{if(t===this.searchTime_){let t;try{t=JSON.parse(s.text)}catch(t){M.exception(`La respuesta no es un JSON válido: ${t}`)}e.call(this,t),this.element_.classList.remove(v.SEARCHING_CLASS)}}))})(this.searchTime_)}showResults_(t){this.getImpl().clear(),this.drawResults(t);const e={jsonp:!0,vars:this.parseResultsForTemplate_(t)},s=M.template.compileSync(E(),e);this.resultsContainer_.classList.remove(v.HIDDEN_RESULTS_CLASS),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_);let i,n=this.resultsContainer_.querySelectorAll(".result");for(let t=0,e=n.length;t<e;t+=1)i=n.item(t),i.removeEventListener("click",this.resultClick_.bind(this));t.response.docs.length>0&&this.zoomToResults();let o=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba");M.utils.isNullOrEmpty(o)||o.removeEventListener("click",this.resultsClick_.bind(this)),this.resultsContainer_.innerHTML=s.innerHTML,this.resultsScrollContainer_=this.resultsContainer_.querySelector("div#m-geosearch-results-scroll"),M.utils.enableTouchScroll(this.resultsScrollContainer_),this.resultsScrollContainer_.addEventListener("scroll",this.resultsScroll_.bind(this)),n=this.resultsContainer_.getElementsByClassName("result");for(let t=0,e=n.length;t<e;t+=1)i=n.item(t),i.addEventListener("click",this.resultClick_.bind(this));o=this.resultsContainer_.querySelector("div.page > div.g-cartografia-flecha-arriba"),o.addEventListener("click",this.resultsClick_.bind(this)),this.checkScrollSearch_(t),this.fire(M.evt.COMPLETED)}drawResults(t){this.getImpl().drawResults(t)}drawNewResults(t){this.getImpl().drawNewResults(t)}zoomToResults(){this.getImpl().zoomToResults()}getInput(){return this.input_}appendResults_(t){this.drawNewResults(t);const e={jsonp:!0,vars:this.parseResultsForTemplate_(t,!0)},s=M.template.compileSync(E(),e).getElementsByTagName("div")["m-geosearch-results-scroll"].children;for(let t=0;t<s.length;t+=1){const e=s.item(t);this.resultsScrollContainer_.appendChild(e),e.addEventListener("click",(t=>this.resultClick_(t)))}this.resultsContainer_.getElementsByTagName("span")["m-geosearch-page-found"].innerHTML=this.results_.length,this.checkScrollSearch_(t)}resultsScroll_(t){const e=t.target,s=e.offsetHeight,i=e.scrollHeight-e.scrollTop-s<=15;i&&this.scrollIsUp_?(this.scrollIsUp_=!1,this.scrollSearch_()):i||(this.scrollIsUp_=!0)}scrollSearch_(){this.getImpl().unselectResults(!0),this.getImpl().setNewResultsAsDefault();const t=this.input_.value;this.search_(t,this.appendResults_)}helpClick_(t){!0===this.helpShown_?(this.getImpl().hideHelp(),this.helpShown_=!1):M.remote.get(this.helpUrl_).then((t=>{let e;try{e=JSON.parse(t.text)}catch(t){M.Exception(`La respuesta no es un JSON válido: ${t}`)}const s={jsonp:!0,vars:{entities:e}},i=M.template.compileSync(w(),s);this.addEventsHelp(i),this.getImpl().showHelp(i),this.helpShown_=!0}))}closeHelpClick_(t){!0===this.helpShown_&&(this.getImpl().hideHelp(),this.helpShown_=!1)}clearClick_(t){this.element_.classList.remove("shown"),M.utils.isNullOrEmpty(this.input_)||(this.input_.value=""),M.utils.isNullOrEmpty(this.resultsContainer_)||(this.resultsContainer_.innerHTML=""),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||(this.resultsScrollContainer_.innerHTML="",this.resultsScrollContainer_=null),this.results_.length=0,this.resultsContainer_.classList.remove(v.HIDDEN_RESULTS_CLASS),this.getImpl().clear(),this.getImpl().hideHelp(),this.spatialSearch_=!1}resultsClick_(t){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra-search"),t.target.classList.toggle("g-cartografia-flecha-arriba"),t.target.classList.toggle("g-cartografia-flecha-abajo"),this.resultsContainer_.classList.toggle(v.HIDDEN_RESULTS_CLASS)}equals(t){let e=!1;return t instanceof v&&(e=this.name===t.name),e}parseResultsForTemplate_(t,e){let s="";M.utils.isNullOrEmpty(this.input_)||(s=this.input_.value);let i=0;M.utils.isUndefined(t.spatial_response)?(i=t.response.numFound,this.spatialSearch_=!1):(i=t.spatial_response.numFound,this.spatialSearch_=!0);const n=this.getDocsFromResults_(t);this.results_=!0===e?this.results_.concat(n):n;const o=this.spatialSearch_&&M.utils.isNullOrEmpty(t.spatial_response.docs);let r=null;return r=0!==i?{docs:n,total:i,partial:o}:{docs:n,total:i,notResutls:!0,query:s},r}getDocsFromResults_(t){let e=[];e=this.spatialSearch_?t.spatial_response.docs:t.response.docs;const s=["geom","_version_","keywords","solrid"];return e=e.map((t=>{const e=[];return Object.keys(t).forEach((i=>{M.utils.includes(s,i)||e.push({key:M.utils.beautifyAttributeName(i),value:t[i]})})),{solrid:t.solrid,attributes:e}})),e}checkScrollSearch_(t){let e=0;e=M.utils.isUndefined(t.spatial_response)?t.response.numFound:t.spatial_response.numFound,this.results_.length!==e||M.utils.isNullOrEmpty(this.resultsScrollContainer_)||this.resultsScrollContainer_.removeEventListener("scroll",this.resultsScroll_)}}v.NAME="geosearch",v.TEMPLATE="geosearch.html",v.RESULTS_TEMPLATE="geosearchresults.html",v.HELP_TEMPLATE="geosearchhelp.html",v.SEARCHING_CLASS="m-searching",v.HIDDEN_RESULTS_CLASS="hidden";class L extends v{constructor(t,e,s,i,n,o){super(t,e,s),this.impl_=new c(this.searchUrl_),this.activate_=!1,this.activatebtnList_=!0,this.distance_=i,this.spatialField_=n,this.rows_=o,this.searchUrl_=M.utils.concatUrlPaths([t,e,s]),this.facadeMap_=null,this.resultsScrollContainer_=null,M.utils.isUndefined(c)&&M.Exception("La implementación usada no puede crear controles GeosearchByCoordinates"),this.name=L.NAME}equals(t){let e=!1;return t instanceof L&&(e=this.name===t.name),e}createView(t){this.facadeMap_=t,this.facadeMap_.on(M.evt.CLICK,(t=>{if(!0===this.activate_){const e=new ol.geom.Point(t.coord),s=(new ol.format.WKT).writeGeometry(e);this.searchFrom(s,t.coord),this.element_.classList.add(v.SEARCHING_CLASS),this.element_.classList.remove("ready"),this.activated=!1,this.activate_=!1}}));const e=M.template.compileSync(d(),{jsonp:!0});return e.querySelector("button#m-geosearchbycoordinates-button-list").onclick=this.showList_.bind(this),this.createImagesCache(e),e}createImagesCache(t){const e=t.getElementsByClassName("img-cache-loader")[0];["/img/m-pin-24.svg","/img/m-pin-24-new.svg","/img/m-pin-24-sel.svg"].forEach((t=>{let s=new Image;s.src=M.utils.concatUrlPaths([M.config.THEME_URL,t]),s.width="24",s.height="24",s.crossOrigin="anonymous",e.append(s)}))}getActivationButton(t){return t.querySelector("button#m-geosearchbycoordinates-button")}activate(){this.activate_=!0,this.element_.classList.add("ready")}deactivate(){this.thereIsSearch=!1,this.activate_=!1,this.element_.classList.remove("activated"),this.element_.classList.remove("ready"),this.getImpl().clear(),this.getImpl().removeResultsContainer(this.resultsContainer_),this.getImpl().deactivate()}drawLocation_(t){this.getImpl().drawLocation(t)}searchFrom(t,e){let s=null;s=M.utils.addParameters(this.searchUrl_,{wt:"json",pt:t,q:"*:*",start:0,d:this.distance_,spatialField:this.spatialField_,rows:this.rows_,srs:this.map_.getProjection().code}),this.searchTime_=Date.now(),(t=>{M.remote.get(s).then((s=>{if(t===this.searchTime_){let t;try{t=JSON.parse(s.text)}catch(t){M.Exception(`La respuesta no es un JSON válido:${t}`)}this.getImpl().removeResultsContainer(this.resultsContainer_),this.showResults_(t),this.drawLocation_(e),this.zoomToResultsAll_(),this.activationBtn_.classList.remove(v.HIDDEN_RESULTS_CLASS),this.element_.classList.remove(v.SEARCHING_CLASS)}}))})(this.searchTime_)}zoomToResultsAll_(){this.getImpl().zoomToResultsAll()}showResults_(t){this.getImpl().clear(),this.results=t,this.showList=!0,this.thereIsSearch=!0,this.drawResults(t)}showList_(){if(this.thereIsSearch)if(!0===this.showList){const t={jsonp:!0,vars:this.parseResultsForTemplate_(this.results)},s=M.template.compileSync(m(),t);this.draggable_=new(e())(s,{containment:".m-mapea-container",handle:".m-geosearchbycoordinates-results-panel .title"}),this.draggable_.enable(),s.style.position="absolute",this.resultsContainer_=s,this.resultsScrollContainer_=this.resultsContainer_.querySelector("div#m-geosearchbycoordinates-results-scroll"),M.utils.enableTouchScroll(this.resultsScrollContainer_),this.getImpl().addResultsContainer(this.resultsContainer_);const i=this.resultsContainer_.getElementsByClassName("result");for(let t=0,e=i.length;t<e;t+=1)i.item(t).addEventListener("click",(t=>{this.resultClick_(t),this.getImpl().removeResultsContainer(this.resultsContainer_),this.showList=!0}));s.querySelector(".title > button.m-panel-btn").addEventListener("click",this.showList_.bind(this)),this.showList=!1}else this.getImpl().removeResultsContainer(this.resultsContainer_),this.showList=!0;else M.dialog.info("No se ha realizado ninguna búsqueda.","Sin información")}resultsClick_(t){this.resultsContainer_.classList.toggle(v.HIDDEN_RESULTS_CLASS)}}L.NAME="geosearchbycoordinates",L.HIDDEN="hidden",L.TEMPLATE="geosearchbycoordinates.html",L.RESULTS_TEMPLATE="GeosearchByCoordinatesresults.html";const C=JSON.parse('{"Pu":{"uuid_plugin":"","uuid_version_plugin":"","version_ficha_metadatos":"","name":"GeosearchByCoordinates","description":"Search for locations within a given radius from a click on a point on the map.","text":"","version":"1.0.4","date":"11/10/2019","author":"Junta de Andalucía","org":"Junta de Andalucía","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","buttons":[{"title":"","description":"","querySelector":""},{"title":"","description":"","querySelector":""}],"dependencies":{"modules":["",""],"plugins":[{"uuid":"","name":""}],"services":[{"name":"","description":""}]},"compatibility":["4","5","6"]}}');class T extends M.Plugin{constructor(t={}){super(),this.name=T.NAME,this.url_=M.config.GEOSEARCH_URL,M.utils.isNullOrEmpty(t.url)||(this.url_=t.url),this.core_=M.config.GEOSEARCH_CORE,M.utils.isNullOrEmpty(t.core)||(this.core_=t.core),this.handler_=M.config.GEOSEARCH_HANDLER,M.utils.isNullOrEmpty(t.handler)||(this.handler_=t.handler),this.distance_=M.config.GEOSEARCH_DISTANCE,M.utils.isNullOrEmpty(t.distance)||(this.distance_=t.distance),this.spatialField_=M.config.GEOSEARCH_SPATIAL_FIELD,this.rows_=M.config.GEOSEARCHBYLOCATION_ROWS,this.map_=null,this.controlGeo_=null,this.panel_=null,this.metadata_=C.Pu}addTo(t){this.map_=t,this.controlGeo_=new L(this.url_,this.core_,this.handler_,this.distance_,this.spatialField_,this.rows_),this.controlGeo_.on(M.evt.ADDED_TO_MAP,(()=>{this.fire(M.evt.ADDED_TO_MAP)})),this.panel_=new M.ui.Panel(T.NAME,{collapsible:!1,className:"m-geosearchbylocation",position:M.ui.position.BR});const e=t.getPanels([M.control.Location.NAME])[0];let s;M.utils.isNullOrEmpty(e)||M.utils.isNullOrEmpty(s)?M.utils.isNullOrEmpty(e)?M.utils.isNullOrEmpty(s)||(s.addClassName("m-with-geosearchbylocation"),this.panel_.addClassName("m-with-streetview")):(e.addClassName("m-with-geosearchbylocation"),this.panel_.addClassName("m-with-location")):(e.addClassName("m-with-geosearchbylocation"),s.addClassName("m-with-geosearchbylocation"),this.panel_.addClassName("m-with-location m-with-streetview")),this.panel_.addControls(this.controlGeo_),this.map_.addPanels(this.panel_)}destroy(){this.map_.removeControls([this.controlGeo_]),this.controlGeo_=null,this.name=null,this.url_=null,this.core_=null,this.handler_=null,this.distance_=null,this.spatialField_=null,this.rows_=null,this.map_=null,this.controlGeo_=null,this.panel_=null}getControls(){const t=[];return t.push(this.controlGeo_),t}equals(t){return t instanceof T}getMetadata(){return this.metadata_}}T.NAME="geosearchbylocation",null==window.M.plugin&&(window.M.plugin={}),window.M.plugin.GeosearchByCoordinates=T})()})();