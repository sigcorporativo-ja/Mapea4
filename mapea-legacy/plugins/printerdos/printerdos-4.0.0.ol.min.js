!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=81)}({39:function(t,e){t.exports='<div class="m-control m-printer-container">\n    \x3c!-- TITLE --\x3e\n    <div class="title">Impresión del mapa</div>\n    \x3c!-- FORM --\x3e\n    <div class="form">\n        \x3c!-- title --\x3e\n        <div class="title">\n            <input type="text" placeholder="Título">\n        </div>\n        \x3c!-- description --\x3e\n        <div class="description">\n            <textarea placeholder="Descripción"></textarea>\n        </div>\n        \x3c!-- layout --\x3e\n        <div class="layout">\n            <label>Plantilla </label>\n            <select>\n                {{#each layouts}}\n                    <option value="{{name}}" {{#if default}} selected{{/if}}>{{name}}</option>\n                {{/each}}\n            </select>\n        </div>\n        \x3c!-- DPI --\x3e\n        <div class="dpi">\n            <label>DPI </label>\n            <select>\n                {{#each dpis}}\n                    <option value="{{value}}" {{#if default}} selected{{/if}}>{{value}}</option>\n                {{/each}}\n            </select>\n        </div>\n        \x3c!-- format --\x3e\n        <div class="format">\n            <label>Formato </label>\n            <select>\n                {{#each format}}\n                    <option value="{{name}}" {{#if default}} selected{{/if}}>{{name}}</option>\n                {{/each}}\n            </select>\n        </div>\n        \x3c!-- force scale --\x3e\n        <div class="forcescale">\n            <label>Forzar escala </label>\n            <input type="checkbox" {{#if forceScale}} checked{{/if}}>\n        </div>\n    </div>\n    \x3c!-- buttons --\x3e\n    <div class="button">\n        <button class="print"><i class="g-cartografia-impresora"></i> Imprimir</button>\n        <button class="remove"><i class="g-cartografia-papelera"></i> Borrar</button>\n        <button class="cancel"><i class="g-cartografia-cancelar"></i> Cancelar impresión</button>\n    </div>\n    \x3c!-- queue --\x3e\n    <div class="queue">\n        <div class="title">Descargar</div>\n        <ul class="queue-container"></ul>\n    </div>\n    \x3c!-- minimize button --\x3e\n    <div class="minimize" title="Minimizar el control de impresión"></div>\n</div>'},40:function(t){t.exports=JSON.parse('{"url":{"name":"printerdos","separator":"*"},"constructor":"M.plugin.Printer","parameters":[{"type":"object","properties":[{"type":"simple","name":"url","position":0},{"type":"object","name":"params","properties":[{"type":"object","name":"layout","properties":[{"type":"simple","name":"outputFilename","value":"mapea_${yyyy-MM-dd_hhmmss}"}]},{"type":"object","name":"pages","properties":[{"type":"simple","name":"clientLogo","value":"http://www.juntadeandalucia.es/economiayhacienda/images/plantilla/logo_cabecera.gif"},{"type":"simple","name":"creditos","value":"Impresión generada a través de Mapea"}]}]}]},{"type":"object","properties":[{"type":"object","name":"options","properties":[{"type":"simple","name":"legend","value":"true"}]}]}],"files":{"ol":{"scripts":["printerdos-4.0.0.ol.min.js"],"styles":["printerdos-4.0.0.min.css"]}},"metadata":{"name":"Printer","description":"Tool for printing maps.","text":"","version":"4.0.0","date":"11/10/2019","author":"Junta de Andalucía","org":"Junta de Andalucía","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg"}}')},66:function(t,e,i){},81:function(t,e,i){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=s(t);if(e){var r=s(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return a(this,i)}}function a(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}i.r(e);var u=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(s,M.impl.Control);var e,i,n,a=o(s);function s(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this)).facadeMap_=null,t}return e=s,(i=[{key:"addTo",value:function(t,e){this.facadeMap_=t,ol.control.Control.call(this,{element:e,target:null}),t.getMapImpl().addControl(this)}},{key:"encodeLayer",value:function(t){var e=this;return new Promise((function(i,n){t.type===M.layer.type.WMC||(t.type===M.layer.type.KML?i(e.encodeKML(t)):t.type===M.layer.type.WMS?i(e.encodeWMS(t)):t.type===M.layer.type.WFS||t.type===M.layer.type.GeoJSON?i(e.encodeWFS(t)):t.type===M.layer.type.WMTS?e.encodeWMTS(t).then((function(t){i(t)})):t.type===M.layer.type.MBtiles||(t.type===M.layer.type.OSM?i(e.encodeOSM(t)):t.type===M.layer.type.Mapbox?i(e.encodeMapbox(t)):(M.utils.isNullOrEmpty(t.type)&&M.layer.Vector,i(e.encodeWFS(t)))))}))}},{key:"encodeLegend",value:function(t){var e=null;if(t.displayInLayerSwitcher){e={classes:[]};var i=new RegExp(".*".concat(M.Layer.LEGEND_DEFAULT,"$")),n=new RegExp(".*".concat(M.Layer.LEGEND_ERROR,"$")),r=t.getLegendURL();M.utils.isNullOrEmpty(r)||i.test(r)||n.test(r)||(e.classes[0]={name:t.name,icons:[t.getLegendURL()]},t instanceof M.layer.Vector&&delete e.classes[0].icons)}return e}},{key:"encodeKML",value:function(t){var e=t.getImpl().getOL3Layer(),i=e.getSource().getFeatures(),n=t.name,r=e.getOpacity(),l=new ol.format.GeoJSON,o=this.facadeMap_.getBbox();o=[o.x.min,o.y.min,o.x.max,o.y.max];var a,s,u=this.facadeMap_.getMapImpl().getView().getResolution(),c=[],p=1,y=1,f="",m={},g={},d=1;return i.forEach((function(t){var e=t.getGeometry(),i=t.get("styleUrl");M.utils.isNullOrEmpty(i)||(i=i.replace("#",""));var n=t.getStyle();if(!M.utils.isNullOrEmpty(n)){var r;try{r=n(t,u),Array.isArray(r)&&(r=r[0])}catch(e){r=n.call(t,u)[0]}if(!M.utils.isNullOrEmpty(r)){var h,v=r.getImage(),O=v.getImageSize();M.utils.isNullOrEmpty(O)&&(O=[64,64]),h="multipolygon"===t.getGeometry().getType().toLowerCase()?"polygon":"multipoint"===t.getGeometry().getType().toLowerCase()?"point":t.getGeometry().getType().toLowerCase();var b,_=r.getStroke(),E={type:h,id:i,externalGraphic:v.getSrc(),graphicHeight:O[0],graphicWidth:O[1],graphicOpacity:v.getOpacity(),strokeWidth:_?_.getWidth():1},S=r.getText&&r.getText();if(M.utils.isNullOrEmpty(S)||((b={type:"text",label:M.utils.isNullOrEmpty(S.getText())?t.get("name"):S.getText(),fontColor:M.utils.isNullOrEmpty(S.getFill())?"":M.utils.rgbToHex(M.utils.isArray(S.getFill().getColor())?"rgba(".concat(S.getFill().getColor().toString(),")"):S.getFill().getColor()),fontSize:"11px",fontFamily:"Helvetica, sans-serif",fontWeight:"bold",conflictResolution:"false",labelAlign:S.getTextAlign(),labelXOffset:S.getOffsetX(),labelYOffset:S.getOffsetY(),labelOutlineColor:M.utils.isNullOrEmpty(S.getStroke())?"":M.utils.rgbToHex(M.utils.isArray(S.getStroke().getColor())?"rgba(".concat(S.getStroke().getColor().toString(),")"):S.getStroke().getColor()),labelOutlineWidth:M.utils.isNullOrEmpty(S.getStroke())?"":S.getStroke().getWidth()}).fontColor=b.fontColor.slice(0,7),b.labelOutlineColor=b.labelOutlineColor.slice(0,7)),a="draw".concat(d),!M.utils.isNullOrEmpty(e)&&e.intersectsExtent(o)||!M.utils.isNullOrEmpty(S)){var x=JSON.stringify(E),N=JSON.stringify(b),L=m[x],T=g[N];if(M.utils.isUndefined(L)||M.utils.isUndefined(T)){var C=[],P=0;if(!M.utils.isNullOrEmpty(e)&&e.intersectsExtent(o)&&M.utils.isUndefined(L)&&(L=y,m[x]=L,P=1,C.push(x),y+=1,d+=1),!M.utils.isNullOrEmpty(S)&&M.utils.isUndefined(T)&&(T=p,g[N]=T,C.push(N),p+=1,0===P&&(d+=1,C.push(x))),void 0===L&&(L=0),void 0===T&&(T=0),s="\"[_gx_style ='".concat(L+T,"']\""),!M.utils.isNullOrEmpty(C)){var k=" ".concat(s,':{"symbolizers": [').concat(C,"]}");f+=""!==f?",".concat(k):"{".concat(k,',"version":"2"')}}var w=l.writeFeatureObject(t);w.properties={_gx_style:L+T,name:a},c.push(w)}}}}),this),{type:"Vector",style:f=""!==f?JSON.parse(f.concat("}")):{"*":{symbolizers:[]},version:"2"},styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:c},name:n,opacity:r}}},{key:"encodeWMS",value:function(t){var e=null,i=t.getImpl().getOL3Layer(),n=t.url,r=i.getOpacity(),l=i.getSource().getParams(),o=[l.LAYERS],a=l.FORMAT,s=[l.STYLES];if(e={baseURL:n,opacity:r,type:"WMS",layers:o.join(",").split(","),format:a||"image/jpeg",styles:s.join(",").split(",")},t._updateNoCache){t._updateNoCache();var u=t.getNoCacheName(),c=t.getNoCacheUrl();M.utils.isNullOrEmpty(u)||M.utils.isNullOrEmpty(c)||(e.layers=[u],e.baseURL=c)}else{var p=t.getNoChacheName(),y=t.getNoChacheUrl();M.utils.isNullOrEmpty(p)||M.utils.isNullOrEmpty(y)||(e.layers=[p],e.baseURL=y)}return e.customParams={},Object.keys(l).forEach((function(t){-1!=="iswmc,transparent".indexOf(t.toLowerCase())&&(e.customParams[t]=l[t])})),e}},{key:"encodeWFS",value:function(t){var e=this,i=null,n=!0;if((t.getStyle()instanceof M.style.Chart||t.getStyle()instanceof M.style.Cluster&&t.getStyle().getOldStyle()instanceof M.style.Chart)&&(n=!1),n){var r=this.facadeMap_.getProjection(),l=t.getImpl().getOL3Layer(),o=null;o=t.type===M.layer.type.MVT?t.getFeatures():l.getSource().getFeatures();var a=t.name,s=l.getOpacity(),u=l.getStyle(),c=new ol.format.GeoJSON,p=this.facadeMap_.getBbox();p=[p.x.min,p.y.min,p.x.max,p.y.max];var y,f,m=this.facadeMap_.getMapImpl().getView().getResolution(),g=[],d=1,h=1,v=1,O="",b={},_={};o.forEach((function(t){var i,n=t.getGeometry(),l=t.getStyle();if(M.utils.isNullOrEmpty(l)?M.utils.isNullOrEmpty(u)||(i=u):i=l,i instanceof Function&&(i=i.call(i,t,m)),i instanceof Array&&(i=i.length>1&&!M.utils.isNullOrEmpty(i[1].getImage())&&i[1].getImage().getSrc?i[1]:i[0]),!M.utils.isNullOrEmpty(i)){var o,a=i.getImage(),s=M.utils.isNullOrEmpty(a)?[0,0]:a.getImageSize()||[24,24],E=i.getText();M.utils.isNullOrEmpty(E)&&!M.utils.isNullOrEmpty(i.textPath)&&(E=i.textPath),o="multipolygon"===t.getGeometry().getType().toLowerCase()?"polygon":"multipoint"===t.getGeometry().getType().toLowerCase()?"point":"multilinestring"===t.getGeometry().getType().toLowerCase()?"line":t.getGeometry().getType().toLowerCase();var S,x=M.utils.isNullOrEmpty(a)?i.getStroke():a.getStroke&&a.getStroke(),N=M.utils.isNullOrEmpty(a)?i.getFill():a.getFill&&a.getFill(),L={type:o,fillColor:M.utils.isNullOrEmpty(N)?"#000000":M.utils.rgbaToHex(N.getColor()).slice(0,7),fillOpacity:M.utils.isNullOrEmpty(N)?0:M.utils.getOpacityFromRgba(N.getColor()),strokeColor:M.utils.isNullOrEmpty(x)?"#000000":M.utils.rgbaToHex(x.getColor()),strokeOpacity:M.utils.isNullOrEmpty(x)?0:M.utils.getOpacityFromRgba(x.getColor()),strokeWidth:M.utils.isNullOrEmpty(x)?0:x.getWidth&&x.getWidth(),pointRadius:M.utils.isNullOrEmpty(a)?"":a.getRadius&&a.getRadius(),externalGraphic:M.utils.isNullOrEmpty(a)?"":a.getSrc&&a.getSrc(),graphicHeight:s[0],graphicWidth:s[1]};if(!M.utils.isNullOrEmpty(E)){var T=E.getTextAlign(),C=E.getTextBaseline(),P="";M.utils.isNullOrEmpty(T)||(T=T===M.style.align.LEFT?"l":T===M.style.align.RIGHT?"r":T===M.style.align.CENTER?"c":""),M.utils.isNullOrEmpty(C)||(C=C===M.style.baseline.BOTTOM?"b":C===M.style.baseline.MIDDLE?"m":C===M.style.baseline.TOP?"t":""),M.utils.isNullOrEmpty(T)||M.utils.isNullOrEmpty(C)||(P=T.concat(C));var k=E.getFont(),w=!M.utils.isNullOrEmpty(k)&&k.indexOf("bold")>-1?"bold":"normal",R="11px";if(!M.utils.isNullOrEmpty(k)){var F=k.substr(0,k.indexOf("px"));if(!M.utils.isNullOrEmpty(F)){var A=F.lastIndexOf(" ");R=A>-1?F.substr(A,F.length).trim().concat("px"):F.concat("px")}}S={type:"text",label:E.getText()||"",fontColor:M.utils.isNullOrEmpty(E.getFill())?"#000000":M.utils.rgbToHex(E.getFill().getColor()),fontSize:R,fontFamily:"Helvetica, sans-serif",fontStyle:"normal",fontWeight:w,conflictResolution:"false",labelXOffset:E.getOffsetX(),labelYOffset:E.getOffsetY(),fillColor:L.fillColor||"#FF0000",fillOpacity:L.fillOpacity||1,labelOutlineColor:M.utils.isNullOrEmpty(E.getStroke())?"":M.utils.rgbToHex(E.getStroke().getColor()||"#FF0000"),labelOutlineWidth:M.utils.isNullOrEmpty(E.getStroke())?"":E.getStroke().getWidth(),labelAlign:P}}if(y="draw".concat(d),!M.utils.isNullOrEmpty(n)&&n.intersectsExtent(p)||!M.utils.isNullOrEmpty(E)){var j,I=JSON.stringify(L),D=JSON.stringify(S),U=b[I],G=_[D];if(M.utils.isUndefined(U)||M.utils.isUndefined(G)){var W=[],H=0;if(!M.utils.isNullOrEmpty(n)&&n.intersectsExtent(p)&&M.utils.isUndefined(U)&&(U=v,b[I]=U,H=1,W.push(I),v+=1,d+=1),!M.utils.isNullOrEmpty(E)&&M.utils.isUndefined(G)&&(G=h,_[D]=G,W.push(D),h+=1,0===H&&(d+=1,W.push(I))),void 0===U&&(U=0),void 0===G&&(G=0),f="\"[_gx_style ='".concat(U+G,"']\""),!M.utils.isNullOrEmpty(W)){var q=" ".concat(f,':{"symbolizers": [').concat(W,"]}");O+=""!==O?",".concat(q):"{".concat(q,',"version":"2"')}}(j="EPSG:3857"!==r.code&&e.facadeMap_.getLayers().some((function(t){return t.type===M.layer.type.OSM||t.type===M.layer.type.Mapbox}))?c.writeFeatureObject(t,{featureProjection:r.code,dataProjection:"EPSG:3857"}):c.writeFeatureObject(t)).properties={_gx_style:U+G,name:y},g.push(j)}}}),this),i={type:"Vector",style:O=""!==O?JSON.parse(O.concat("}")):{"*":{symbolizers:[]},version:"2"},styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:g},name:a,opacity:s}}return i}},{key:"encodeMVT",value:function(t){var e=this,i=null,n=!0;if((t.getStyle()instanceof M.style.Chart||t.getStyle()instanceof M.style.Cluster&&t.getStyle().getOldStyle()instanceof M.style.Chart)&&(n=!1),n){var r=this.facadeMap_.getProjection(),l=t.getImpl().getOL3Layer(),o=t.getFeatures(),a=t.name,s=l.getOpacity(),u=l.getStyle(),c=new ol.format.GeoJSON,p=this.facadeMap_.getBbox();p=[p.x.min,p.y.min,p.x.max,p.y.max];var y,f,m=this.facadeMap_.getMapImpl().getView().getResolution(),g=[],d=1,h=1,v=1,O="",b={},_={};o.forEach((function(t){var i,n=t.getGeometry(),l=t.getStyle();if(M.utils.isNullOrEmpty(l)?M.utils.isNullOrEmpty(u)||(i=u):i=l,i instanceof Function&&(i=i.call(i,t,m)),i instanceof Array&&(i=i.length>1&&!M.utils.isNullOrEmpty(i[1].getImage())&&i[1].getImage().getSrc?i[1]:i[0]),!M.utils.isNullOrEmpty(i)){var o,a=i.getImage(),s=M.utils.isNullOrEmpty(a)?[0,0]:a.getImageSize()||[24,24],E=i.getText();M.utils.isNullOrEmpty(E)&&!M.utils.isNullOrEmpty(i.textPath)&&(E=i.textPath),o="multipolygon"===t.getGeometry().getType().toLowerCase()?"polygon":"multipoint"===t.getGeometry().getType().toLowerCase()?"point":"multilinestring"===t.getGeometry().getType().toLowerCase()?"line":t.getGeometry().getType().toLowerCase();var S,x=M.utils.isNullOrEmpty(a)?i.getStroke():a.getStroke&&a.getStroke(),N=M.utils.isNullOrEmpty(a)?i.getFill():a.getFill&&a.getFill(),L={type:o,fillColor:M.utils.isNullOrEmpty(N)?"#000000":M.utils.rgbaToHex(N.getColor()).slice(0,7),fillOpacity:M.utils.isNullOrEmpty(N)?0:M.utils.getOpacityFromRgba(N.getColor()),strokeColor:M.utils.isNullOrEmpty(x)?"#000000":M.utils.rgbaToHex(x.getColor()),strokeOpacity:M.utils.isNullOrEmpty(x)?0:M.utils.getOpacityFromRgba(x.getColor()),strokeWidth:M.utils.isNullOrEmpty(x)?0:x.getWidth&&x.getWidth(),pointRadius:M.utils.isNullOrEmpty(a)?"":a.getRadius&&a.getRadius(),externalGraphic:M.utils.isNullOrEmpty(a)?"":a.getSrc&&a.getSrc(),graphicHeight:s[0],graphicWidth:s[1]};if(!M.utils.isNullOrEmpty(E)){var T=E.getTextAlign(),C=E.getTextBaseline(),P="";M.utils.isNullOrEmpty(T)||(T=T===M.style.align.LEFT?"l":T===M.style.align.RIGHT?"r":T===M.style.align.CENTER?"c":""),M.utils.isNullOrEmpty(C)||(C=C===M.style.baseline.BOTTOM?"b":C===M.style.baseline.MIDDLE?"m":C===M.style.baseline.TOP?"t":""),M.utils.isNullOrEmpty(T)||M.utils.isNullOrEmpty(C)||(P=T.concat(C));var k=E.getFont(),w=!M.utils.isNullOrEmpty(k)&&k.indexOf("bold")>-1?"bold":"normal",R="11px";if(!M.utils.isNullOrEmpty(k)){var F=k.substr(0,k.indexOf("px"));if(!M.utils.isNullOrEmpty(F)){var A=F.lastIndexOf(" ");R=A>-1?F.substr(A,F.length).trim().concat("px"):F.concat("px")}}S={type:"text",label:E.getText()||"",fontColor:M.utils.isNullOrEmpty(E.getFill())?"#000000":M.utils.rgbToHex(E.getFill().getColor()),fontSize:R,fontFamily:"Helvetica, sans-serif",fontStyle:"normal",fontWeight:w,conflictResolution:"false",labelXOffset:E.getOffsetX(),labelYOffset:E.getOffsetY(),fillColor:L.fillColor||"#FF0000",fillOpacity:L.fillOpacity||1,labelOutlineColor:M.utils.isNullOrEmpty(E.getStroke())?"":M.utils.rgbToHex(E.getStroke().getColor()||"#FF0000"),labelOutlineWidth:M.utils.isNullOrEmpty(E.getStroke())?"":E.getStroke().getWidth(),labelAlign:P}}if(y="draw".concat(d),!M.utils.isNullOrEmpty(n)&&n.intersectsExtent(p)||!M.utils.isNullOrEmpty(E)){var j,I=JSON.stringify(L),D=JSON.stringify(S),U=b[I],G=_[D];if(M.utils.isUndefined(U)||M.utils.isUndefined(G)){var W=[],H=0;if(!M.utils.isNullOrEmpty(n)&&n.intersectsExtent(p)&&M.utils.isUndefined(U)&&(U=v,b[I]=U,H=1,W.push(I),v+=1,d+=1),!M.utils.isNullOrEmpty(E)&&M.utils.isUndefined(G)&&(G=h,_[D]=G,W.push(D),h+=1,0===H&&(d+=1,W.push(I))),void 0===U&&(U=0),void 0===G&&(G=0),f="\"[_gx_style ='".concat(U+G,"']\""),!M.utils.isNullOrEmpty(W)){var q=" ".concat(f,':{"symbolizers": [').concat(W,"]}");O+=""!==O?",".concat(q):"{".concat(q,',"version":"2"')}}(j="EPSG:3857"!==r.code&&e.facadeMap_.getLayers().some((function(t){return t.type===M.layer.type.OSM||t.type===M.layer.type.Mapbox}))?c.writeFeatureObject(t,{featureProjection:r.code,dataProjection:"EPSG:3857"}):c.writeFeatureObject(t)).properties={_gx_style:U+G,name:y},g.push(j)}}}),this),i={type:"Vector",style:O=""!==O?JSON.parse(O.concat("}")):{"*":{symbolizers:[]},version:"2"},styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:g},name:a,opacity:s}}return i}},{key:"encodeWMTS",value:function(t){var e=this.facadeMap_.getZoom(),i=t.getImpl(),n=i.getOL3Layer(),r=n.getSource(),l=r.getTileGrid(),o=t.url,a=t.name,s=n.getOpacity(),u=r.getRequestEncoding(),c=i.tiled,p=n.getExtent(),y={},f=r.getMatrixSet(),m=l.getTileSize(e),g=l.getResolutions();return t.getImpl().getCapabilities().then((function(t){var e=t.Contents.TileMatrixSet.filter((function(t){return t.Identifier===f}))[0];return{baseURL:o,opacity:s,singleTile:!c,type:"WMTS",layer:a,requestEncoding:u,tileSize:m,style:"default",rotation:0,imageFormat:"image/png",dimensionParams:{},dimensions:[],params:y,version:"1.0.0",maxExtent:p,matrixSet:f,matrices:e.TileMatrix.map((function(t,e){return{identifier:t.Identifier,matrixSize:[t.MatrixHeight,t.MatrixWidth],scaleDenominator:t.ScaleDenominator,tileSize:[t.TileWidth,t.TileHeight],topLeftCorner:t.TopLeftCorner}})),resolutions:g}}))}},{key:"encodeOSM",value:function(t){var e=t.getImpl(),i=e.getOL3Layer(),n=i.getSource().getTileGrid(),r=t.url||"http://tile.openstreetmap.org/",l=t.name,o=i.getOpacity(),a=e.tiled,s=n.getExtent(),u=n.getTileSize();return{baseURL:r,opacity:o,singleTile:!a,layer:l,maxExtent:s,tileSize:[u,u],resolutions:n.getResolutions(),type:"OSM",imageExtension:"png"}}},{key:"encodeMapbox",value:function(t){var e=t.getImpl().getOL3Layer(),i=e.getSource().getTileGrid(),n=M.utils.concatUrlPaths([M.config.MAPBOX_URL,t.name]),r=e.getOpacity(),l=i.getExtent(),o=i.getTileSize(),a=i.getResolutions(),s={};return s[M.config.MAPBOX_TOKEN_NAME]=M.config.MAPBOX_TOKEN_VALUE,{opacity:r,baseURL:n,customParams:s,maxExtent:l,tileSize:[o,o],resolutions:a,extension:M.config.MAPBOX_EXTENSION,type:"osm",path_format:"/${z}/${x}/${y}.png"}}},{key:"transformExt",value:function(t,e,i){return ol.proj.transformExtent(t,e,i)}},{key:"destroy",value:function(){this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null}}])&&r(e.prototype,i),n&&r(e,n),s}(),c=i(39),p=i.n(c);function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=h(t);if(e){var r=h(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return d(this,i)}}function d(t,e){return!e||"object"!==y(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var v="No se ha podido conectar con el servicio de impresión",O=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}(l,M.Control);var e,i,n,r=g(l);function l(t,e,i){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l);var o=new u;return n=r.call(this,o,l.NAME),M.utils.isUndefined(u)&&M.exception("La implementación usada no puede crear controles Printer"),M.utils.isUndefined(u.prototype.encodeLayer)&&M.exception("La implementación usada no posee el método encodeLayer"),M.utils.isUndefined(u.prototype.encodeLegend)&&M.exception("La implementación usada no posee el método encodeLegend"),n.url_=t,n.ref_=null,n.printing_=!1,n.inputTitle_=null,n.areaDescription_=null,n.layout_=null,n.format_=null,n.dpi_=null,n.forceScale_=null,n.params_=e||{},n.queueContainer_=null,n.capabilitiesPromise_=null,n.connectionTimeout_=i.connectionTimeout||15,n.loadingService=!0,n.errorService=!1,n.outputFormats_=Array.isArray(i.outputFormats)?i.outputFormats:["pdf","png","jpg"],n.options_=i||{},M.utils.isNullOrEmpty(n.options_.layout)&&(n.options_.layout=M.config.geoprint.TEMPLATE),M.utils.isNullOrEmpty(n.options_.dpi)&&(n.options_.dpi=M.config.geoprint.DPI),M.utils.isNullOrEmpty(n.options_.format)&&(n.options_.format=M.config.geoprint.FORMAT),M.utils.isNullOrEmpty(n.options_.forceScale)&&(n.options_.forceScale=M.config.geoprint.FORCE_SCALE),M.utils.isNullOrEmpty(n.options_.legend)&&(n.options_.legend=M.config.geoprint.LEGEND),n}return e=l,(i=[{key:"getStatus",value:function(t,e){var i=this;M.remote.get(t).then((function(n){var r=JSON.parse(n.text).status;"finished"===r?e():"error"===r?(e(),M.dialog.error("Se ha producido un error en la impresión")):!1===i.printing_?(M.dialog.error("Se ha cancelado la impresión"),i.queueContainer_.lastChild.remove()):setTimeout((function(){return i.getStatus(t,e)}),1e3)}))}},{key:"open",value:function(){if(this.loadingService)M.dialog.error("El servicio aún no ha cargado","Servicio cargando");else if(this.errorService)M.dialog.error(v,"Error de conexión");else{var t=this.getPanel().getTemplatePanel(),e=this.getPanel().getButtonPanel();t.classList.remove("collapsed"),e.classList.remove("g-cartografia-impresora"),t.classList.add("opened"),e.classList.add("g-cartografia-flecha-derecha"),this.getPanel().setCollapsed(!1),this.getPanel().fire(M.evt.SHOW)}}},{key:"createView",value:function(t){var e=this;return this.getPanel().open=this.open.bind(this),new Promise((function(t,i){e.getCapabilities().then((function(i){var n,r,l=i,o=0;for(l.layouts=l.layouts.filter((function(t){return!t.name.endsWith("jpg")})),o=0,n=l.layouts.length;o<n;o+=1){var a=l.layouts[o];if(a.name===e.options_.layout){a.default=!0;break}}for(l.dpis=[],o=0,n=l.layouts[0].attributes.length;o<n;o+=1)null!=l.layouts[0].attributes[o].clientInfo&&(r=l.layouts[0].attributes[o]);for(o=0,n=r.clientInfo.dpiSuggestions.length;o<n;o+=1){var s={value:r.clientInfo.dpiSuggestions[o]};l.dpis.push(s)}Array.isArray(l.formats)&&(e.outputFormats_=l.formats),l.format=e.outputFormats_.map((function(t){return{name:t}})),M.template.compileSync||(M.template.compileSync=function(t,e){var i,n={};M.utils.isUndefined(e)||(n=M.utils.extends(n,e.vars),i=e.parseToHtml);var r=Handlebars.compile(t)(n);return!1!==i?M.utils.stringToHtml(r):r}),l.forceScale=e.options_.forceScale;var u=M.template.compileSync(p.a,{jsonp:!0,vars:l});e.addEvents(u),e.loadingService=!1,t(u)})).catch((function(t){e.loadingService=!1,e.errorService=!0,M.dialog.error(v,"Error de conexión")}))}))}},{key:"addEvents",value:function(t){var e=this;this.element_=t,this.inputTitle_=this.element_.querySelector(".form div.title > input"),this.areaDescription_=this.element_.querySelector(".form div.description > textarea");var i=this.element_.querySelector(".form div.layout > select");i.addEventListener("change",(function(t){var n=i.value;e.setLayout({value:n,name:n})}));var n=i.value;this.setLayout({value:n,name:n});var r=this.element_.querySelector(".form div.dpi > select");r.addEventListener("change",(function(t){var i=r.value;e.setDpi({value:i,name:i})}));var l=r.value;this.setDpi({value:l,name:l});var o=this.element_.querySelector(".form div.format > select");o.addEventListener("change",(function(t){e.setFormat(o.value)})),this.setFormat(o.value);var a=this.element_.querySelector(".form div.forcescale > input");a.addEventListener("click",(function(t){e.setForceScale(!0===a.checked)})),this.setForceScale(!0===a.checked),this.element_.querySelector(".button > button.print").addEventListener("click",this.printClick_.bind(this)),this.element_.querySelector(".button > button.cancel").addEventListener("click",this.cancelClick_.bind(this)),this.element_.querySelector(".button > button.remove").addEventListener("click",(function(t){t.preventDefault(),e.inputTitle_.value="",e.areaDescription_.value="",i.value=e.options_.layout,r.value=e.options_.dpi,o.value=e.options_.format,a.checked=e.options_.forceScale;var n=document.createEvent("HTMLEvents");n.initEvent("change");var l=document.createEvent("HTMLEvents");l.initEvent("click"),i.dispatchEvent(n),r.dispatchEvent(n),o.dispatchEvent(n),a.dispatchEvent(l),Array.prototype.forEach.apply(e.queueContainer_.children,[function(t){t.removeEventListener("click",e.dowloadPrint)},e]),e.queueContainer_.innerHTML=""})),this.queueContainer_=this.element_.querySelector(".queue > ul.queue-container"),M.utils.enableTouchScroll(this.queueContainer_)}},{key:"setLayout",value:function(t){this.layout_=t}},{key:"setFormat",value:function(t){this.format_=t}},{key:"setDpi",value:function(t){this.dpi_=t}},{key:"setForceScale",value:function(t){this.forceScale_=t}},{key:"printClick_",value:function(t){var e=this;t.preventDefault(),this.getPrintData().then((function(t){var i=M.utils.concatUrlPaths([e.url_,"report.".concat(t.outputFormat)]),n=e.createQueueElement();e.queueContainer_.appendChild(n),n.classList.add(l.LOADING_CLASS),i=M.utils.addParameters(i,"mapeaop=geoprint"),M.remote.post(i,t).then((function(t){var i=t,r=JSON.parse(i.text);e.ref_=r.ref;var o=M.utils.concatUrlPaths([e.params_.urlApplication,"print/status","".concat(e.ref_,".json")]);if(e.printing_=!0,e.getStatus(o,(function(){return n.classList.remove(l.LOADING_CLASS)})),200===i.code){var a;try{var s=(i=JSON.parse(i.text)).downloadURL.split("@")[1],u=i.downloadURL.substring(i.downloadURL.indexOf("/print"),i.downloadURL.length);a=M.utils.concatUrlPaths([e.params_.urlApplication,"".concat(u,";GEOPRID=.").concat(s)])}catch(t){M.exception(t)}n.setAttribute(l.DOWNLOAD_ATTR_NAME,a),n.addEventListener("click",e.dowloadPrint)}else M.dialog.error("Se ha producido un error en la impresión")}))}))}},{key:"cancelClick_",value:function(t){t.preventDefault(),this.printing_=!1}},{key:"getCapabilities",value:function(){var t=this;return M.utils.isNullOrEmpty(this.capabilitiesPromise_)&&(this.capabilitiesPromise_=new Promise((function(e,i){setTimeout((function(){var t=new Error("CONNECTION TIMEOUT");i(t)}),1e3*t.connectionTimeout_);var n=M.utils.concatUrlPaths([t.url_,"capabilities.json"]);M.remote.get(n).then((function(t){var i={};try{i=JSON.parse(t.text)}catch(t){M.exception(t)}e(i)}))}))),this.capabilitiesPromise_}},{key:"getPrintData",value:function(){var t=this,e=this.inputTitle_.value,i=this.areaDescription_.value,n=this.map_.getProjection().code,r=this.layout_.name,l=this.dpi_.value,o=this.format_,a=this.map_.getCenter(),s=this.params_.parameters,u=this.options_.legend;"jpg"===o&&(r+=" jpg");var c=M.utils.extend({layout:r,outputFormat:o,attributes:{title:e,description:i,epsg:n,map:{useAdjustBounds:!0,projection:n,dpi:l}}},this.params_.layout);return this.encodeLayers().then((function(e){if(c.attributes.map.layers=e,c.attributes=Object.assign(c.attributes,s),u){for(var i=[],r=t.encodeLegends(),l=0,o=r.length;l<o;l+=1)if(!M.utils.isNullOrEmpty(r[l].classes[0])){var p={name:r[l].classes[0].name,icons:r[l].classes[0].icons};i.push(p)}c.attributes.legend={classes:i}}if("EPSG:3857"!==n&&t.map_.getLayers().some((function(t){return t.type===M.layer.type.OSM||t.type===M.layer.type.Mapbox}))&&(c.attributes.map.projection="EPSG:3857"),!1===t.forceScale_){var y=t.map_.getBbox();c.attributes.map.bbox=[y.x.min,y.y.min,y.x.max,y.y.max],"EPSG:3857"!==n&&t.map_.getLayers().some((function(t){return t.type===M.layer.type.OSM||t.type===M.layer.type.Mapbox}))&&(c.attributes.map.bbox=t.getImpl().transformExt(c.attributes.map.bbox,n,"EPSG:3857"))}else!0===t.forceScale_&&(c.attributes.map.center=[a.x,a.y],c.attributes.map.scale=t.map_.getScale());return c}))}},{key:"encodeLayers",value:function(){var t=this,e=this.map_.getLayers().filter((function(t){return!0===t.isVisible()&&!0===t.inRange()&&M.utils.isString(t.name)&&!t.name.startsWith("cluster_cover")})),i=e.length;return new Promise((function(n,r){var l=[],o=[];e.forEach((function(e){t.getImpl().encodeLayer(e).then((function(r){if(M.utils.isNullOrEmpty(r)||"Vector"===r.type){var a=t.map_.getMapImpl().getView().getResolution(),s=e.getImpl().getOL3Layer().getMaxResolution();a>=e.getImpl().getOL3Layer().getMinResolution()&&a<=s&&o.push(r)}else l.push(r);0==(i-=1)&&(l=l.concat(o),n(l.reverse()))}))}))}))}},{key:"encodeLegends",value:function(){var t=this,e=[];return this.map_.getLayers().forEach((function(i){if(!0===i.isVisible()&&!0===i.inRange()){var n=t.getImpl().encodeLegend(i);null!==n&&e.push(n)}}),this),e}},{key:"createQueueElement",value:function(){var t=document.createElement("li"),e=this.inputTitle_.value;return M.utils.isNullOrEmpty(e)&&(e=l.NO_TITLE),t.innerHTML=e,t}},{key:"dowloadPrint",value:function(t){t.preventDefault();var e=this.getAttribute(l.DOWNLOAD_ATTR_NAME);M.utils.isNullOrEmpty(e)||window.open(e,"_blank")}},{key:"equals",value:function(t){var e=!1;return t instanceof l&&(e=this.name===t.name),e}}])&&f(e.prototype,i),n&&f(e,n),l}();O.NAME="printercontrol",O.TEMPLATE="printer.html",O.LOADING_CLASS="printing",O.DOWNLOAD_ATTR_NAME="data-donwload-url-print",O.NO_TITLE="(Sin título)";i(66);var b=i(40);function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function x(t,e){return(x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function N(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=T(t);if(e){var r=T(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return L(this,i)}}function L(t,e){return!e||"object"!==_(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var C=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}(l,M.Plugin);var e,i,n,r=N(l);function l(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,l),(t=r.call(this,null)).map_=null,t.control_=null,t.panel_=null,t.name=l.NAME,t.url_=M.config.geoprint2.URL,M.utils.isNullOrEmpty(e.url)||(t.url_=e.url),t.params_={urlApplication:M.config.geoprint2.URL_APPLICATION,layout:{outputFilename:"mapea_${yyyy-MM-dd_hhmmss}"}},M.utils.isNullOrEmpty(e.params)||(t.params_=e.params,M.utils.isNullOrEmpty(t.params_.urlApplication)&&(t.params_.urlApplication=M.config.geoprint2.URL_APPLICATION),M.utils.isNullOrEmpty(t.params_.layout)&&(t.params_.layout={outputFilename:"mapea_${yyyy-MM-dd_hhmmss}"})),t.options_={},M.utils.isNullOrEmpty(e.options)||(t.options_=e.options),t.metadata_=b.metadata,t}return e=l,(i=[{key:"addTo",value:function(t){var e=this;this.map_=t,this.control_=new O(this.url_,this.params_,this.options_),this.panel_=new M.ui.Panel("printer",{collapsible:!0,className:"m-printer",collapsedButtonClass:"g-cartografia-impresora",position:M.ui.position.TR,tooltip:"Impresión del mapa"}),this.panel_.on(M.evt.ADDED_TO_MAP,(function(t){M.utils.enableTouchScroll(t)})),this.panel_.addControls(this.control_),this.map_.addPanels(this.panel_),this.control_.on(M.evt.ADDED_TO_MAP,(function(){e.fire(M.evt.ADDED_TO_MAP)}))}},{key:"getControls",value:function(){var t=[];return t.push(this.control_),t}},{key:"destroy",value:function(){this.map_.removeControls([this.control_]),this.map_=null,this.control_=null,this.panel_=null,this.url_=null,this.params_=null,this.options_=null,this.name=null}},{key:"equals",value:function(t){return t instanceof l}},{key:"getAPIRest",value:function(){return"printer=".concat(this.url_)}},{key:"getMetadata",value:function(){return this.metadata_}}])&&S(e.prototype,i),n&&S(e,n),l}();C.NAME="printer",null==window.M.plugin&&(window.M.plugin={}),window.M.plugin.Printer=C}});